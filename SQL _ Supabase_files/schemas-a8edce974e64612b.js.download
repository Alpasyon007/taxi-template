(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3055],{21646:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return R}});var r=n(81333),a=n(76635),i=n(2784),s=n(20406),o=n(28526),l=n.n(o),c=n(10908),u=n.n(c),d=n(6277),f=n(64121),m=n(51178),h=n(46776),p=n(85716),x=n(13873),g=n(72347),b=n(38617),v=n(97064),y=n(4167);n(32395);var j=n(12292),_=n(69358),w=n(22962),N=n(29027),k=n(52322);function O(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return E(e,t)}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Z(){return(Z=(0,s.Z)(l().mark(function e(t){var n,i,s,o,c,u,d,f,m,h,p,x,g,b,v,y,j,_;return l().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=2;break}return e.abrupt("return",{nodes:[],edges:[]});case 2:n=t.map(function(e){var t=(e.columns||[]).map(function(t){return{id:t.id,isPrimary:e.primary_keys.some(function(e){return e.name===t.name}),name:t.name,format:t.format,isNullable:t.is_nullable,isUnique:t.is_unique,isUpdateable:t.is_updatable,isIdentity:t.is_identity}});return{id:"".concat(e.id),type:"table",data:{name:e.name,isForeign:!1,columns:t},position:{x:0,y:0}}}),i=[],s=t[0].schema,o=O((0,a.uniqBy)(t.flatMap(function(e){return e.relationships}),"id")),e.prev=7,o.s();case 9:if((c=o.n()).done){e.next=23;break}if(!((u=c.value).source_schema!==s)){e.next=13;break}return e.abrupt("continue",21);case 13:if(!(u.target_table_schema!==s)){e.next=18;break}return n.push({id:u.constraint_name,type:"table",data:{name:"".concat(u.target_table_schema,".").concat(u.target_table_name,".").concat(u.target_column_name),isForeign:!0,columns:[]},position:{x:0,y:0}}),d=P(t,u.source_table_name,u.source_column_name),m=(f=(0,r.Z)(d,2))[0],h=f[1],m&&i.push({id:String(u.id),source:m,sourceHandle:h,target:u.constraint_name,targetHandle:u.constraint_name}),e.abrupt("continue",21);case 18:p=P(t,u.source_table_name,u.source_column_name),g=(x=(0,r.Z)(p,2))[0],b=x[1],v=P(t,u.target_table_name,u.target_column_name),j=(y=(0,r.Z)(v,2))[0],_=y[1],g&&j&&i.push({id:String(u.id),source:g,sourceHandle:b,target:j,targetHandle:_});case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(7),o.e(e.t0);case 28:return e.prev=28,o.f(),e.finish(28);case 31:return e.abrupt("return",S(n,i));case 32:case"end":return e.stop()}},e,null,[[7,25,28,31]])}))).apply(this,arguments)}function P(e,t,n){var r,a=O(e);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(t===i.name){var s,o=O(i.columns||[]);try{for(o.s();!(s=o.n()).done;){var l=s.value;if(n===l.name)return[String(i.id),l.id]}}catch(e){o.e(e)}finally{o.f()}}}}catch(e){a.e(e)}finally{a.f()}return[]}var S=function(e,t){var n=new(u()).graphlib.Graph;return n.setDefaultEdgeLabel(function(){return{}}),n.setGraph({rankdir:"LR",align:"UR",nodesep:25,ranksep:50}),e.forEach(function(e){n.setNode(e.id,{width:H/2,height:L/2*(e.data.columns.length+1)})}),t.forEach(function(e){n.setEdge(e.source,e.target)}),u().layout(n),e.forEach(function(e){var t=n.node(e.id);return e.targetPosition=p.Ly.Left,e.sourcePosition=p.Ly.Right,e.position={x:t.x-t.width/2,y:t.y-t.height/2},e}),{nodes:e,edges:t}},H=320,L=40;function z(e){var t=e.data,n=e.targetPosition,r=e.sourcePosition,a="!h-px !w-px !min-w-0 !min-h-0 !cursor-grab !border-0 !opacity-0";return(0,k.jsx)(k.Fragment,{children:t.isForeign?(0,k.jsx)("div",{className:"rounded-lg overflow-hidden",children:(0,k.jsxs)("header",{className:"text-[0.5rem] leading-5 font-bold px-2 text-center bg-brand text-gray-300",children:[t.name,n&&(0,k.jsx)(p.HH,{type:"target",id:t.name,position:n,className:(0,d.default)(a,"!left-0")})]})}):(0,k.jsxs)("div",{className:"rounded-lg overflow-hidden",style:{width:H/2},children:[(0,k.jsx)("header",{className:"text-[0.5rem] leading-5 font-bold px-2 text-center bg-brand text-background-surface-100",children:t.name}),t.columns.map(function(e){return(0,k.jsxs)("div",{className:"text-[8px] leading-5 relative flex flex-row justify-items-start odd:bg-surface-100 even:bg-surface-200",children:[(0,k.jsxs)("div",{className:"gap-[0.24rem] flex mx-2 align-middle basis-1/5 items-center justify-start",children:[e.isPrimary&&(0,k.jsx)(j.Z,{size:8,strokeWidth:2,className:"sb-grid-column-header__inner__primary-key flex-shrink-0"}),e.isNullable&&(0,k.jsx)(f.Z,{size:8,strokeWidth:2,className:"flex-shrink-0"}),!e.isNullable&&(0,k.jsx)(f.Z,{size:8,strokeWidth:2,fill:"currentColor",className:"flex-shrink-0"}),e.isUnique&&(0,k.jsx)(m.Z,{size:8,strokeWidth:2,className:"flex-shrink-0"}),e.isIdentity&&(0,k.jsx)(_.Z,{size:8,strokeWidth:2,className:"flex-shrink-0"}),!e.isUpdateable&&(0,k.jsx)(w.Z,{size:8,strokeWidth:2,className:"flex-shrink-0"})]}),(0,k.jsxs)("div",{className:"flex w-full justify-between",children:[(0,k.jsx)("span",{className:"text-ellipsis overflow-hidden whitespace-nowrap",children:e.name}),(0,k.jsx)("span",{className:(0,d.default)(e.isPrimary&&"pl-[6px]","absolute top-0 left-0 right-0 pl-2 bg-surface-300 text-ellipsis overflow-hidden whitespace-nowrap opacity-0 hover:opacity-100"),children:e.name}),(0,k.jsx)("span",{className:"px-2 inline-flex justify-end",children:e.format})]}),n&&(0,k.jsx)(p.HH,{type:"target",id:e.id,position:n,className:(0,d.default)(a,"!left-0")}),r&&(0,k.jsx)(p.HH,{type:"source",id:e.id,position:r,className:(0,d.default)(a,"!right-0")})]},e.id)})]})})}var A=function(e){var t=e.tables,n=(0,b.F)().resolvedTheme,r=null!=n&&n.includes("dark")?"#2e2e2e":"#e6e8eb",a=null!=n&&n.includes("dark")?"#ededed":"#111318",s=null!=n&&n.includes("dark")?"rgb(17, 19, 24, .8)":"rgb(237, 237, 237, .8)",o=(0,p._K)(),l=(0,i.useMemo)(function(){return{table:z}},[]);return(0,i.useEffect)(function(){(function(e){return Z.apply(this,arguments)})(t).then(function(e){var t=e.nodes,n=e.edges;o.setNodes(t),o.setEdges(n),setTimeout(function(){return o.fitView({})})})},[t,n]),(0,k.jsx)(k.Fragment,{children:(0,k.jsx)("div",{className:"w-full h-full",children:(0,k.jsxs)(p.x$,{defaultNodes:[],defaultEdges:[],defaultEdgeOptions:{type:"smoothstep",animated:!0,deletable:!1,style:{stroke:a}},nodeTypes:l,fitView:!0,minZoom:.8,maxZoom:1.8,proOptions:{hideAttribution:!0},children:[(0,k.jsx)(x.A,{gap:16,color:r,variant:x.T.Lines}),(0,k.jsx)(g.a,{pannable:!0,zoomable:!0,nodeColor:"#111318",maskColor:s,className:"border border-control rounded-md shadow-sm"})]})})})},F=(0,h.Pi)(function(e){var t,n=e.schema,r=(0,v.d2)().project,a=(0,y.Bj)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,schema:n}),i=a.data,s=a.isLoading,o=a.isError,l=a.error;return s?(0,k.jsxs)("div",{className:"flex h-full w-full items-center justify-center space-x-2",children:[(0,k.jsx)(N.Z,{className:"animate-spin",size:14}),(0,k.jsx)("p",{className:"text-sm text-foreground-light",children:"Loading table..."})]}):o?(0,k.jsxs)("div",{className:"px-6 py-4 text-foreground-light",children:[(0,k.jsx)("p",{children:"Error connecting to API"}),(0,k.jsx)("p",{children:"".concat(null!==(t=null==l?void 0:l.message)&&void 0!==t?t:"Unknown error")})]}):(0,k.jsx)(p.tV,{children:(0,k.jsx)(A,{tables:i})})}),T=n(11425),U=n(45812),C=n(19269),D=n(59800),I=n(85459),W=function(){var e=(0,v.d2)().project,t=(0,D.Q1)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),n=t.data,s=t.isSuccess,o=t.isLoading,l=t.isError,c=t.error,u=(0,i.useState)("public"),d=u[0],f=u[1],m=(0,a.partition)(n,function(e){var t;return I.F.includes(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"")}),h=(0,r.Z)(m,2),p=h[0];h[1];var x=null==n?void 0:n.find(function(e){return e.name===d});return p.some(function(e){return e.id===(null==x?void 0:x.id)}),(0,k.jsx)(k.Fragment,{children:(0,k.jsxs)("div",{className:"flex w-full h-full flex-col",children:[(0,k.jsxs)("div",{className:"p-4 border-b border-default",children:[o&&(0,k.jsx)("div",{className:"h-[34px] w-[260px] bg-foreground-lighter rounded shimmering-loader"}),l&&(0,k.jsx)(U.Z,{error:c,subject:"Failed to retrieve schemas"}),s&&(0,k.jsx)(C.Z,{className:"w-[260px]",size:"small",showError:!1,selectedSchemaName:d,onSelectSchema:f})]}),(0,k.jsx)(F,{schema:d})]})})};W.getLayout=function(e){return(0,k.jsx)(T._h,{title:"Database",children:e})};var R=W},69358:function(e,t,n){"use strict";var r=n(95235);n(2784);var a=n(83178),i=n(12223),s=n(52322);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}t.Z=function(e){return(0,s.jsx)(i.Z,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({icon:a.Z},e))}},9836:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/database/schemas",function(){return n(21646)}])}},function(e){e.O(0,[9795,1187,8421,4747,7287,7898,6218,6571,2514,2187,2645,6823,7725,9774,2888,179],function(){return e(e.s=9836)}),_N_E=e.O()}]);
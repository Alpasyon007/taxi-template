(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9395],{78620:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return X}});var s=r(59491),n=r(46776),i=r(2784),a=r(92913),l=r(81333),c=r(24990),d=r(76635),o=r(14665),x=r(55210),u=r(8647),h=r(97064),g=r(67270),j=r(52322),f=function(){return(0,j.jsx)(g.b,{title:"Alpha preview",withIcon:!0,variant:"warning",children:"This is not suitable for production"})},m=r(85577),p=r(55268),b=r(45812),N=r(19269),v=r(22812),w=r(59800),Z=r(70203),y=r(85459),T=r(73302),_=r(97346),E=r(59227),S=r(93306),A=r(924),O=r(90464),k=r(77426),P=(0,n.Pi)(function(e){var t=e.schema,r=e.filterString,n=e.isLocked,i=e.editTrigger,a=e.deleteTrigger,l=(0,Z.oR)().meta.triggers.list().filter(function(e){return(0,d.includes)(e.name.toLowerCase(),r.toLowerCase())}).filter(function(e){return e.schema==t}),o=(0,Z.Xo)(s.KA.TENANT_SQL_ADMIN_WRITE,"triggers");return 0===l.length&&0===r.length?(0,j.jsx)(p.Z.tr,{children:(0,j.jsxs)(p.Z.td,{colSpan:6,children:[(0,j.jsx)("p",{className:"text-sm text-foreground",children:"No triggers created yet"}),(0,j.jsxs)("p",{className:"text-sm text-foreground-light",children:['There are no triggers found in the schema "',t,'"']})]})},t):0===l.length&&r.length>0?(0,j.jsx)(p.Z.tr,{children:(0,j.jsxs)(p.Z.td,{colSpan:5,children:[(0,j.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,j.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',r,'" did not return any results']})]})},t):(0,j.jsx)(j.Fragment,{children:l.map(function(e){return(0,j.jsxs)(p.Z.tr,{children:[(0,j.jsx)(p.Z.td,{className:"space-x-2",children:(0,j.jsx)("p",{title:e.name,className:"truncate",children:e.name})}),(0,j.jsx)(p.Z.td,{className:"hidden lg:table-cell break-all",children:(0,j.jsx)("p",{title:e.table,className:"truncate",children:e.table})}),(0,j.jsx)(p.Z.td,{className:"hidden space-x-2 xl:table-cell",children:(0,j.jsx)("p",{title:e.function_name,className:"truncate",children:e.function_name})}),(0,j.jsx)(p.Z.td,{className:"hidden xl:table-cell",children:(0,j.jsx)("div",{className:"flex space-x-2",children:e.events.map(function(t){return(0,j.jsx)(T.Z,{children:"".concat(e.activation," ").concat(t)},t)})})}),(0,j.jsx)(p.Z.td,{className:"hidden xl:table-cell",children:(0,j.jsx)("div",{className:"flex items-center justify-center",children:"DISABLED"!==e.enabled_mode?(0,j.jsx)(_.Z,{strokeWidth:2,className:"text-brand"}):(0,j.jsx)(E.Z,{strokeWidth:2})})}),(0,j.jsx)(p.Z.td,{className:"text-right",children:!n&&(0,j.jsx)("div",{className:"flex items-center justify-end",children:o?(0,j.jsxs)(S.h_,{children:[(0,j.jsx)(S.$F,{children:(0,j.jsx)(u.z,{asChild:!0,type:"default",className:"px-1",icon:(0,j.jsx)(A.Z,{}),children:(0,j.jsx)("span",{})})}),(0,j.jsxs)(S.AW,{side:"bottom",align:"end",className:"w-36",children:[(0,j.jsxs)(S.Xi,{className:"space-x-2",onClick:function(){return i(e)},children:[(0,j.jsx)(O.Z,{size:"tiny"}),(0,j.jsx)("p",{children:"Edit trigger"})]}),(0,j.jsxs)(S.Xi,{className:"space-x-2",onClick:function(){return a(e)},children:[(0,j.jsx)(k.Z,{stroke:"red",size:"tiny"}),(0,j.jsx)("p",{children:"Delete trigger"})]})]})]}):(0,j.jsxs)(c.fC,{delayDuration:0,children:[(0,j.jsx)(c.xz,{asChild:!0,children:(0,j.jsx)(u.z,{disabled:!0,type:"default",icon:(0,j.jsx)(A.Z,{})})}),(0,j.jsx)(c.h_,{children:(0,j.jsxs)(c.VY,{side:"left",children:[(0,j.jsx)(c.Eh,{className:"radix-tooltip-arrow"}),(0,j.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,j.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to update triggers"})})]})})]})})})]},e.id)})})}),D=r(1846),C=(0,n.Pi)(function(e){var t=e.createTrigger,r=void 0===t?d.noop:t,n=e.editTrigger,a=void 0===n?d.noop:n,g=e.deleteTrigger,T=void 0===g?d.noop:g,_=(0,h.d2)().project,E=(0,Z.oR)().meta,S=(0,i.useState)("public"),A=S[0],O=S[1],k=(0,i.useState)(""),C=k[0],L=k[1],R=(0,w.Q1)({projectRef:null==_?void 0:_.ref,connectionString:null==_?void 0:_.connectionString}).data,z=(0,d.partition)(null!=R?R:[],function(e){var t;return y.F.includes(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"")}),F=(0,l.Z)(z,1)[0],X=null==R?void 0:R.find(function(e){return e.name===A}),I=F.some(function(e){return e.id===(null==X?void 0:X.id)}),Q=E.triggers.list(),W=(0,Z.Xo)(s.KA.TENANT_SQL_ADMIN_WRITE,"triggers");return E.triggers.isLoading?(0,j.jsx)(v.A,{}):E.triggers.hasError?(0,j.jsx)(b.Z,{error:E.triggers.error,subject:"Failed to retrieve database triggers"}):(0,j.jsx)(j.Fragment,{children:0==Q.length?(0,j.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,j.jsxs)(m.Z,{title:"Triggers",ctaButtonLabel:"Create a new trigger",onClickCta:function(){return r()},children:[(0,j.jsx)(f,{}),(0,j.jsx)("p",{className:"text-sm text-foreground-light",children:"A PostgreSQL trigger is a function invoked automatically whenever an event associated with a table occurs."}),(0,j.jsx)("p",{className:"text-sm text-foreground-light",children:"An event could be any of the following: INSERT, UPDATE, DELETE. A trigger is a special user-defined function associated with a table."})]})}):(0,j.jsxs)("div",{className:"w-full space-y-4",children:[(0,j.jsxs)("div",{className:"flex items-center justify-between",children:[(0,j.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,j.jsx)(N.Z,{className:"w-[260px]",size:"small",showError:!1,selectedSchemaName:A,onSelectSchema:O}),(0,j.jsx)(o.Z,{placeholder:"Search for a trigger",size:"small",icon:(0,j.jsx)(x.Z,{size:"tiny"}),value:C,className:"w-64",onChange:function(e){return L(e.target.value)}})]}),!I&&(0,j.jsxs)(c.fC,{delayDuration:0,children:[(0,j.jsx)(c.xz,{children:(0,j.jsx)(u.z,{disabled:!W,onClick:function(){return r()},children:"Create a new trigger"})}),!W&&(0,j.jsx)(c.h_,{children:(0,j.jsxs)(c.VY,{side:"bottom",children:[(0,j.jsx)(c.Eh,{className:"radix-tooltip-arrow"}),(0,j.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,j.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to create triggers"})})]})})]})]}),I&&(0,j.jsx)(D.Z,{schema:A,entity:"triggers"}),(0,j.jsx)(p.Z,{className:"table-fixed",head:(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(p.Z.th,{className:"space-x-4",children:"Name"},"name"),(0,j.jsx)(p.Z.th,{className:"hidden lg:table-cell",children:"Table"},"table"),(0,j.jsx)(p.Z.th,{className:"hidden xl:table-cell",children:"Function"},"function"),(0,j.jsx)(p.Z.th,{className:"hidden xl:table-cell",children:"Events"},"events"),(0,j.jsx)(p.Z.th,{className:"hidden w-20 xl:table-cell",children:"Enabled"},"enabled"),(0,j.jsx)(p.Z.th,{className:"w-1/12"},"buttons")]}),body:(0,j.jsx)(P,{schema:A,filterString:C,isLocked:I,editTrigger:a,deleteTrigger:T})})]})})}),L=r(11425),R=r(86866),z=r(48125),F=function(){var e=(0,Z.oR)(),t=e.meta,r=e.ui,n=(0,i.useState)(),l=n[0],c=n[1],d=(0,i.useState)(!1),o=d[0],x=d[1],u=(0,i.useState)(!1),h=u[0],g=u[1],f=(0,Z.Xo)(s.KA.TENANT_SQL_ADMIN_READ,"triggers");return((0,i.useEffect)(function(){r.selectedProjectRef&&t.triggers.load()},[r.selectedProjectRef]),f)?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(R._S,{children:(0,j.jsx)(R.jX,{children:(0,j.jsxs)("div",{className:"col-span-12",children:[(0,j.jsx)("h3",{className:"mb-4 text-xl text-foreground",children:"Database Triggers"}),(0,j.jsx)(C,{createTrigger:function(){c(void 0),x(!0)},editTrigger:function(e){c(e),x(!0)},deleteTrigger:function(e){c(e),g(!0)}})]})})}),(0,j.jsx)(a.RA,{trigger:l,visible:o,setVisible:x}),(0,j.jsx)(a.eX,{trigger:l,visible:h,setVisible:g})]}):(0,j.jsx)(z.Z,{isFullPage:!0,resourceText:"view database triggers"})};F.getLayout=function(e){return(0,j.jsx)(L._h,{title:"Database",children:e})};var X=(0,n.Pi)(F)},90464:function(e,t,r){"use strict";var s=r(95235);r(2784);var n=r(59330),i=r(12223),a=r(52322);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}t.Z=function(e){return(0,a.jsx)(i.Z,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach(function(t){(0,s.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({icon:n.Z},e))}},76846:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/database/triggers",function(){return r(78620)}])}},function(e){e.O(0,[6139,1187,8421,4747,7287,7898,6218,9001,2758,7610,3257,2514,2187,2645,6823,7725,7740,1414,655,9774,2888,179],function(){return e(e.s=76846)}),_N_E=e.O()}]);
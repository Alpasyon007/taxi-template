(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7831],{45363:function(e,n,s){"use strict";var t=s(2784),r=s(97346),a=s(51459),i=s(52322);n.Z=function(e){var n=e.commands;return(0,i.jsx)("div",{className:"space-y-4",children:n.map(function(e,n){return(0,i.jsx)(o,{item:e},"command-".concat(n))})})};var o=function(e){var n=e.item,s=(0,t.useState)(!1),o=s[0],l=s[1];return(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)("span",{className:"font-mono text-sm text-foreground-lighter",children:"> ".concat(n.comment)}),(0,i.jsx)("div",{className:"flex items-center gap-2",children:(0,i.jsxs)("div",{className:"flex gap-2 font-mono text-sm font-normal text-foreground",children:[(0,i.jsx)("span",{className:"text-foreground-lighter",children:"$"}),(0,i.jsxs)("span",{children:[(0,i.jsxs)("span",{className:"",children:[n.jsx?n.jsx():null," "]}),(0,i.jsx)("button",{type:"button",className:"text-foreground-lighter hover:text-foreground",onClick:function(){var e;e=n.command,l(!0),navigator.clipboard.writeText(e).then(),setTimeout(function(){l(!1)},3e3)},children:o?(0,i.jsx)("div",{className:"text-brand",children:(0,i.jsx)(r.Z,{size:14,strokeWidth:3})}):(0,i.jsx)("div",{className:"relative",children:(0,i.jsx)("div",{className:"block",children:(0,i.jsx)(a.Z,{size:14})})})})]})]})})]})}},64860:function(e,n,s){"use strict";s.r(n),s.d(n,{default:function(){return P}});var t=s(28879),r=s.n(t),a=s(46776),i=s(39097),o=s.n(i),l=s(2784),c=s(8647),d=s(95223),u=s(67270),m=s(14665),h=s(55210),x=s(24888),j=s(97064),g=s(55268),f=s(80188),p=s(22812),v=s(94170),b=function(e){var n=e.projectRef,s=e.connectionString,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,v.cp)({projectRef:n,connectionString:s,sql:"\n    select\n      *\n    from supabase_migrations.schema_migrations sm\n    order by sm.version desc\n  ".trim(),queryKey:["migrations"],handleError:function(e){if(e.message.includes('relation "supabase_migrations.schema_migrations" does not exist'))return{result:[]};throw e}},t)},N=s(6277),y=s(30265),w=s(92198),Z=s(59476),k=s(63060),_=s(43991),C=s(45363),S=s(52322),Y=function(){var e=(0,_.UO)().ref,n=(0,l.useState)(!1),s=n[0],t=n[1];return(0,S.jsx)("div",{className:"w-full px-12 py-12 bg-no-repeat border rounded bg-background border-default",children:(0,S.jsxs)("div",{className:"space-y-8",children:[(0,S.jsxs)("div",{className:"space-y-2 w-4/5",children:[(0,S.jsx)("h4",{className:"text-lg",children:"Database migrations"}),(0,S.jsx)("p",{className:"text-sm text-foreground-light",children:'Database changes are managed through "migrations" and they are a common way of tracking changes to your database over time. You can run migrations against your project\'s database via the Supabase CLI.'})]}),(0,S.jsxs)(y.ZP,{open:s,onOpenChange:t,children:[(0,S.jsx)(y.ZP.Trigger,{asChild:!0,children:(0,S.jsx)("button",{type:"button",className:(0,N.default)("flex w-full items-center justify-between rounded py-3 px-6 text-foreground border bg-surface-100",s&&"rounded-b-none"),children:(0,S.jsxs)("div",{className:"flex items-center justify-between gap-3 w-full",children:[(0,S.jsxs)("div",{className:"flex items-center gap-3",children:[(0,S.jsx)("div",{className:"flex items-center justify-center w-8 h-8 p-2 border rounded bg-alternative",children:(0,S.jsx)(w.Z,{strokeWidth:2})}),(0,S.jsx)("h4",{children:"Terminal instructions"})]}),s?(0,S.jsx)(Z.Z,{className:"text-border-stronger transition data-open-parent:rotate-0 data-closed-parent:rotate-180",strokeWidth:2,width:14}):(0,S.jsx)(k.Z,{className:"text-border-stronger transition data-open-parent:rotate-0 data-closed-parent:rotate-180",strokeWidth:2,width:14})]})})}),(0,S.jsx)(y.ZP.Content,{children:(0,S.jsx)("div",{className:"border border-t-0 bg-surface-100 rounded-b py-3 px-6",children:(0,S.jsx)(C.Z,{commands:[{comment:"Link your project",command:"supabase link --project-ref ".concat(e),jsx:function(){return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("span",{className:"text-brand-600",children:"supabase"})," link --project-ref ",e]})}},{comment:'Create a new migration called "new-migration"',command:"supabase migration new new-migration",jsx:function(){return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("span",{className:"text-brand-600",children:"supabase"})," migration new new-migration"]})}},{comment:"Run all migrations against this project",command:"supabase db push",jsx:function(){return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("span",{className:"text-brand-600",children:"supabase"})," db push"]})}}]})})})]})]})})},z=(0,a.Pi)(function(){var e,n,s,t,a,i=(0,l.useState)(""),v=i[0],N=i[1],y=(0,l.useState)(),w=y[0],Z=y[1],k=(0,j.d2)().project,_=b({projectRef:null==k?void 0:k.ref,connectionString:null==k?void 0:k.connectionString}),C=_.data,z=_.isLoading,D=_.isSuccess,E=_.isError,M=_.error,P=0===v.length?null!==(e=null==C?void 0:C.result)&&void 0!==e?e:[]:null!==(n=null==C?void 0:C.result.filter(function(e){var n;return e.version.includes(v)||(null===(n=e.name)||void 0===n?void 0:n.includes(v))}))&&void 0!==n?n:[];return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("div",{children:[(0,S.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,S.jsxs)("div",{children:[(0,S.jsx)("h3",{className:"mb-1 text-xl text-foreground",children:"Database Migrations"}),(0,S.jsx)("div",{className:"text-sm text-foreground-lighter",children:"History of migrations that have been run on your database"})]}),(0,S.jsx)("div",{className:"flex items-center space-x-2",children:(0,S.jsx)(c.z,{asChild:!0,type:"default",icon:(0,S.jsx)(d.Z,{strokeWidth:1.5}),children:(0,S.jsx)(o(),{href:"https://supabase.com/docs/guides/getting-started/local-development#database-migrations",target:"_blank",rel:"noreferrer",children:"Documentation"})})})]}),z&&(0,S.jsxs)("div",{className:"space-y-2",children:[(0,S.jsx)(p.Z,{}),(0,S.jsx)(p.Z,{className:"w-3/4"}),(0,S.jsx)(p.Z,{className:"w-1/2"})]}),(0,S.jsxs)("div",{children:[E&&(0,S.jsxs)(u.b,{withIcon:!0,variant:"warning",title:"Failed to retrieve migration history for database",actions:[(0,S.jsx)(c.z,{asChild:!0,type:"default",className:"ml-4",children:(0,S.jsx)(o(),{href:"/support/new?ref=".concat(null==k?void 0:k.ref,"&category=dashboard_bug&subject=Unable%20to%20view%20database%20migrations"),children:"Contact support"})},"contact-support")],children:[(0,S.jsx)("p",{className:"mb-1",children:"Try refreshing your browser, but if the issue persists, please reach out to us via support."}),(0,S.jsxs)("p",{children:["Error: ",null!==(s=null==M?void 0:M.message)&&void 0!==s?s:"Unknown"]})]}),D&&(0,S.jsxs)("div",{children:[C.result.length<=0&&(0,S.jsx)(Y,{}),C.result.length>0&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{className:"w-80 mb-4",children:(0,S.jsx)(m.Z,{size:"small",placeholder:"Search for a migration",value:v,onChange:function(e){return N(e.target.value)},icon:(0,S.jsx)(h.Z,{size:"tiny"})})}),(0,S.jsx)(g.Z,{head:[(0,S.jsx)(g.Z.th,{style:{width:"180px"},children:"Version"},"version"),(0,S.jsx)(g.Z.th,{children:"Name"},"version"),(0,S.jsx)(g.Z.th,{children:"Inserted at (UTC)"},"version"),(0,S.jsx)(g.Z.th,{},"buttons")],body:P.length>0?P.map(function(e){var n,s,t=r()(e.version,"YYYYMMDDHHmmss").format("DD MMM YYYY, HH:mm:ss");return(0,S.jsxs)(g.Z.tr,{children:[(0,S.jsx)(g.Z.td,{children:e.version}),(0,S.jsx)(g.Z.td,{className:0===(null!==(n=null==e?void 0:e.name)&&void 0!==n?n:"").length?"!text-foreground-lighter":"",children:null!==(s=null==e?void 0:e.name)&&void 0!==s?s:"Name not available"}),(0,S.jsx)(g.Z.td,{children:t}),(0,S.jsx)(g.Z.td,{align:"right",children:(0,S.jsx)(c.z,{type:"default",onClick:function(){return Z(e)},children:"View migration SQL"})})]},e.version)}):(0,S.jsx)(g.Z.tr,{children:(0,S.jsxs)(g.Z.td,{colSpan:3,children:[(0,S.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,S.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',v,'" did not return any results']})]})})})]})]})]})]}),(0,S.jsx)(x.ZP,{size:"large",visible:void 0!==w,header:"Migration: ".concat(null==w?void 0:w.version),onCancel:function(){return Z(void 0)},customFooter:(0,S.jsx)("div",{className:"flex items-center justify-end p-4 border-t border-overlay-border",children:(0,S.jsx)(c.z,{type:"default",onClick:function(){return Z(void 0)},children:"Close"})}),children:(0,S.jsx)("div",{className:"h-full",children:(0,S.jsx)("div",{className:"relative h-full",children:(0,S.jsx)(f.ZP,{isReadOnly:!0,id:null!==(t=null==w?void 0:w.version)&&void 0!==t?t:"",language:"pgsql",defaultValue:null==w?void 0:null===(a=w.statements)||void 0===a?void 0:a.join("\n")})})})})]})}),D=s(11425),E=s(86866),M=function(){return(0,S.jsx)(E._S,{children:(0,S.jsx)(E.jX,{children:(0,S.jsx)("div",{className:"col-span-12",children:(0,S.jsx)(z,{})})})})};M.getLayout=function(e){return(0,S.jsx)(D._h,{title:"Migrations",children:e})};var P=M},93483:function(e,n,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/database/migrations",function(){return s(64860)}])}},function(e){e.O(0,[1187,8421,4747,7287,7898,6218,2514,2187,2645,6823,7725,9774,2888,179],function(){return e(e.s=93483)}),_N_E=e.O()}]);
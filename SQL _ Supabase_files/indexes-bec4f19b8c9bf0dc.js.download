(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6796],{19361:function(e,n,t){"use strict";t.d(n,{K:function(){return i}});var a=t(94170),s=function(e,n){var t=[];e&&t.push("tablename = '".concat(e,"'")),n&&t.push("schemaname = '".concat(n,"'"));var a=t.length>0?"WHERE ".concat(t.join(" AND ")):"";return"\n  \n  SELECT\n    tbl.schemaname,\n    tbl.tablename,\n    tbl.quoted_name,\n    tbl.is_table,\n    json_agg(a) as columns\n  FROM\n    (\n      SELECT\n        n.nspname as schemaname,\n        c.relname as tablename,\n        (quote_ident(n.nspname) || '.' || quote_ident(c.relname)) as quoted_name,\n        true as is_table\n      FROM\n        pg_catalog.pg_class c\n        JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace\n      WHERE\n        c.relkind = 'r'\n        AND n.nspname not in ('information_schema', 'pg_catalog', 'pg_toast')\n        AND n.nspname not like 'pg_temp_%'\n        AND n.nspname not like 'pg_toast_temp_%'\n        AND has_schema_privilege(n.oid, 'USAGE') = true\n        AND has_table_privilege(quote_ident(n.nspname) || '.' || quote_ident(c.relname), 'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER') = true\n      union all\n      SELECT\n        n.nspname as schemaname,\n        c.relname as tablename,\n        (quote_ident(n.nspname) || '.' || quote_ident(c.relname)) as quoted_name,\n        false as is_table\n      FROM\n        pg_catalog.pg_class c\n        JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace\n      WHERE\n        c.relkind in ('v', 'm')\n        AND n.nspname not in ('information_schema', 'pg_catalog', 'pg_toast')\n        AND n.nspname not like 'pg_temp_%'\n        AND n.nspname not like 'pg_toast_temp_%'\n        AND has_schema_privilege(n.oid, 'USAGE') = true\n        AND has_table_privilege(quote_ident(n.nspname) || '.' || quote_ident(c.relname), 'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER') = true\n    ) as tbl\n    LEFT JOIN (\n      SELECT\n        attrelid,\n        attname,\n        format_type(atttypid, atttypmod) as data_type,\n        attnum,\n        attisdropped\n      FROM\n        pg_attribute\n    ) as a ON (\n      a.attrelid = tbl.quoted_name::regclass\n      AND a.attnum > 0\n      AND NOT a.attisdropped\n      AND has_column_privilege(tbl.quoted_name, a.attname, 'SELECT, INSERT, UPDATE, REFERENCES')\n    )\n  ".concat(a,"\n  GROUP BY schemaname, tablename, quoted_name, is_table;\n").trim()},i=function(e){var n=e.projectRef,t=e.connectionString,i=e.table,r=e.schema,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.cp)({projectRef:n,connectionString:t,sql:s(i,r),queryKey:["table-columns",r,i]},c)}},20443:function(e,n,t){"use strict";t.d(n,{r:function(){return h}});var a=t(20406),s=t(95235),i=t(82269),r=t(28526),c=t.n(r),l=t(62202),o=t(62350),d=t(94170),u=["onSuccess","onError"];function m(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,a)}return t}var h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.onSuccess,t=e.onError,r=(0,i.Z)(e,u);return(0,o.D)(function(e){return(0,d.Rj)(e)},function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?m(Object(t),!0).forEach(function(n){(0,s.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):m(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}({onSuccess:function(e,t,s){return(0,a.Z)(c().mark(function a(){return c().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,null==n?void 0:n(e,t,s);case 2:case"end":return a.stop()}},a)}))()},onError:function(e,n,s){return(0,a.Z)(c().mark(function a(){return c().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:void 0===t?l.Am.error("Failed to execute SQL: ".concat(e.message)):t(e,n,s);case 1:case"end":return a.stop()}},a)}))()}},r))}},80866:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return B}});var a=t(81333),s=t(46776),i=t(39097),r=t.n(i),c=t(2784),l=t(8647),o=t(95223),d=t(23733),u=t(14665),m=t(55210),h=t(77426),p=t(24888),x=t(36849),f=t(25208),g=t(35981),j=t(97064),v=t(55268),b=t(45812),N=t(80188),S=t(13734),E=t(22812),_=t(94170),y=function(e){var n=e.schema;return'\nSELECT schemaname as "schema",\n  tablename as "table",\n  indexname as "name",\n  indexdef as "definition"\nFROM pg_indexes\nWHERE schemaname = \''.concat(n,"';\n").trim()},Z=function(e){var n=e.schema,t=e.projectRef,a=e.connectionString,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,_.cp)({projectRef:t,connectionString:a,sql:y({schema:n}),queryKey:["indexes",n]},s)},C=t(59800),R=t(20443),O=t(70203),T=t(20406),w=t(28526),q=t.n(w),P=t(31786),D=t(73564),k=t(19361),F=t(1740),A=[{name:"B-Tree",value:"btree",description:"For querying data with equality or range conditions on columns.\nThis is the default index type that Postgres uses."},{name:"Hash",value:"hash",description:"For querying exact matches on columns"},{name:"GiST",value:"gist",description:"For querying complex data types or custom-defined operators"},{name:"SP-GiST",value:"spgist",description:"Similar to GiST, but is more specialized and customizable"},{name:"GIN",value:"gin",description:"For querying multi-valued data such as arrays or full-text search scenarios"},{name:"BRIN",value:"brin",description:"For querying large tables with sorted data"}],L=t(52322),z=function(e){var n,t,a,s=e.visible,i=e.onClose,o=(0,O.oR)().ui,d=(0,j.d2)().project,m=(0,c.useState)("public"),h=m[0],x=m[1],f=(0,c.useState)("---"),g=f[0],v=f[1],b=(0,c.useState)([]),S=b[0],_=b[1],y=(0,c.useState)(A[0].value),w=y[0],z=y[1],I=Z({schema:h,projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString}).refetch,G=(0,C.Q1)({projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString}).data,U=(0,F.H)({schema:h,sort:"alphabetical",search:void 0,projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString},{keepPreviousData:!0}).data,W=(0,k.K)({schema:h,table:g,projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString}),M=W.data,H=W.isLoading,Q=W.isSuccess,X=(0,R.r)({onSuccess:(n=(0,T.Z)(q().mark(function e(){return q().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I();case 2:i(),o.setNotification({category:"success",message:"Successfully created index"});case 4:case"end":return e.stop()}},e)})),function(){return n.apply(this,arguments)}),onError:function(e){o.setNotification({error:e,category:"error",message:"Failed to create index: ".concat(e.message)})}}),B=X.mutate,K=X.isLoading,J=(0,c.useMemo)(function(){return(null==U?void 0:U.pages.flatMap(function(e){return e.data.entities}))||[]},[null==U?void 0:U.pages]),V=(null!==(t=null==M?void 0:null===(a=M.result[0])||void 0===a?void 0:a.columns)&&void 0!==t?t:[]).map(function(e){return{id:e.attname,value:e.attname,name:e.attname,disabled:!1}}),Y='\nCREATE INDEX ON "'.concat(h,'"."').concat(g,'" USING ').concat(w," (").concat(S.join(", "),");\n").trim(),$=function(){if(!d)return console.error("Project is required");B({projectRef:d.ref,connectionString:d.connectionString,sql:Y})};return(0,c.useEffect)(function(){s&&(x("public"),v("---"),_([]),z(A[0].value))},[s]),(0,c.useEffect)(function(){v("---"),_([]),z(A[0].value)},[h]),(0,c.useEffect)(function(){_([]),z(A[0].value)},[g]),(0,L.jsx)(p.ZP,{size:"large",header:"Create new index",visible:s,onCancel:i,onConfirm:function(){return $()},loading:K,confirmText:"Create index",children:(0,L.jsxs)("div",{className:"py-6 space-y-6",children:[(0,L.jsxs)(p.ZP.Content,{className:"space-y-6",children:[(0,L.jsx)(P.Z,{size:"small",label:"Select a schema",value:h,onChange:x,children:(null!=G?G:[]).map(function(e){return(0,L.jsx)(P.Z.Option,{value:e.name,label:e.name,children:e.name},e.name)})}),0===J.length?(0,L.jsxs)("div",{className:"space-y-2",children:[(0,L.jsx)("p",{className:"text-sm text-foreground-light leading-4",children:"Select a table"}),(0,L.jsx)(u.Z,{disabled:!0,placeholder:"No tables available in schema",descriptionText:"Create a table in this schema via the Table or SQL editor first"})]}):(0,L.jsxs)(P.Z,{size:"small",label:"Select a table",value:g,onChange:v,children:[(0,L.jsx)(P.Z.Option,{value:"---",label:"---",children:"---"},"default-option-table"),(null!=J?J:[]).map(function(e){return(0,L.jsx)(P.Z.Option,{value:e.name,label:e.name,children:e.name},e.name)})]}),"---"!==g&&(0,L.jsxs)("div",{children:[(0,L.jsx)("p",{className:"text-sm text-foreground-light mb-2",children:"Select up to 32 columns"}),H&&(0,L.jsx)(E.Z,{className:"py-4"}),Q&&(0,L.jsx)(D.Z,{options:V,placeholder:"",searchPlaceholder:"Search for a column",value:S,onChange:_})]})]}),S.length>0&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(p.ZP.Separator,{}),(0,L.jsx)(p.ZP.Content,{className:"space-y-6",children:(0,L.jsx)(P.Z,{size:"small",label:"Select an index type",value:w,onChange:z,children:A.map(function(e){return(0,L.jsxs)(P.Z.Option,{value:e.value,label:e.name,children:[(0,L.jsx)("p",{children:e.name}),e.description.split("\n").map(function(n,t){return(0,L.jsx)("p",{children:n},"".concat(e.value,"-description-").concat(t))})]},e.name)})})}),(0,L.jsx)(p.ZP.Separator,{}),(0,L.jsx)(p.ZP.Content,{children:(0,L.jsxs)("div",{className:"flex items-center justify-between",children:[(0,L.jsx)("p",{className:"text-sm",children:"Preview of SQL statement"}),(0,L.jsx)(l.z,{asChild:!0,type:"default",children:(0,L.jsx)(r(),{href:void 0!==d?"/project/".concat(d.ref,"/sql/new?content=").concat(Y):"/",children:"Open in SQL Editor"})})]})}),(0,L.jsx)("div",{className:"h-[200px] !mt-2",children:(0,L.jsx)("div",{className:"relative h-full",children:(0,L.jsx)(N.ZP,{isReadOnly:!0,autofocus:!1,id:"".concat(h,"-").concat(g,"-").concat(S.join(","),"-").concat(w),language:"pgsql",defaultValue:Y})})})]})]})})},I=t(19269),G=t(76635),U=t(85459),W=t(1846),M=(0,s.Pi)(function(){var e,n,t,s=(0,O.oR)().ui,i=(0,c.useState)(""),_=i[0],y=i[1],T=(0,c.useState)("public"),w=T[0],q=T[1],P=(0,c.useState)(!1),D=P[0],k=P[1],F=(0,c.useState)(),A=F[0],M=F[1],H=(0,c.useState)(),Q=H[0],X=H[1],B=(0,j.d2)().project,K=Z({schema:w,projectRef:null==B?void 0:B.ref,connectionString:null==B?void 0:B.connectionString}),J=K.data,V=K.refetch,Y=K.error,$=K.isLoading,ee=K.isSuccess,en=K.isError,et=(0,C.Q1)({projectRef:null==B?void 0:B.ref,connectionString:null==B?void 0:B.connectionString}),ea=et.data,es=et.isLoading,ei=et.isSuccess,er=et.isError,ec=(0,R.r)({onSuccess:function(){V(),X(void 0),s.setNotification({category:"success",message:"Successfully deleted index"})},onError:function(e){s.setNotification({error:e,category:"error",message:"Failed to delete index: ".concat(e.message)})}}),el=ec.mutate,eo=ec.isLoading,ed=(0,G.partition)(null!=ea?ea:[],function(e){var n;return U.F.includes(null!==(n=null==e?void 0:e.name)&&void 0!==n?n:"")}),eu=(0,a.Z)(ed,1)[0],em=null==ea?void 0:ea.find(function(e){return e.name===w}),eh=eu.some(function(e){return e.id===(null==em?void 0:em.id)}),ep=(null!==(e=null==J?void 0:J.result)&&void 0!==e?e:[]).sort(function(e,n){return e.table.localeCompare(n.table)||e.name.localeCompare(n.name)}),ex=_.length>0?ep.filter(function(e){return e.name.includes(_)||e.table.includes(_)}):ep,ef=function(e){if(!B)return console.error("Project is required");el({projectRef:B.ref,connectionString:B.connectionString,sql:'drop index if exists "'.concat(e.name,'"')})};return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{className:"pb-8",children:[(0,L.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,L.jsxs)("div",{className:"space-y-1",children:[(0,L.jsx)("h3",{className:"text-xl text-foreground",children:"Database Indexes"}),(0,L.jsx)("div",{className:"text-sm text-foreground-lighter",children:"Improve query performance against your database"})]}),(0,L.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,L.jsx)(l.z,{asChild:!0,type:"default",icon:(0,L.jsx)(o.Z,{strokeWidth:1.5}),children:(0,L.jsx)(r(),{href:"https://supabase.com/docs/guides/database/query-optimization",target:"_blank",rel:"noreferrer",children:"Documentation"})}),(0,L.jsx)(l.z,{asChild:!0,type:"default",icon:(0,L.jsx)(o.Z,{strokeWidth:1.5}),children:(0,L.jsx)(r(),{href:"https://supabase.com/docs/guides/database/extensions/index_advisor",target:"_blank",rel:"noreferrer",children:"Optimization with index_advisor"})})]})]}),(0,L.jsxs)("div",{className:"flex flex-col gap-y-4",children:[(0,L.jsxs)("div",{className:"flex items-center justify-between",children:[(0,L.jsxs)("div",{className:"flex items-center space-x-2",children:[es&&(0,L.jsx)(E.Z,{className:"w-[260px]"}),er&&(0,L.jsxs)("div",{className:"w-[260px] text-foreground-light text-sm border px-3 py-1.5 rounded flex items-center space-x-2",children:[(0,L.jsx)(d.Z,{strokeWidth:2,size:16}),(0,L.jsx)("p",{children:"Failed to load schemas"})]}),ei&&(0,L.jsx)(I.Z,{className:"w-[260px]",size:"small",showError:!1,selectedSchemaName:w,onSelectSchema:q}),(0,L.jsx)(u.Z,{size:"small",value:_,className:"w-64",onChange:function(e){return y(e.target.value)},placeholder:"Search for an index",icon:(0,L.jsx)(m.Z,{size:14})})]}),!eh&&(0,L.jsx)(l.z,{type:"primary",onClick:function(){return k(!0)},disabled:!ei,children:"Create index"})]}),eh&&(0,L.jsx)(W.Z,{schema:w,entity:"indexes"}),$&&(0,L.jsx)(E.A,{}),en&&(0,L.jsx)(b.Z,{error:Y,subject:"Failed to retrieve database indexes"}),ee&&(0,L.jsx)(v.Z,{head:[(0,L.jsx)(v.Z.th,{children:"Schema"},"schema"),(0,L.jsx)(v.Z.th,{children:"Table"},"table"),(0,L.jsx)(v.Z.th,{children:"Name"},"name"),(0,L.jsx)(v.Z.th,{},"buttons")],body:(0,L.jsxs)(L.Fragment,{children:[0===ep.length&&0===_.length&&(0,L.jsx)(v.Z.tr,{children:(0,L.jsxs)(v.Z.td,{colSpan:4,children:[(0,L.jsx)("p",{className:"text-sm text-foreground",children:"No indexes created yet"}),(0,L.jsxs)("p",{className:"text-sm text-foreground-light",children:['There are no indexes found in the schema "',w,'"']})]})}),0===ep.length&&_.length>0&&(0,L.jsx)(v.Z.tr,{children:(0,L.jsxs)(v.Z.td,{colSpan:4,children:[(0,L.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,L.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',_,'" did not return any results']})]})}),ex.length>0&&ex.map(function(e){return(0,L.jsxs)(v.Z.tr,{children:[(0,L.jsx)(v.Z.td,{children:(0,L.jsx)("p",{title:e.schema,children:e.schema})}),(0,L.jsx)(v.Z.td,{children:(0,L.jsx)("p",{title:e.table,children:e.table})}),(0,L.jsx)(v.Z.td,{children:(0,L.jsx)("p",{title:e.name,children:e.name})}),(0,L.jsx)(v.Z.td,{children:(0,L.jsxs)("div",{className:"flex justify-end items-center space-x-2",children:[(0,L.jsx)(l.z,{type:"default",onClick:function(){return M(e)},children:"View definition"}),!eh&&(0,L.jsx)(l.z,{type:"text",className:"px-1",icon:(0,L.jsx)(h.Z,{}),onClick:function(){return X(e)}})]})})]},e.name)})]})})]})]}),(0,L.jsx)(p.ZP,{size:"xlarge",visible:void 0!==A,header:(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("span",{children:"Index:"}),(0,L.jsx)("code",{className:"text-sm ml-2",children:null==A?void 0:A.name})]}),onCancel:function(){return M(void 0)},children:(0,L.jsx)("div",{className:"h-full",children:(0,L.jsx)("div",{className:"relative h-full",children:(0,L.jsx)(N.ZP,{isReadOnly:!0,id:null!==(n=null==A?void 0:A.name)&&void 0!==n?n:"",language:"pgsql",defaultValue:null!==(t=null==A?void 0:A.definition)&&void 0!==t?t:""})})})}),(0,L.jsx)(z,{visible:D,onClose:function(){return k(!1)}}),(0,L.jsx)(S.Z,{danger:!0,size:"medium",loading:eo,visible:void 0!==Q,header:(0,L.jsxs)(L.Fragment,{children:["Confirm to delete index ",(0,L.jsx)("code",{className:"text-sm",children:null==Q?void 0:Q.name})]}),buttonLabel:"Confirm delete",buttonLoadingLabel:"Deleting...",onSelectConfirm:function(){return void 0!==Q?ef(Q):{}},onSelectCancel:function(){return X(void 0)},children:(0,L.jsx)(x.C.Content,{children:(0,L.jsxs)("div",{className:"py-6",children:[(0,L.jsxs)(f.bZ,{variant:"warning",children:[(0,L.jsx)(g.Z,{strokeWidth:2}),(0,L.jsx)(f.Cd,{children:"This action cannot be undone"}),(0,L.jsx)(f.X,{children:"Deleting an index that is still in use will cause queries to slow down, and in some cases causing significant performance issues."})]}),(0,L.jsx)("ul",{className:"mt-4 space-y-5",children:(0,L.jsx)("li",{className:"flex gap-3",children:(0,L.jsxs)("div",{children:[(0,L.jsx)("strong",{className:"text-sm",children:"Before deleting this index, consider:"}),(0,L.jsxs)("ul",{className:"space-y-2 mt-2 text-sm text-foreground-light",children:[(0,L.jsx)("li",{className:"list-disc ml-6",children:"This index is no longer in use"}),(0,L.jsx)("li",{className:"list-disc ml-6",children:"The table which the index is on is not currently in use, as dropping an index requires a short exclusive access lock on the table."})]})]})})})]})})})]})}),H=t(11425),Q=t(86866),X=function(){return(0,L.jsx)(Q._S,{children:(0,L.jsx)(Q.jX,{children:(0,L.jsx)("div",{className:"col-span-12",children:(0,L.jsx)(M,{})})})})};X.getLayout=function(e){return(0,L.jsx)(H._h,{title:"Indexes",children:e})};var B=X},11580:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/database/indexes",function(){return t(80866)}])}},function(e){e.O(0,[1187,8421,4747,7287,7898,6218,2514,2187,2645,6823,7725,9774,2888,179],function(){return e(e.s=11580)}),_N_E=e.O()}]);
"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7740],{94035:function(e,n,r){r.d(n,{C:function(){return E}});var t=r(20406),o=r(95235),s=r(28526),i=r.n(s),c=r(59491),a=r(2784),l=r(14665),u=r(86756),d=r(97064),p=r(27053),f=r(45812),m=r(61740),h=r(45008),b=r(22812),g=r(75332),x=r(82269),j=r(55830),v=r(62350),y=r(62202),_=r(81229),O=r(57083),w=["onSuccess","onError"];function N(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,t)}return r}function P(){return(P=(0,t.Z)(i().mark(function e(n){var r,t,o,s,c,a,l,u,d;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.ref,t=n.pgbouncer_enabled,o=n.ignore_startup_parameters,s=n.pool_mode,c=n.default_pool_size,a=n.max_client_conn,r){e.next=3;break}return e.abrupt("return",console.error("Project ref is required"));case 3:return e.next=5,(0,_.r$)("/platform/projects/{ref}/config/pgbouncer",{params:{path:{ref:r}},body:{pgbouncer_enabled:t,default_pool_size:c,ignore_startup_parameters:o,pool_mode:s,max_client_conn:a}});case 5:if(u=(l=e.sent).data,!(d=l.error)){e.next=10;break}throw d;case 10:return e.abrupt("return",u);case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}var Z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.onSuccess,r=e.onError,s=(0,x.Z)(e,w),c=(0,j.NL)();return(0,v.D)(function(e){return function(e){return P.apply(this,arguments)}(e)},function(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?N(Object(r),!0).forEach(function(n){(0,o.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}({onSuccess:function(e,r,o){return(0,t.Z)(i().mark(function t(){var s;return i().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s=r.ref,t.next=3,c.invalidateQueries(O.A.poolingConfiguration(s));case 3:return t.next=5,null==n?void 0:n(e,r,o);case 5:case"end":return t.stop()}},t)}))()},onError:function(e,n,o){return(0,t.Z)(i().mark(function t(){return i().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:void 0===r?y.Am.error("Failed to update pooling configuration: ".concat(e.message)):r(e,n,o);case 1:case"end":return t.stop()}},t)}))()}},s))},S=r(70203),C=r(210),k=r(52322);function D(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,t)}return r}var E=function(){var e,n=(0,d.d2)().project,r=null!==(e=null==n?void 0:n.ref)&&void 0!==e?e:"default",t=(0,g.Ys)({projectRef:r}),o=t.data,s=t.error,i=t.isLoading,c=t.isError,l=t.isSuccess,u=l?(0,C.Ff)(o,["db_host","db_name","db_port","db_user","inserted_at"]):{},p=l?(0,C.Ff)(o,["default_pool_size","ignore_startup_parameters","pool_mode","pgbouncer_enabled","supavisor_enabled","max_client_conn","connectionString"]):{};return(0,k.jsxs)(k.Fragment,{children:[i&&(0,k.jsx)(h.Z,{title:(0,k.jsx)("h5",{className:"mb-0",children:"Connection Pooling"},"panel-title"),children:(0,k.jsxs)(h.Z.Content,{className:"space-y-8",children:[Array.from({length:5}).map(function(e,n){return(0,k.jsxs)(a.Fragment,{children:[(0,k.jsxs)("div",{className:"grid gap-2 items-center md:grid md:grid-cols-12 md:gap-x-4 w-full",children:[(0,k.jsx)(b.Z,{className:"h-4 w-1/3 col-span-4",delayIndex:n}),(0,k.jsx)(b.Z,{className:"h-8 w-full col-span-8",delayIndex:n})]}),(0,k.jsx)(m.Z,{light:!0})]},n)}),(0,k.jsx)(b.Z,{className:"h-8 w-full"})]})}),c&&(0,k.jsx)("div",{className:"p-4",children:(0,k.jsx)(f.Z,{error:s,subject:"Failed to retrieve pooling configuration"})}),l&&(0,k.jsx)(k.Fragment,{children:null!=o&&o.pgbouncer_enabled||(null==o?void 0:o.pool_mode)!==null?(0,k.jsx)(z,{projectRef:r,bouncerInfo:p,connectionInfo:u}):(0,k.jsx)(h.Z,{title:(0,k.jsx)("h5",{className:"mb-0",children:"Connection Pooling is not available for this project"},"panel-title"),children:(0,k.jsx)(h.Z.Content,{children:(0,k.jsx)("p",{className:"text-foreground-light",children:"Please start a new project to enable this feature."})})})})]})},z=function(e){var n,r=e.projectRef,s=e.bouncerInfo,f=e.connectionInfo,h=(0,S.oR)().ui,b=(0,d.d2)().project,g=(0,a.useState)({pool_mode:s.pool_mode||"transaction",default_pool_size:s.default_pool_size||void 0,ignore_startup_parameters:s.ignore_startup_parameters||"",pgbouncer_enabled:s.pgbouncer_enabled,max_client_conn:s.max_client_conn||void 0}),x=g[0],j=g[1],v=Z({onSuccess:function(e){j(function(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?D(Object(r),!0).forEach(function(n){(0,o.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}({},e)),h.setNotification({category:"success",message:"Successfully saved settings"})}}),y=v.mutateAsync,_=v.isLoading,O=(0,S.Xo)(c.KA.UPDATE,"projects",{resource:{project_id:null==b?void 0:b.id}}),w=(n=(0,t.Z)(i().mark(function e(n){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y({ref:r,pgbouncer_enabled:n.pgbouncer_enabled,default_pool_size:n.default_pool_size,ignore_startup_parameters:n.ignore_startup_parameters,pool_mode:n.pool_mode,max_client_conn:n.max_client_conn});case 3:return e.prev=3,e.finish(3);case 5:case"end":return e.stop()}},e,null,[[0,,3,5]])})),function(e){return n.apply(this,arguments)});return(0,k.jsx)("div",{id:"connection-pooling",children:(0,k.jsx)(p.Z,{title:"Connection Pooling Custom Configuration",schema:{properties:{pool_mode:{title:"Pool Mode",type:"string",options:[{label:"Transaction",value:"transaction"},{label:"Session",value:"session"}]},ignore_startup_parameters:{title:"Ignore Startup Parameters",type:"string",help:'Defaults are either blank or "extra_float_digits"'},max_client_conn:{title:"Max Client Connections",oneOf:[{type:"integer"},{type:"null"}],help:"The maximum number of concurrent client connections allowed. Overrides default optimizations; refer to https://supabase.com/docs/guides/platform/custom-postgres-config#pooler-config"},default_pool_size:{title:"Default Pool Size",oneOf:[{type:"integer"},{type:"null"}],help:"The maximum number of connections made to the underlying Postgres cluster, per user+db combination. Overrides default optimizations; refer to https://supabase.com/docs/guides/platform/custom-postgres-config#pooler-config"}},required:["pool_mode"],type:"object"},model:x,submitLabel:"Save",cancelLabel:"Cancel",loading:_,onChangeModel:function(e){return j(e)},onSubmit:function(e){return w(e)},onReset:function(){return j(s)},disabled:!O,disabledMessage:"You need additional permissions to update connection pooling settings",children:(0,k.jsxs)("div",{className:"space-y-6 py-4",children:[s.pgbouncer_enabled&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(u.Z,{name:"pool_mode",showInlineError:!0,errorMessage:"You must select one of the two options"}),(0,k.jsx)("div",{className:"!mt-1 flex",style:{marginLeft:"calc(33% + 0.5rem)"},children:(0,k.jsxs)("p",{className:"text-sm text-foreground-lighter",children:["Specify when a connection can be returned to the pool. To find out the most suitable mode for your use case,"," ",(0,k.jsx)("a",{className:"text-green-900",target:"_blank",rel:"noreferrer",href:"https://supabase.com/docs/guides/database/connecting-to-postgres#connection-pool",children:"click here"}),"."]})}),!s.supavisor_enabled&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(m.Z,{light:!0}),(0,k.jsx)(u.Z,{name:"ignore_startup_parameters"}),(0,k.jsx)(m.Z,{light:!0}),(0,k.jsx)(u.Z,{name:"max_client_conn"})]}),(0,k.jsx)(m.Z,{light:!0}),(0,k.jsx)(u.Z,{name:"default_pool_size"})]}),(0,k.jsx)(m.Z,{light:!0}),(0,k.jsx)(l.Z,{className:"input-mono",layout:"horizontal",readOnly:!0,copy:!0,disabled:!0,value:f.db_port,label:"Port"}),(0,k.jsx)(m.Z,{light:!0}),(0,k.jsx)(l.Z,{className:"input-mono",layout:"vertical",readOnly:!0,copy:!0,disabled:!0,label:"Connection string",value:s.connectionString})]})})})}},27053:function(e,n,r){r.d(n,{Z:function(){return v}});var t=r(20406),o=r(28526),s=r.n(o),i=r(2784),c=r(8647),a=r(81333),l=r(95235),u=r(44709),d=r(1581),p=r.n(d),f=r(39123),m=r(52322);function h(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,t)}return r}var b=function(e){var n=e.schema,r=e.model,t=e.disabled,o=e.children,s=e.formRef,i=e.onSubmit,c=e.onChangeModel,a=new f.j(n,x(n));return(0,m.jsx)(u.Z,{disabled:void 0!==t&&t,onChangeModel:void 0===c?function(){}:c,ref:s,schema:a,onSubmit:i,submitField:function(){return(0,m.jsx)(m.Fragment,{})},model:r,children:o})},g=new(p())({strict:!1,allErrors:!0,useDefaults:!0});g=g.addFormat("absolute-url","^(http://|https://)");var x=function(e){var n=g.compile(e);return function(r){var t=function(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?h(Object(r),!0).forEach(function(n){(0,l.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}({},r);if(Object.entries(t).map(function(n){var r=(0,a.Z)(n,2),o=r[0],s=r[1],i=-1!=e.required.indexOf(o);"string"==typeof s&&i?t[o]=j(s):t[o]=s}),n(t),n.errors&&n.errors.length)return{details:n.errors}}},j=function(e){return""===e.trim()?null:e};function v(e){var n,r,o=e.schema,a=e.title,l=e.model,u=e.children,d=e.onChangeModel,p=void 0===d?function(e){}:d,f=e.onReset,h=void 0===f?function(){}:f,g=e.onSubmit,x=e.loading,j=e.submitLabel,v=e.cancelLabel,y=e.message,_=e.disabled,O=void 0!==_&&_,w=e.disabledMessage,N=void 0===w?"":w,P=(0,i.useState)(!1),Z=P[0],S=P[1],C=(0,i.useState)(!1),k=C[0],D=C[1],E=void 0!==x?x:Z;return(0,m.jsxs)("section",{className:"section-block mb-8",children:[(0,m.jsxs)("div",{className:" flex h-12 items-center overflow-hidden border-b px-6 border-overlay bg-surface-100 ",children:[(0,m.jsx)("div",{className:"flex-1 text-left",children:(0,m.jsx)("h6",{children:a||""})}),O&&N?(0,m.jsx)("p",{className:"text-sm text-foreground-light",children:N}):(0,m.jsxs)("div",{className:"flex transition duration-150 ".concat(k?"opacity-100":"cursor-default opacity-0"),children:[(0,m.jsx)(c.z,{onClick:function(){r.reset(),S(!1),D(!1),h&&h()},type:"default",disabled:!k||E,children:(void 0===v?"Cancel":v)||"Cancel"}),(0,m.jsx)(c.z,{onClick:function(){r.submit().then(function(){S(!0)}).catch(function(e){console.error("Error on submitting",e)})},loading:E,disabled:O||!k||E,type:"primary",className:"ml-2 hover:border-green-500",children:(void 0===j?"Save":j)||"Save"})]}),(0,m.jsx)("span",{className:"text-sm text-foreground-lighter",children:void 0===y?"":y})]}),(0,m.jsx)("div",{className:"Form section-block--body px-6 py-3",children:(0,m.jsx)(b,{disabled:O,onChangeModel:function(e){D(!0),p&&p(e)},formRef:function(e){return r=e},schema:o,model:l,onSubmit:(n=(0,t.Z)(s().mark(function e(n){return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:g(n).then(function(){S(!1),D(!1)}).catch(function(){return S(!1)});case 1:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)}),children:u})})]})}},57626:function(e,n,r){r.d(n,{iN:function(){return g},ph:function(){return u},by:function(){return b},hj:function(){return p},B4:function(){return h},S0:function(){return f},ld:function(){return o}});var t=r(52322);function o(e){return(0,t.jsxs)("div",{className:"mx-auto max-w-4xl px-5 pt-12 pb-20",children:[e.header&&(0,t.jsx)("h1",{className:"text-foreground mb-8 text-3xl",children:e.header}),(0,t.jsx)("div",{className:"space-y-20",children:e.children})]})}var s=r(39097),i=r.n(s),c=r(29071),a=r(8647),l=r(95223),u=function(e){var n=e.title,r=e.description,o=e.docsUrl;return(0,t.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("h3",{className:"text-foreground text-xl",children:(0,t.jsx)(c.D,{unwrapDisallowed:!0,disallowedElements:["p"],children:n})}),r&&(0,t.jsx)("div",{className:"text-foreground-lighter text-sm",children:(0,t.jsx)(c.D,{children:r})})]}),void 0!==o&&(0,t.jsx)(a.z,{asChild:!0,type:"default",icon:(0,t.jsx)(l.Z,{}),children:(0,t.jsx)(i(),{href:o,target:"_blank",rel:"noreferrer",children:"Documentation"})})]})},d=r(2784),p=function(e){var n=e.children,r=e.id,o=e.header,s=e.disabled,i=e.visible,c=e.className;return(0,t.jsxs)("div",{id:r,className:["grid grid-cols-12 gap-6 px-8 py-8","".concat(s?" opacity-30":" opacity-100"),"".concat(void 0===i||i?" block":" hidden"),"".concat(c)].join(" "),children:[o,n]})},f=function(e){var n=e.children,r=e.className,o=void 0===r?"":r,s=e.description;return void 0!==s?(0,t.jsxs)("div",{className:"flex flex-col space-y-2 col-span-12 lg:col-span-5 ".concat(o),children:[(0,t.jsx)("label",{className:"text-foreground text-sm",children:n}),s]}):(0,t.jsx)("label",{className:"text-foreground col-span-12 text-sm lg:col-span-5 ".concat(o),children:n})},m=function(){return(0,t.jsxs)("div",{className:"flex w-full flex-col gap-2",children:[(0,t.jsx)("div",{className:"shimmering-loader h-2 w-1/3 rounded"}),(0,t.jsx)("div",{className:"flex flex-col justify-between space-y-2",children:(0,t.jsx)("div",{className:"shimmering-loader h-[34px] w-2/3 rounded"})})]})},h=function(e){var n=e.children,r=e.loading,o=e.fullWidth,s=e.className;return(0,t.jsx)("div",{className:"\n        relative col-span-12 flex flex-col gap-6 lg:col-span-7\n        ".concat(o&&"!col-span-12","\n        ").concat(s,"\n      "),children:void 0===r||r?d.Children.map(n,function(e){return(0,t.jsx)(m,{})}):n})},b=function(e){var n=e.children,r=e.header,o=e.footer;return(0,t.jsxs)("div",{className:" bg-surface-100 border-default overflow-hidden  rounded-md border shadow",children:[r&&(0,t.jsx)("div",{className:"border-default border-b px-8 py-4",children:r}),(0,t.jsx)("div",{className:"divide-border flex flex-col gap-0 divide-y",children:n}),o&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"border-default border-t"}),o]})]})},g=function(e){var n=e.form,r=e.hasChanges,o=void 0===r?void 0:r,s=e.handleReset,i=e.helper,c=e.disabled,l=e.isSubmitting,u=e.submitText,d=l||void 0!==c&&c||!o&&void 0!==o;return(0,t.jsxs)("div",{className:["flex w-full items-center gap-2",i?"justify-between":"justify-end"].join(" "),children:[i&&(0,t.jsx)("span",{className:"text-sm text-foreground-lighter",children:i}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(a.z,{disabled:d,type:"default",htmlType:"reset",onClick:function(){return s()},children:"Cancel"}),(0,t.jsx)(a.z,{form:n,type:"primary",htmlType:"submit",disabled:d,loading:l,children:void 0===u?"Save":u})]})]})}},75332:function(e,n,r){r.d(n,{Ys:function(){return h}});var t=r(95235),o=r(82269),s=r(20406),i=r(28526),c=r.n(i),a=r(58943),l=r(37552),u=r(9747);r(2784);var d=r(57083),p=["enabled"];function f(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,t)}return r}function m(){return(m=(0,s.Z)(c().mark(function e(n,r){var t,o;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.projectRef,e.next=3,(0,l.U2)("".concat(u.T5,"/projects/").concat(t,"/config/pgbouncer"),{signal:r});case 3:if(!(o=e.sent).error){e.next=6;break}throw o.error;case 6:return e.abrupt("return",o);case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}var h=function(e){var n=e.projectRef,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=r.enabled,i=(0,o.Z)(r,p);return(0,a.a)(d.A.poolingConfiguration(n),function(e){return function(e,n){return m.apply(this,arguments)}({projectRef:n},e.signal)},function(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?f(Object(r),!0).forEach(function(n){(0,t.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}({enabled:(void 0===s||s)&&void 0!==n},i))}}}]);
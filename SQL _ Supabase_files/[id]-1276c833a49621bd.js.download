(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6377],{81250:function(e,t,n){"use strict";var r=n(96412),i=n(13089),s=n(95235),a=function(){function e(t,n,i){(0,r.Z)(this,e),(0,s.Z)(this,"_line",void 0),(0,s.Z)(this,"_text",void 0),(0,s.Z)(this,"_lines",void 0),(0,s.Z)(this,"model",void 0),(0,s.Z)(this,"offset",void 0),(0,s.Z)(this,"lineNumber",void 0),this.model=t,this.offset=n,this.lineNumber=i,this._text=t.getValue(),this._lines=this._text.split(/\r?\n/g),this._line=this._lines[i]}return(0,i.Z)(e,[{key:"hasNext",value:function(){return this.lineNumber>=0||this.offset>=0}},{key:"isFowardDQuote",value:function(){return!!this.hasForward()&&34===this.peekForward()}},{key:"isNextDQuote",value:function(){return!!this.hasNext()&&34===this.peekNext()}},{key:"isNextPeriod",value:function(){return!!this.hasNext()&&46===this.peekNext()}},{key:"peekNext",value:function(){return this.offset<0?this.lineNumber>0?10:0:this._line.charCodeAt(this.offset)}},{key:"hasForward",value:function(){return this.lineNumber<this._lines.length||this.offset<this._line.length}},{key:"peekForward",value:function(){return this.offset===this._line.length?this.lineNumber===this._lines.length?0:10:this._line.charCodeAt(this.offset+1)}},{key:"next",value:function(){if(this.offset<0)return this.lineNumber>0?(this.lineNumber--,this._line=this._lines[this.lineNumber],this.offset=this._line.length-1,10):(this.lineNumber=-1,0);var e=this._line.charCodeAt(this.offset);return this.offset--,e}},{key:"readArguments",value:function(){for(var e=0,t=0,n=0,r=0;this.hasNext();){var i=this.next();switch(i){case 40:if(--e<0)return r;break;case 41:e++;break;case 123:n--;break;case 125:n++;break;case 91:t--;break;case 93:t++;break;case 34:case 39:for(;this.hasNext()&&i!==this.next(););break;case 44:!e&&!t&&!n&&r++}}return -1}},{key:"readIdent",value:function(){for(var e=!1,t=!1,n="";this.hasNext();){var r=this.peekNext();if(e&&!t&&!this._isIdentPart(r))break;if(r=this.next(),!e&&t&&34===r){e=!0;continue}if(e||32!==r&&9!==r&&10!=r){if(!e&&(34===r||this._isIdentPart(r)))e=!0,t=34===r,n=String.fromCharCode(r)+n;else if(e){if(t){if(0===r||(n=String.fromCharCode(r)+n,34===r))break}else n=String.fromCharCode(r)+n}}}return n}},{key:"readIdents",value:function(e){for(var t=[];e>0;){e--;var n=this.readIdent();if(!n||(t.push(n),!this.isNextPeriod()))break}return t.reverse()}},{key:"_isIdentPart",value:function(e){return 95===e||e>=97&&e<=122||e>=65&&e<=90||e>=48&&e<=57}}]),e}();t.Z=a},19361:function(e,t,n){"use strict";n.d(t,{K:function(){return s}});var r=n(94170),i=function(e,t){var n=[];e&&n.push("tablename = '".concat(e,"'")),t&&n.push("schemaname = '".concat(t,"'"));var r=n.length>0?"WHERE ".concat(n.join(" AND ")):"";return"\n  \n  SELECT\n    tbl.schemaname,\n    tbl.tablename,\n    tbl.quoted_name,\n    tbl.is_table,\n    json_agg(a) as columns\n  FROM\n    (\n      SELECT\n        n.nspname as schemaname,\n        c.relname as tablename,\n        (quote_ident(n.nspname) || '.' || quote_ident(c.relname)) as quoted_name,\n        true as is_table\n      FROM\n        pg_catalog.pg_class c\n        JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace\n      WHERE\n        c.relkind = 'r'\n        AND n.nspname not in ('information_schema', 'pg_catalog', 'pg_toast')\n        AND n.nspname not like 'pg_temp_%'\n        AND n.nspname not like 'pg_toast_temp_%'\n        AND has_schema_privilege(n.oid, 'USAGE') = true\n        AND has_table_privilege(quote_ident(n.nspname) || '.' || quote_ident(c.relname), 'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER') = true\n      union all\n      SELECT\n        n.nspname as schemaname,\n        c.relname as tablename,\n        (quote_ident(n.nspname) || '.' || quote_ident(c.relname)) as quoted_name,\n        false as is_table\n      FROM\n        pg_catalog.pg_class c\n        JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace\n      WHERE\n        c.relkind in ('v', 'm')\n        AND n.nspname not in ('information_schema', 'pg_catalog', 'pg_toast')\n        AND n.nspname not like 'pg_temp_%'\n        AND n.nspname not like 'pg_toast_temp_%'\n        AND has_schema_privilege(n.oid, 'USAGE') = true\n        AND has_table_privilege(quote_ident(n.nspname) || '.' || quote_ident(c.relname), 'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER') = true\n    ) as tbl\n    LEFT JOIN (\n      SELECT\n        attrelid,\n        attname,\n        format_type(atttypid, atttypmod) as data_type,\n        attnum,\n        attisdropped\n      FROM\n        pg_attribute\n    ) as a ON (\n      a.attrelid = tbl.quoted_name::regclass\n      AND a.attnum > 0\n      AND NOT a.attisdropped\n      AND has_column_privilege(tbl.quoted_name, a.attname, 'SELECT, INSERT, UPDATE, REFERENCES')\n    )\n  ".concat(r,"\n  GROUP BY schemaname, tablename, quoted_name, is_table;\n").trim()},s=function(e){var t=e.projectRef,n=e.connectionString,s=e.table,a=e.schema,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.cp)({projectRef:t,connectionString:n,sql:i(s,a),queryKey:["table-columns",a,s]},o)}},20443:function(e,t,n){"use strict";n.d(t,{r:function(){return f}});var r=n(20406),i=n(95235),s=n(82269),a=n(28526),o=n.n(a),c=n(62202),l=n(62350),u=n(94170),d=["onSuccess","onError"];function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onSuccess,n=e.onError,a=(0,s.Z)(e,d);return(0,l.D)(function(e){return(0,u.Rj)(e)},function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach(function(t){(0,i.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({onSuccess:function(e,n,i){return(0,r.Z)(o().mark(function r(){return o().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,null==t?void 0:t(e,n,i);case 2:case"end":return r.stop()}},r)}))()},onError:function(e,t,i){return(0,r.Z)(o().mark(function r(){return o().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:void 0===n?c.Am.error("Failed to execute SQL: ".concat(e.message)):n(e,t,i);case 1:case"end":return r.stop()}},r)}))()}},a))}},81979:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return tf}});var r=n(20406),i=n(28526),s=n.n(i),a=n(5632),o=n(79534),c=n(46776),l=n(2784),u=n(43991),d=n(95235),p=n(94170);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach(function(t){(0,d.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var g=function(e){var t=e.projectRef,n=e.connectionString,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,p.cp)({projectRef:t,connectionString:n,sql:"\nSELECT n.nspname as \"schema\",\n  p.proname as \"name\",\n  d.description,\n  pg_catalog.pg_get_function_result(p.oid) as \"result_type\",\n  pg_catalog.pg_get_function_arguments(p.oid) as \"argument_types\",\nCASE\n  WHEN p.prokind = 'a' THEN 'agg'\n  WHEN p.prokind = 'w' THEN 'window'\n  WHEN p.prorettype = 'pg_catalog.trigger'::pg_catalog.regtype THEN 'trigger'\n  ELSE 'normal'\n  END as \"type\"\nFROM pg_catalog.pg_proc p\n  LEFT JOIN pg_catalog.pg_namespace n ON n.oid = p.pronamespace\n  LEFT JOIN pg_catalog.pg_description d ON p.oid = d.objoid\nWHERE n.nspname = 'public'\nORDER BY 1, 2, 4;\n".trim(),queryKey:["functions"]},m({select:function(e){return{result:e.result.map(function(e){var t=e.argument_types.split(",").filter(function(e){return e}).map(function(e){return e.trim()});return m(m({},e),{},{args:t})})}}},r))};function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var v=function(e){var t=e.projectRef,n=e.connectionString,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,p.cp)({projectRef:t,connectionString:n,sql:"\nSELECT word FROM pg_get_keywords();\n".trim(),queryKey:["keywords"]},function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach(function(t){(0,d.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({select:function(e){return{result:e.result.map(function(e){return e.word.toLocaleLowerCase()})}}},r))},b=n(59800),x=n(19361),y=n(82269),j=n(62350),w=n(37552),O=n(9747),k=["onSuccess"];function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function E(){return(E=(0,r.Z)(s().mark(function e(t,n){var r,i,a,o,c;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.projectRef,i=t.connectionString,a=t.sql,o=new Headers,i&&o.set("x-connection-encrypted",i),e.next=5,(0,w.v_)("".concat(O.T5,"/pg-meta/").concat(r,"/query/format"),{query:a},{headers:Object.fromEntries(o),signal:n});case 5:if(!(c=e.sent).error){e.next=8;break}throw c.error;case 8:return e.abrupt("return",{result:c});case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}var S=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onSuccess,n=(0,y.Z)(e,k);return(0,j.D)(function(e){return function(e,t){return E.apply(this,arguments)}(e)},function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach(function(t){(0,d.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({onSuccess:function(e,n,i){return(0,r.Z)(s().mark(function r(){return s().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,null==t?void 0:t(e,n,i);case 2:case"end":return r.stop()}},r)}))()}},n))},_=n(81333),C=n(82841),P=n(94589),D=n(25237),q=n.n(D),Z=n(40578),R=n(36782),L=n(15659),A=n(58414),I=n(50077),T=n(8647),z=n(97346),F=n(29027),Q=n(24564),V=n(93306),W=n(77740),M=n(59227),U=n(50071),G=n(89700),H=["onSuccess"];function K(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function $(){return($=(0,r.Z)(s().mark(function e(t){var n,r,i,a;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.prompt,r=t.sql,i=t.entityDefinitions,e.next=3,(0,w.v_)(O.GW+"/api/ai/sql/edit",{prompt:n,sql:r,entityDefinitions:i});case 3:if(a=e.sent,(0,w.d8)(a)){e.next=6;break}throw a.error;case 6:return e.abrupt("return",a);case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}var J=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onSuccess,n=(0,y.Z)(e,H);return(0,j.D)(function(e){return function(e){return $.apply(this,arguments)}(e)},function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K(Object(n),!0).forEach(function(t){(0,d.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({onSuccess:function(e,n,i){return(0,r.Z)(s().mark(function r(){return s().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,null==t?void 0:t(e,n,i);case 2:case"end":return r.stop()}},r)}))()}},n))},Y=["onSuccess"];function X(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function B(){return(B=(0,r.Z)(s().mark(function e(t){var n,r,i;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.prompt,r=t.entityDefinitions,e.next=3,(0,w.v_)(O.GW+"/api/ai/sql/generate",{prompt:n,entityDefinitions:r});case 3:if(i=e.sent,(0,w.d8)(i)){e.next=6;break}throw i.error;case 6:return e.abrupt("return",i);case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}var ee=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onSuccess,n=(0,y.Z)(e,Y);return(0,j.D)(function(e){return function(e){return B.apply(this,arguments)}(e)},function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?X(Object(n),!0).forEach(function(t){(0,d.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({onSuccess:function(e,n,i){return(0,r.Z)(s().mark(function r(){return s().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,null==t?void 0:t(e,n,i);case 2:case"end":return r.stop()}},r)}))()}},n))},et=n(97512),en=n(72199),er=n(20443),ei=n(27701),es=n(70203),ea=n(210),eo=n(44183),ec=n(32670),el=n(58860),eu=n(1986),ed=n(13844),ep=n(49631),ef=n(52322),em=function(e){var t,n,r=e.children,i=e.delay,s=void 0===i?300:i,a=e.onClickSettings,o=(0,es.lL)(),c=null!==(t=null==o?void 0:null===(n=o.opt_in_tags)||void 0===n?void 0:n.includes(O.PV.AI_SQL))&&void 0!==t&&t,u=(0,es.ly)("supabase_sql-editor-ai-schema",!0),d=(0,_.Z)(u,1)[0],p=(0,l.useState)(!1),f=p[0],m=p[1],g=(0,es.ly)("supabase_sql-editor-ai-query-count",0),h=(0,_.Z)(g,1)[0],v=(c||!O.Qy)&&d,b=(0,es.ly)("supabase_sql-editor-ai-schema-suggestion-dismissed",!1),x=(0,_.Z)(b,2),y=x[0],j=x[1];return(0,l.useEffect)(function(){var e=window.setTimeout(function(){m(!0)},s);return function(){return window.clearTimeout(e)}}),(0,ef.jsxs)(ed.fC,{open:f&&!v&&h>=3&&!y,children:[(0,ef.jsx)(ed.ee,{asChild:!0,children:r}),(0,ef.jsx)(ed.h_,{children:(0,ef.jsx)(ed.VY,{side:"bottom",sideOffset:5,children:(0,ef.jsxs)(C.E.div,{variants:{visible:{opacity:1,y:0},hidden:{opacity:0,y:-10}},initial:"hidden",animate:"visible",children:[(0,ef.jsx)(ed.Eh,{className:"fill-background-surface-300"}),(0,ef.jsxs)("div",{className:"flex flex-col gap-2 border border-default rounded-md p-4 bg-surface-100 shadow-xl",children:[(0,ef.jsxs)("div",{className:"flex flex-row items-center gap-4 max-w-md",children:[(0,ef.jsx)(ep.Z,{className:"w-6 h-6"}),(0,ef.jsx)("p",{className:"text-sm",children:"Generate more relevant queries by including database metadata in your requests."})]}),(0,ef.jsxs)("div",{className:"flex flex-row gap-2 justify-end",children:[(0,ef.jsx)(T.z,{type:"default",onClick:function(){j(!0)},children:"Dismiss"}),(0,ef.jsx)(T.z,{onClick:function(){j(!0),null==a||a()},children:"Open settings"})]})]})]})})})]})},eg=n(39097),eh=n.n(eg),ev=n(36849),eb=n(67270),ex=n(95223),ey=n(49257);function ej(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ew(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ej(Object(n),!0).forEach(function(t){(0,d.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ej(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var eO=function(e){var t,n,r=(0,es.lL)(),i=null!==(t=null==r?void 0:null===(n=r.opt_in_tags)||void 0===n?void 0:n.includes(O.PV.AI_SQL))&&void 0!==t&&t,s=(0,es.ly)("supabase_sql-editor-ai-schema-enabled",!0),a=(0,_.Z)(s,2),o=a[0],c=a[1],l=(0,es.oR)().ui,u=(i||!O.Qy)&&o;return(0,ef.jsx)(ev.C,ew(ew({header:"SQL Editor AI Settings",hideFooter:!0,closable:!0},e),{},{children:(0,ef.jsxs)("div",{className:"flex flex-col items-start justify-between gap-4 px-6 py-3",children:[O.Qy&&!i&&r&&(0,ef.jsx)(eb.b,{variant:"warning",title:"This option is only available if your organization has opted-in to sending anonymous data to OpenAI.",children:(0,ef.jsxs)(eh(),{href:"/org/".concat(r.slug,"/general"),className:"flex flex-row gap-1 items-center",target:"_blank",rel:"noopener",children:["Go to your organization's settings to opt-in.",(0,ef.jsx)(ex.Z,{className:"inline-block w-3 h-3"})]})}),(0,ef.jsxs)("div",{className:"flex justify-between gap-8 mr-8 my-4",children:[(0,ef.jsx)(ey.Z,{disabled:O.Qy&&!i,checked:u,onChange:function(){c(function(e){return!e}),l.setNotification({category:"success",message:"Successfully saved settings"})}}),(0,ef.jsxs)("div",{className:"grid gap-2",children:[(0,ef.jsx)("p",{className:"text-sm",children:"Include anonymous database metadata in AI queries"}),(0,ef.jsx)("p",{className:"text-sm text-foreground-light",children:"Includes table names, column names and their corresponding data types in the request. This will generate queries that are more relevant to your project."})]})]})]})}))},ek=n(92475),eN=n(19967),eE=n(37852),eS=n(97064),e_=n(76635),eC=n(83606),eP=n(28208),eD=n(51459),eq=n(17591),eZ=n.n(eq),eR=function(e){var t,n,r,i,s=e.id,o=e.isExecuting,c=(0,eS.d2)().project,d=(0,el.W2)(),p=(0,u.Mk)(),f=null!==(t=null===(n=d.results)||void 0===n?void 0:null===(r=n[s])||void 0===r?void 0:r[0])&&void 0!==t?t:void 0,m=(0,es.oR)().ui,g=(0,l.useRef)(null),h=(0,a.useRouter)(),v=(0,l.useMemo)(function(){if(null!=f&&f.rows){var e=Array.from(f.rows||[]).map(function(e){return(0,e_.map)(e,function(e,t){return(0,e_.isString)(e)?e.replaceAll(/\n/g,"\\n").replaceAll(/"/g,'""'):(0,e_.isObject)(e)?JSON.stringify(e).replaceAll(/\"/g,'""'):e})});return(0,e_.compact)(e)}return""},[f]),b=(0,l.useMemo)(function(){if(null!=f&&f.rows){var e=Array.from(f.rows||[])[0];if(e)return Object.keys(e)}},[f]);return(0,ef.jsxs)(V.h_,{children:[(0,ef.jsxs)(V.$F,{children:[(0,ef.jsx)(T.z,{asChild:!0,type:"text",iconRight:(0,ef.jsx)(W.Z,{}),children:(0,ef.jsxs)("span",{children:["Results",!o&&f&&f.rows.length>0&&" (".concat(f.rows.length.toLocaleString(),")")]})}),(0,ef.jsx)(eC.CSVLink,{ref:g,className:"hidden",headers:b,data:v,filename:"supabase_".concat(null==c?void 0:c.ref,"_").concat(null===(i=d.snippets[s])||void 0===i?void 0:i.snippet.name)})]}),(0,ef.jsx)(V.AW,{side:"bottom",align:"start",children:(0,ef.jsxs)(ef.Fragment,{children:[(0,ef.jsxs)(V.Xi,{onClick:function(){var e;null===(e=g.current)||void 0===e||e.link.click(),ec.Z.sendEvent({category:"sql_editor",action:"sql_download_csv",label:""},p,h)},className:"space-x-2",children:[(0,ef.jsx)(eP.Z,{size:"tiny"}),(0,ef.jsx)("p",{children:"Download CSV"})]}),(0,ef.jsxs)(V.Xi,{onClick:function(){if(navigator){if(!f||!f.rows)return"results is empty";if(f.rows.constructor!==Array&&f.error)return f.error;if(0==f.rows.length)return"results is empty";var e=Object.keys(f.rows[0]),t=f.rows.map(function(t){var n=[];return e.forEach(function(e){return n.push(t[e])}),n}),n=[e].concat(t),r=eZ()(n);(0,ea.vQ)(r,function(){m.setNotification({category:"success",message:"Copied results to clipboard"}),ec.Z.sendEvent({category:"sql_editor",action:"sql_copy_as_markdown",label:""},p,h)})}},className:"space-x-2",children:[(0,ef.jsx)(eD.Z,{size:"tiny"}),(0,ef.jsx)("p",{children:"Copy as markdown"})]})]})})]})},eL=n(24990),eA=n(50468),eI=n(12223);function eT(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var ez=function(e){return(0,ef.jsx)(eI.Z,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eT(Object(n),!0).forEach(function(t){(0,d.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eT(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({icon:eA.Z},e))},eF=n(15008),eQ=n(97366),eV=n(55830),eW=n(40780);function eM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eU(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eM(Object(n),!0).forEach(function(t){(0,d.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eM(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var eG=function(e){var t=e.id,n=(0,eV.NL)(),i=(0,eS.d2)().project,a=(0,el.W2)(),o=a.snippets[t],c=void 0!==o&&o.snippet.content.favorite;function l(){return(l=(0,r.Z)(s().mark(function e(){return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.addFavorite(t),n.setQueryData(eW.$.list(null==i?void 0:i.ref),function(e){if(e)return eU(eU({},e),{},{content:e.content.map(function(e){return"sql"===e.type&&e.id===t?eU(eU({},e),{},{content:eU(eU({},e.content),{},{favorite:!0})}):e})})});case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function u(){return(u=(0,r.Z)(s().mark(function e(){return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.removeFavorite(t),n.setQueryData(eW.$.list(null==i?void 0:i.ref),function(e){if(e)return eU(eU({},e),{},{content:e.content.map(function(e){return"sql"===e.type&&e.id===t?eU(eU({},e),{},{content:eU(eU({},e.content),{},{favorite:!1})}):e})})});case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}return(0,ef.jsx)(ef.Fragment,{children:c?(0,ef.jsx)(T.z,{type:"text",size:"tiny",onClick:function(){return u.apply(this,arguments)},icon:(0,ef.jsx)(eQ.Z,{size:"tiny",fill:"#48bb78"})}):(0,ef.jsx)(T.z,{type:"text",size:"tiny",onClick:function(){return l.apply(this,arguments)},icon:(0,ef.jsx)(eQ.Z,{size:"tiny",fill:"gray"})})})},eH=n(82462);function eK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var e$=function(e){return(0,ef.jsx)(eI.Z,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eK(Object(n),!0).forEach(function(t){(0,d.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eK(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({icon:eH.Z},e))},eJ=n(23733),eY=function(e){var t=e.id,n=(0,el.W2)(),r=n.savingStates[t],i=(0,es.D9)(r),s=(0,l.useState)(!1),a=s[0],o=s[1];return(0,l.useEffect)(function(){var e=!1;return"UPDATING"===i&&"IDLE"===r&&(o(!0),setTimeout(function(){e||o(!1)},3e3)),function(){e=!0}},[r]),(0,ef.jsxs)("div",{className:"mx-2 flex items-center gap-2",children:["UPDATING_FAILED"===r&&(0,ef.jsx)(T.z,{type:"text",size:"tiny",icon:(0,ef.jsx)(e$,{className:"text-gray-1100",size:"tiny",strokeWidth:2}),onClick:function(){n.addNeedsSaving(t)},children:"Retry"}),a?(0,ef.jsxs)(eL.fC,{delayDuration:0,children:[(0,ef.jsx)(eL.xz,{children:(0,ef.jsx)(z.Z,{className:"text-brand",size:14,strokeWidth:3})}),(0,ef.jsxs)(eL.VY,{side:"bottom",children:[(0,ef.jsx)(eL.Eh,{className:"radix-tooltip-arrow"}),(0,ef.jsx)("div",{className:"bg-alternative rounded py-1 px-2 leading-none shadow border-background border ",children:(0,ef.jsx)("span",{className:"text-foreground text-xs",children:"All changes saved"})})]})]}):"UPDATING"===r?(0,ef.jsxs)(eL.fC,{delayDuration:0,children:[(0,ef.jsx)(eL.xz,{children:(0,ef.jsx)(F.Z,{className:"animate-spin",size:14,strokeWidth:2})}),(0,ef.jsxs)(eL.VY,{side:"bottom",children:[(0,ef.jsx)(eL.Eh,{className:"radix-tooltip-arrow"}),(0,ef.jsx)("div",{className:"bg-alternative rounded py-1 px-2 leading-none shadow border-background border",children:(0,ef.jsx)("span",{className:"text-foreground text-xs",children:"Saving changes..."})})]})]}):"UPDATING_FAILED"===r?(0,ef.jsxs)(eL.fC,{delayDuration:0,children:[(0,ef.jsx)(eL.xz,{children:(0,ef.jsx)(eJ.Z,{className:"text-red-900",size:14,strokeWidth:2})}),(0,ef.jsxs)(eL.VY,{side:"bottom",children:[(0,ef.jsx)(eL.Eh,{className:"radix-tooltip-arrow"}),(0,ef.jsx)("div",{className:"bg-alternative rounded py-1 px-2 leading-none shadow border-background border ",children:(0,ef.jsx)("span",{className:"text-foreground text-xs",children:"Failed to save changes"})})]})]}):null,(0,ef.jsx)("span",{className:"text-foreground-light text-sm",children:"UPDATING_FAILED"===r&&"Failed to save"})]})},eX=n(63060),eB=n(59476),e0=function(e){var t,n,r=e.id,i=(0,el.W2)(),s=i.snippets[r],a=(null!==(t=null==s?void 0:null===(n=s.splitSizes)||void 0===n?void 0:n[1])&&void 0!==t?t:0)===0;return s?a?(0,ef.jsxs)(eL.fC,{delayDuration:0,children:[(0,ef.jsx)(eL.xz,{asChild:!0,children:(0,ef.jsx)(T.z,{type:"text",size:"tiny",onClick:function(){return i.restoreUtilityPanel(r)},icon:(0,ef.jsx)(eX.Z,{className:"text-gray-1100",size:"tiny",strokeWidth:2})})}),(0,ef.jsx)(eL.h_,{children:(0,ef.jsxs)(eL.VY,{side:"bottom",children:[(0,ef.jsx)(eL.Eh,{className:"radix-tooltip-arrow"}),(0,ef.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,ef.jsx)("span",{className:"text-xs text-foreground",children:"Show results"})})]})})]}):(0,ef.jsxs)(eL.fC,{delayDuration:0,children:[(0,ef.jsx)(eL.xz,{asChild:!0,children:(0,ef.jsx)(T.z,{type:"text",size:"tiny",onClick:function(){return i.collapseUtilityPanel(r)},icon:(0,ef.jsx)(eB.Z,{className:"text-gray-1100",size:"tiny",strokeWidth:2})})}),(0,ef.jsx)(eL.h_,{children:(0,ef.jsxs)(eL.VY,{side:"bottom",children:[(0,ef.jsx)(eL.Eh,{className:"radix-tooltip-arrow"}),(0,ef.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,ef.jsx)("span",{className:"text-xs text-foreground",children:"Collapse results"})})]})})]}):null},e1=function(e){var t=e.id,n=e.isExecuting,r=void 0!==n&&n,i=e.isDisabled,s=e.hasSelection,a=e.prettifyQuery,o=e.executeQuery,c=(0,ea.fV)();return(0,ef.jsxs)(ef.Fragment,{children:[(0,ef.jsx)(eY,{id:t}),O.Qy&&(0,ef.jsx)(eG,{id:t}),(0,ef.jsx)(e0,{id:t}),(0,ef.jsxs)(eL.fC,{delayDuration:0,children:[(0,ef.jsx)(eL.xz,{asChild:!0,children:(0,ef.jsx)(T.z,{type:"text",onClick:function(){return a()},icon:(0,ef.jsx)(ez,{size:"tiny",strokeWidth:2,className:"text-gray-1100"})})}),(0,ef.jsx)(eL.h_,{children:(0,ef.jsxs)(eL.VY,{side:"bottom",children:[(0,ef.jsx)(eL.Eh,{className:"radix-tooltip-arrow"}),(0,ef.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,ef.jsx)("span",{className:"text-xs text-foreground",children:"Prettify SQL"})})]})})]}),(0,ef.jsx)(T.z,{onClick:function(){return o()},disabled:void 0!==i&&i||r,loading:r,type:"default",size:"tiny",className:"mx-2",iconRight:(0,ef.jsxs)("div",{className:"flex items-center space-x-1",children:["macos"===c?(0,ef.jsx)(eF.Z,{size:10,strokeWidth:1.5}):(0,ef.jsx)("p",{className:"text-xs text-foreground-light",children:"CTRL"}),(0,ef.jsx)(Q.Z,{size:10,strokeWidth:1.5})]}),children:s?"Run selected":"Run"})]})},e2=["onSuccess"];function e3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function e4(){return(e4=(0,r.Z)(s().mark(function e(t){var n,r,i,a;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.errorMessage,r=t.sql,i=t.entityDefinitions,e.next=3,(0,w.v_)(O.GW+"/api/ai/sql/debug",{errorMessage:n,sql:r,entityDefinitions:i});case 3:if(a=e.sent,(0,w.d8)(a)){e.next=6;break}throw a.error;case 6:return e.abrupt("return",a);case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}var e5=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onSuccess,n=(0,y.Z)(e,e2);return(0,j.D)(function(e){return function(e){return e4.apply(this,arguments)}(e)},function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?e3(Object(n),!0).forEach(function(t){(0,d.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):e3(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({onSuccess:function(e,n,i){return(0,r.Z)(s().mark(function r(){return s().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,null==t?void 0:t(e,n,i);case 2:case"end":return r.stop()}},r)}))()}},n))},e7=n(71623),e8=n(47370),e9=n(28316),e6=function(e){var t,n=e.id,r=e.rows,i="sql-context-menu-"+n,s=(0,l.useState)(void 0),a=s[0],o=s[1];function c(){if(a){var e,t,n,i=a.rowIdx,s=a.column.key,o=null===(e=null!==(t=null===(n=r[i])||void 0===n?void 0:n[s])&&void 0!==t?t:"")?"":"object"==typeof e||Array.isArray(e)?JSON.stringify(e):e;(0,ea.vQ)(o)}}(0,es.aL)({"Command+c":function(e){e.stopPropagation(),c()},"Control+c":function(e){e.stopPropagation(),c()}},["INPUT","TEXTAREA"]);var u=(0,e7.av)().show,d=Object.keys(null!==(t=null==r?void 0:r[0])&&void 0!==t?t:[]).map(function(e,t){return{idx:t,key:e,name:e,resizable:!0,parent:void 0,level:0,width:120,minWidth:120,maxWidth:void 0,draggable:!1,frozen:!1,sortable:!1,isLastFrozenColumn:!1,renderCell:function(t){var n=t.row;return(0,ef.jsx)("span",{className:"font-mono text-xs w-full",onContextMenu:function(e){return u(e,{id:i})},children:JSON.stringify(n[e])})},renderHeaderCell:function(){return(0,ef.jsx)("div",{className:"flex h-full items-center justify-center font-mono",children:e})}}});return r.length<=0?(0,ef.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark",children:(0,ef.jsx)("p",{className:"m-0 border-0 px-6 py-4 font-mono text-sm",children:"Success. No rows returned"})}):(0,ef.jsxs)(ef.Fragment,{children:[(0,ef.jsx)(e8.ZP,{columns:d,rows:r,className:"flex-grow",rowClass:function(){return"[&>.rdg-cell]:items-center"},onSelectedCellChange:function(e){o(e)}}),(0,e9.createPortal)((0,ef.jsx)(e7.v2,{id:i,animation:!1,children:(0,ef.jsxs)(e7.ck,{onClick:c,children:[(0,ef.jsx)(eD.Z,{size:"tiny"}),(0,ef.jsx)("span",{className:"ml-2 text-xs",children:"Copy cell content"})]})}),document.body)]})},te=n(97415),tt=function(e){var t=e.id,n=e.isExecuting,i=(0,es.oR)().ui,a=(0,es.lL)(),o=(0,el.W2)(),c=e5(),u=c.mutateAsync,d=c.isLoading,p=function(){var e=(0,l.useContext)(ts);if(!e)throw Error("No SQL editor context. Are you using useSqlEditor() outside of SQLEditor?");return e}(),f=p.setDebugSolution,m=p.setAiInput,g=p.setSqlDiff,h=p.sqlDiff,v=(0,es.lL)(),b=(0,es.Vm)(),x=null!==(L=null==v?void 0:null===(I=v.opt_in_tags)||void 0===I?void 0:I.includes(O.PV.AI_SQL))&&void 0!==L&&L,y=(0,es.ly)("supabase_sql-editor-ai-schema-enabled",!0),j=(0,_.Z)(y,1)[0],w=(x||!O.Qy)&&j,k=(0,en.u$)({projectRef:null==b?void 0:b.ref,connectionString:null==b?void 0:b.connectionString},{enabled:w}).data,N=w?null==k?void 0:k.map(function(e){return e.sql.trim()}):void 0,E=o.snippets[t],S=null===(z=o.results[t])||void 0===z?void 0:z[0],C=(null!==(F=null==E?void 0:null===(Q=E.splitSizes)||void 0===Q?void 0:Q[1])&&void 0!==F?F:0)===0,P=(0,es.P5)("sqlEditorSupabaseAI"),D=(0,te.G)({orgSlug:null==a?void 0:a.slug}).data,q=(0,eu.$)(D),Z=(null==S?void 0:null===(V=S.error)||void 0===V?void 0:null===(W=V.message)||void 0===W?void 0:W.includes("canceling statement due to statement timeout"))||(null==S?void 0:null===(M=S.error)||void 0===M?void 0:null===(U=M.message)||void 0===U?void 0:U.includes("upstream request timeout"));if(C)return null;if(n)return(0,ef.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark",children:(0,ef.jsx)("p",{className:"m-0 border-0 px-6 py-4 font-mono text-sm",children:"Running..."})});if(null!=S&&S.error){var L,I,z,F,Q,V,W,M,U,G,H,K,$=(null!==(G=null===(H=S.error)||void 0===H?void 0:null===(K=H.formattedError)||void 0===K?void 0:K.split("\n"))&&void 0!==G?G:[]).filter(function(e){return e.length>0});return(0,ef.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark",children:(0,ef.jsxs)("div",{className:"flex flex-row justify-between items-start py-4 px-6",children:[Z?(0,ef.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,ef.jsx)("p",{className:"font-mono text-sm",children:"SQL query ran into an upstream timeout"}),(0,ef.jsxs)("p",{className:"font-mono text-sm text-foreground-light",children:["You can either"," ",(0,ef.jsx)("a",{target:"_blank",rel:"noreferrer",className:"underline transition hover:text-foreground",href:"https://supabase.com/docs/guides/platform/performance#examining-query-performance",children:"optimize your query"}),", or"," ",(0,ef.jsx)("a",{target:"_blank",rel:"noreferrer",className:"underline transition hover:text-foreground",href:"https://supabase.com/docs/guides/database/timeouts",children:"increase the statement timeout"}),"."]})]}):(0,ef.jsx)("div",{children:$.length>0?$.map(function(e,t){return(0,ef.jsx)("pre",{className:"font-mono text-sm",children:e},"error-".concat(t))}):(0,ef.jsx)("p",{className:"font-mono text-sm",children:S.error.error})}),P&&!q&&(0,ef.jsx)(T.z,{icon:(0,ef.jsx)("div",{className:"scale-75",children:(0,ef.jsx)(A.c,{className:"w-3 h-3",loading:d})}),disabled:!!h||d,onClick:(0,r.Z)(s().mark(function e(){var t,n,r,a;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u({sql:E.snippet.content.sql.replace(ek.eg,"").trim(),errorMessage:S.error.message,entityDefinitions:N});case 3:n=(t=e.sent).solution,r=t.sql,a=ek.eg+"\n\n"+(0,R.WU)(r,{language:"postgresql",keywordCase:"lower"}),m(""),f(n),g({original:E.snippet.content.sql,modified:a}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),(0,ei.V)(e.t0)&&i.setNotification({category:"error",message:"Failed to debug: ".concat(e.t0.message)});case 15:case"end":return e.stop()}},e,null,[[0,12]])})),children:"Debug with Supabase AI"})]})})}return S?(0,ef.jsx)("div",{className:"h-full flex flex-col",children:(0,ef.jsx)(e6,{id:t,rows:S.rows})}):(0,ef.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark",children:(0,ef.jsxs)("p",{className:"m-0 border-0 px-6 py-4 text-sm text-foreground-light",children:["Click ",(0,ef.jsx)("code",{children:"Run"})," to execute your query."]})})},tn=function(e){var t=e.id,n=e.isExecuting,r=e.isDisabled,i=e.hasSelection,s=e.prettifyQuery,a=e.executeQuery;return(0,ef.jsxs)(ef.Fragment,{children:[(0,ef.jsxs)("div",{className:"flex justify-between overflow-visible px-6 py-2 border-b",children:[(0,ef.jsx)(eR,{id:t,isExecuting:n}),(0,ef.jsx)("div",{className:"inline-flex items-center justify-end",children:(0,ef.jsx)(e1,{id:t,isExecuting:n,isDisabled:r,hasSelection:i,prettifyQuery:s,executeQuery:a})})]}),(0,ef.jsx)("div",{className:"flex-1 p-0 pt-0 pb-0",children:(0,ef.jsx)(tt,{id:t,isExecuting:n})})]})},tr=q()(function(){return n.e(3840).then(n.bind(n,73840))},{ssr:!1,loadableGenerated:{webpack:function(){return[73840]}}}),ti=q()(function(){return Promise.resolve().then(n.bind(n,79534)).then(function(e){return e.DiffEditor})},{ssr:!1,loadableGenerated:{webpack:function(){return[79534]}}}),ts=(0,l.createContext)(void 0),ta=function(){var e,t,n,i,o,c,d=(0,es.oR)().ui,p=(0,u.UO)(),f=p.ref,m=p.id,g=(0,a.useRouter)(),h=(0,u.Mk)(),v=(0,l.useMemo)(function(){return(0,ea.k$)()},[m]),b=m&&"new"!==m?m:v,x=(0,eo.Un)().profile,y=(0,es.Vm)(),j=(0,es.lL)(),w=(0,el.W2)(),k=S().mutate,N=ee(),E=N.mutateAsync,D=N.isLoading,q=J(),H=q.mutateAsync,K=q.isLoading,$=(0,et.g)().mutateAsync,Y=(0,et.g)().mutateAsync,X=(0,l.useState)(""),B=X[0],ed=X[1],ep=(0,l.useState)(),eg=ep[0],eh=ep[1],ev=(0,l.useState)(),eb=ev[0],ex=ev[1],ey=(0,l.useState)(),ej=ey[0],ew=ey[1],eS=(0,l.useState)(!1),e_=eS[0],eC=eS[1],eP=(0,l.useRef)(null),eD=(0,es.P5)("sqlEditorSupabaseAI"),eq=(0,te.G)({orgSlug:null==j?void 0:j.slug}).data,eZ=(0,eu.$)(eq),eR=(0,es.ly)("supabase_sql-editor-ai-open",!0),eL=(0,_.Z)(eR,2),eA=eL[0],eI=eL[1],eT=(0,l.useState)(!1),ez=eT[0],eF=eT[1],eQ=(0,l.useState)(!1),eV=eQ[0],eW=eQ[1],eM=(0,es.lL)(),eU=(0,es.Vm)(),eG=null!==(i=null==eM?void 0:null===(o=eM.opt_in_tags)||void 0===o?void 0:o.includes(O.PV.AI_SQL))&&void 0!==i&&i,eH=(0,es.ly)("supabase_sql-editor-ai-schema-enabled",!0),eK=(0,_.Z)(eH,1)[0],e$=(0,l.useState)(!1),eJ=e$[0],eY=e$[1],eX=(0,es.ly)("supabase_sql-editor-ai-query-count",0),eB=(0,_.Z)(eX,2)[1],e0=(0,es.ly)("supabase_sql-editor-ai-schema-suggestion-dismissed",!1),e1=(0,_.Z)(e0,2)[1],e2=(eG||!O.Qy)&&eK,e3=(0,l.useState)(eN.U.Modification),e4=e3[0],e5=e3[1],e7=(0,l.useState)(!0),e8=e7[0],e9=e7[1],e6=(0,l.useState)([]),tt=e6[0],ta=e6[1],to=D||K;(0,l.useEffect)(function(){e9(!1)},[]);var tc=(0,en.u$)({projectRef:null==eU?void 0:eU.ref,connectionString:null==eU?void 0:eU.connectionString},{enabled:e2}),tl=tc.data,tu=tc.refetch,td=e2?null==tl?void 0:tl.map(function(e){return e.sql.trim()}):void 0,tp=!!eb,tf=(0,es._)("supabase_sql-editor-split-size","[50, 50]"),tm=(0,_.Z)(tf,2),tg=tm[0],th=tm[1],tv=tg?JSON.parse(tg):void 0,tb=(0,er.r)({onSuccess:function(e){b&&w.addResult(b,e.result),tu()},onError:function(e){if(b){if(e.position&&tN.current){var t,n=tk.current,r=tN.current,i=null!==(t=e.formattedError)&&void 0!==t?t:"",s=i.slice(i.indexOf("LINE")),a=Number(s.slice(0,s.indexOf(":")).split(" ")[1]);if(!isNaN(a)){var o=null==n?void 0:n.deltaDecorations([],[{range:new r.Range(a,1,a,20),options:{isWholeLine:!0,inlineClassName:"bg-amber-800"}}]);o&&(null==n||n.revealLineInCenter(a),ta(o))}}w.addResultError(b,e)}}}),tx=tb.mutate,ty=tb.isLoading,tj=b?w.snippets[b]:null,tw="new"!==m&&!(b&&f&&w.loaded[f]),tO=(0,l.useCallback)(function(e){b&&w.setSplitSizes(b,e),th(JSON.stringify(e))},[b]),tk=(0,l.useRef)(null),tN=(0,l.useRef)(null),tE=(0,l.useRef)(null),tS=(0,l.useCallback)((e=(0,r.Z)(s().mark(function e(t,n){var r;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y({sql:n});case 2:r=e.sent.title,w.renameSnippet(t,r);case 5:case"end":return e.stop()}},e)})),function(t,n){return e.apply(this,arguments)}),[Y,w]),t_=(0,l.useCallback)((0,r.Z)(s().mark(function e(){var t,n,r,i,a,o,c,l,u;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!tp){e.next=2;break}return e.abrupt("return");case 2:t=(0,el.X8)().snippets[b],tk.current&&y&&(l=(c=(o=tk.current).getSelection())?null===(n=o.getModel())||void 0===n?void 0:n.getValueInRange(c):void 0,u=t?null!==(r=l||(null===(i=tk.current)||void 0===i?void 0:i.getValue()))&&void 0!==r?r:t.snippet.content.sql:l||(null===(a=tk.current)||void 0===a?void 0:a.getValue()),k({projectRef:y.ref,connectionString:y.connectionString,sql:u},{onSuccess:function(e){var t,n=null==tk?void 0:null===(t=tk.current)||void 0===t?void 0:t.getModel();tk.current&&n&&(tk.current.executeEdits("apply-prettify-edit",[{text:e.result,range:n.getFullModelRange()}]),w.setSql(b,e.result))}}));case 5:case"end":return e.stop()}},e)})),[k,b,tp,y,w]),tC=(0,l.useCallback)((0,r.Z)(s().mark(function e(){var t,n,r,i,a,o,c,l,u,d,p,f=arguments;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f.length>0&&void 0!==f[0]&&f[0],!tp){e.next=3;break}return e.abrupt("return");case 3:if(n=(0,el.X8)().snippets[b],!(null!==tk.current&&!ty&&void 0!==y)){e.next=17;break}if(u=(l=(c=tk.current).getSelection())?null===(r=c.getModel())||void 0===r?void 0:r.getValueInRange(l):void 0,d=n?null!==(i=u||(null===(a=tk.current)||void 0===a?void 0:a.getValue()))&&void 0!==i?i:n.snippet.content.sql:u||(null===(o=tk.current)||void 0===o?void 0:o.getValue()),p=(0,eE.mw)(d),!(!t&&p)){e.next=14;break}return eW(!0),e.abrupt("return");case 14:eD&&!eZ&&(null==n?void 0:n.snippet.name)===ek.$C&&tS(b,d),tt.length>0&&(null==c||c.deltaDecorations(tt,[]),ta([])),tx({projectRef:y.ref,connectionString:y.connectionString,sql:d});case 17:case"end":return e.stop()}},e)})),[tp,b,ty,y,tx,tS,eZ,eD]),tP=(0,l.useCallback)((t=(0,r.Z)(s().mark(function e(t,n){var r;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(f){e.next=2;break}return e.abrupt("return",console.error("Project ref is required"));case 2:try{r=(0,eE.UA)({id:(0,ea.k$)(),name:n,sql:t,owner_id:null==x?void 0:x.id,project_id:null==y?void 0:y.id}),w.addSnippet(r,f),w.addNeedsSaving(r.id),g.push("/project/".concat(f,"/sql/").concat(r.id))}catch(e){d.setNotification({category:"error",message:"Failed to create new query: ".concat(e.message)})}case 3:case"end":return e.stop()}},e)})),function(e,n){return t.apply(this,arguments)}),[null==x?void 0:x.id,null==y?void 0:y.id,f,g,w,d]),tD=(0,l.useCallback)((0,r.Z)(s().mark(function e(){var t,n,r,i;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,eY(!0),eb){e.next=4;break}return e.abrupt("return");case 4:if(!(!tk.current||!tE.current)){e.next=6;break}return e.abrupt("return");case 6:if(t=tk.current.getModel(),n=tE.current.getModel(),!(!t||!n)){e.next=10;break}return e.abrupt("return");case 10:if(r=n.modified.getValue(),e4!==eN.U.NewSnippet){e.next=20;break}return e.next=14,$({sql:r});case 14:return i=e.sent.title,e.next=18,tP(r,i);case 18:e.next=22;break;case 20:tk.current.executeEdits("apply-ai-edit",[{text:r,range:t.getFullModelRange()}]),ej&&w.renameSnippet(b,ej);case 22:ec.Z.sendEvent({category:"sql_editor",action:"ai_suggestion_accepted",label:eg?"debug_snippet":"edit_snippet"},h,g),ed(""),e5(eN.U.Modification),eh(void 0),ex(void 0),ew(void 0);case 28:return e.prev=28,eY(!1),e.finish(28);case 31:case"end":return e.stop()}},e,null,[[0,,28,31]])})),[eb,e4,tP,$,eg,h,g,b,ej,w]),tq=(0,l.useCallback)(function(){ec.Z.sendEvent({category:"sql_editor",action:"ai_suggestion_rejected",label:eg?"debug_snippet":"edit_snippet"},h,g),eh(void 0),ex(void 0),ew(void 0)},[eg,h,g]);(0,l.useEffect)(function(){var e=function(e){if(tp)switch(e.key){case"Enter":tD();return;case"Escape":tq();return}};return window.addEventListener("keydown",e),function(){return window.removeEventListener("keydown",e)}},[tp,tD,tq]);var tZ=(0,l.useCallback)(function(){var e,t=null===(e=tE.current)||void 0===e?void 0:e.getModel();if(!t)throw Error("Diff editor's model not available");if(!eb)throw Error("Returned SQL diff not available");t.original.setValue(eb.original),t.modified.setValue(eb.modified)},[eb]),tR=(0,l.useCallback)(function(){var e,t=null===(e=tE.current)||void 0===e?void 0:e.getModel();if(!t)throw Error("Diff editor's model not available");if(!eb)throw Error("Returned SQL diff not available");var n=eb.original.replace(ek.eg,"").trim(),r=eb.modified.replace(ek.eg,"").trim(),i=ek.eg+"\n\n"+(n?n+"\n\n":"")+r;t.original.setValue(eb.original),t.modified.setValue(i)},[eb]),tL=(0,l.useCallback)(function(){var e,t=null===(e=tE.current)||void 0===e?void 0:e.getModel();if(!t)throw Error("Diff editor's model not available");if(!eb)throw Error("Returned SQL diff not available");t.original.setValue(""),t.modified.setValue(eb.modified)},[eb]);return(0,ef.jsxs)(ts.Provider,{value:{aiInput:B,setAiInput:ed,sqlDiff:eb,setSqlDiff:ex,debugSolution:eg,setDebugSolution:eh},children:[(0,ef.jsx)(eO,{visible:ez,onCancel:function(){return eF(!1)}}),(0,ef.jsx)(G.Z,{visible:eV,title:"Destructive operation",danger:!0,description:"We've detected a potentially destructive operation in the query. Please confirm that you would like to execute this query.",buttonLabel:"Run destructive query",onSelectCancel:function(){eW(!1)},onSelectConfirm:function(){eW(!1),tC(!0)}}),(0,ef.jsxs)("div",{className:"flex h-full flex-col relative",children:[eA&&eD&&!eZ&&(0,ef.jsx)(em,{onClickSettings:function(){eF(!0)},children:(0,ef.jsx)(C.E.div,{layoutId:"ask-ai-input-container",variants:{visible:{borderRadius:0,x:0},hidden:{x:100}},initial:e8?"visible":"hidden",animate:"visible",className:"w-full flex justify-center z-10 h-[60px] bg-brand-300 border-b border-brand-400 px-5",children:(0,ef.jsxs)("div",{className:(0,L.cn)("w-full !border-brand-900 border-none !shadow-none","flex items-center gap-3"),children:[(0,ef.jsx)(C.E.div,{layoutId:"ask-ai-input-icon",transition:{duration:.1},children:(0,ef.jsx)(A.c,{loading:to})}),(0,ef.jsxs)(P.M,{initial:!1,exitBeforeEnter:!0,children:[eg&&(0,ef.jsx)("div",{className:"h-full w-full flex flex-row items-center overflow-y-hidden text-sm text-white",children:eg}),!to&&!eg&&(0,ef.jsx)(C.E.div,{className:"w-full h-full relative flex items-center",variants:{visible:{opacity:1,y:0},hidden:{opacity:0,y:-25}},initial:"hidden",animate:"visible",exit:"hidden",transition:{duration:.1},children:(0,ef.jsx)(I.I,{value:B,onChange:function(e){return ed(e.currentTarget.value)},disabled:tp,ref:eP,className:(0,L.cn)("!p-0 bg-transparent border-transparent text-sm text-brand-600 placeholder:text-brand-500 focus:!ring-0","focus-visible:ring-0 focus-visible:ring-offset-0","appearance-none outline-none"),placeholder:eg?"":null!=tj&&tj.snippet.content.sql.trim()?"Ask Supabase AI to modify your query":"Ask Supabase AI to build a query",onKeyDown:function(e){"Escape"!==e.key||B||eI(!1)},onKeyPress:(n=(0,r.Z)(s().mark(function e(t){var n,r,i,a,o,c,l;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key){e.next=32;break}if(e.prev=1,r=t.currentTarget.value){e.next=5;break}return e.abrupt("return");case 5:if(i=null===(n=tk.current)||void 0===n?void 0:n.getValue()){e.next=15;break}return e.next=10,E({prompt:r,entityDefinitions:td});case 10:a=(c=e.sent).sql,o=c.title,e.next=20;break;case 15:return e.next=18,H({prompt:r,sql:i.replace(ek.eg,"").trim(),entityDefinitions:td});case 18:a=e.sent.sql;case 20:if(eB(function(e){return e+1}),l=ek.eg+"\n\n"+(0,R.WU)(a,{language:"postgresql",keywordCase:"lower"}),!(i&&l.trim()===i.trim())){e.next=25;break}return d.setNotification({category:"error",message:"Unable to edit SQL. Try adding more details to your prompt."}),e.abrupt("return");case 25:ex({original:null!=i?i:"",modified:l}),o&&ew(o),e.next=32;break;case 29:e.prev=29,e.t0=e.catch(1),(0,ei.V)(e.t0)&&d.setNotification({category:"error",message:e.t0.message});case 32:case"end":return e.stop()}},e,null,[[1,29]])})),function(e){return n.apply(this,arguments)})})},"ask-ai-input"),to&&(0,ef.jsx)(C.E.div,{className:"p-0 flex flex-row gap-2 items-center w-full",variants:{visible:{opacity:1,y:0},hidden:{opacity:0,y:25}},transition:{duration:.2},initial:"hidden",animate:"visible",exit:"hidden",children:(0,ef.jsx)(C.E.span,{className:"text-sm text-brand px-3",animate:{opacity:["0.5","0.75","0.5"],transition:{ease:"linear",duration:.33,repeat:1/0}},children:"Thinking..."})},"ask-ai-loading")]}),(0,ef.jsx)("div",{className:"flex flex-row items-center gap-3 mr-1",children:tp?(0,ef.jsxs)(ef.Fragment,{children:[(0,ef.jsxs)("div",{className:"flex items-center",children:[(0,ef.jsx)(T.z,{className:"rounded-r-none",type:"primary",size:"tiny",icon:eJ?(0,ef.jsx)(F.Z,{className:"animate-spin",size:14}):(0,ef.jsx)(z.Z,{}),iconRight:(0,ef.jsx)("div",{className:"opacity-30",children:(0,ef.jsx)(Q.Z,{size:12,strokeWidth:1.5})}),onClick:tD,children:(0,eE.re)(e4)}),(0,ef.jsxs)(V.h_,{children:[(0,ef.jsx)(V.$F,{asChild:!0,children:(0,ef.jsx)(T.z,{type:"primary",className:"rounded-l-none border-l-0 px-[4px] py-[5px] flex",icon:(0,ef.jsx)(W.Z,{})})}),(0,ef.jsx)(V.AW,{align:"end",side:"bottom",children:Object.values(eN.U).filter(function(e){return e!==e4}).map(function(e){return(0,ef.jsx)(V.Xi,{onClick:function(){switch(e5(e),e){case eN.U.Modification:return tZ();case eN.U.Addition:return tR();case eN.U.NewSnippet:return tL();default:throw Error("Unknown diff type '".concat(e,"'"))}},children:(0,ef.jsx)("p",{children:(0,eE.IT)(e)})},e)})})]})]}),(0,ef.jsx)(T.z,{type:"alternative",size:"tiny",icon:(0,ef.jsx)(M.Z,{}),iconRight:(0,ef.jsx)("span",{className:"opacity-30",children:"ESC"}),onClick:tq,children:"Discard"})]}):(0,ef.jsxs)(ef.Fragment,{children:[(0,ef.jsx)("div",{className:(0,L.cn)("transition text-brand",B?"opacity-30":"opacity-0"),children:(0,ef.jsx)(Q.Z,{size:16,strokeWidth:1.5})}),(0,ef.jsx)("button",{onClick:function(){e1(!0),eF(!0)},className:"text-brand-600 hover:text-brand-600 transition",children:(0,ef.jsx)(U.Z,{className:"cursor-pointer"})}),(0,ef.jsx)("button",{className:"text-brand-600 hover:text-brand-600",onClick:function(){return eI(!1)},children:(0,ef.jsx)(M.Z,{size:21})})]})})]})},"ask-ai-input-container")}),(0,ef.jsxs)(Z.Z,{style:{height:"100%"},direction:"vertical",gutterSize:2,sizes:null!==(c=tv||(null==tj?void 0:tj.splitSizes))&&void 0!==c?c:[50,50],minSize:44,snapOffset:50,expandToMin:!0,onDragEnd:tO,children:[(0,ef.jsxs)("div",{className:"flex-grow overflow-y-auto border-b",children:[!eA&&(0,ef.jsx)(C.E.button,{layoutId:"ask-ai-input-icon",transition:{duration:.1},onClick:function(){return eI(!eA)},className:(0,L.cn)("group","absolute z-10","rounded-lg","right-[24px] top-4","transition-all duration-200","ease-out"),children:(0,ef.jsx)(A.c,{loading:!1,allowHoverEffect:!0})}),tw?(0,ef.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:"Loading..."}):(0,ef.jsxs)(ef.Fragment,{children:[tp&&(0,ef.jsx)(C.E.div,{className:"w-full h-full",variants:{visible:{opacity:1,filter:"blur(0px)"},hidden:{opacity:0,filter:"blur(10px)"}},initial:"hidden",animate:"visible",children:(0,ef.jsx)(ti,{theme:"supabase",language:"pgsql",original:eb.original,modified:eb.modified,onMount:function(e){tE.current=e;var t=!0;e.onDidUpdateDiff(function(){if(t){var n=e.getModel(),r=e.getLineChanges();if(n&&r&&0!==r.length){var i=n.original.getValue(),s=(0,R.WU)(i.replace(ek.eg,"").trim(),{language:"postgresql",keywordCase:"lower"}),a=n.modified.getValue(),o=i.includes(ek.eg)?(ek.eg+"\n\n").split("\n").length:0,c=n.original.getLineCount()-o;r.some(function(e){return e.originalEndLineNumber-e.originalStartLineNumber>.5*c})&&!a.includes(s)&&(e5(eN.U.Addition),tR()),t=!1}}})},options:{fontSize:13}})}),(0,ef.jsx)(C.E.div,{variants:{visible:{opacity:1,filter:"blur(0px)"},hidden:{opacity:0,filter:"blur(10px)"}},initial:"hidden",animate:tp?"hidden":"visible",className:"w-full h-full",children:(0,ef.jsx)(tr,{autoFocus:!0,id:b,editorRef:tk,monacoRef:tN,executeQuery:tC,onHasSelection:eC})},b)]})]}),(0,ef.jsx)("div",{className:"flex flex-col",children:tw?(0,ef.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:"Loading..."}):(0,ef.jsx)(tn,{id:b,isExecuting:ty,isDisabled:tp,hasSelection:e_,prettifyQuery:t_,executeQuery:tC})})]})]})]})},to=n(11425),tc=n(81250);function tl(e){return e.replace(/^\"/,"").replace(/\"$/,"").replace(/\"\"/,'"')}function tu(e){return e!=e.toLowerCase()?'"'.concat(e,'"'):e}var td=n(44172),tp=function(){var e=(0,a.useRouter)(),t=(0,o.useMonaco)(),n=(0,u.UO)(),i=n.id,c=n.ref,d=(0,eS.d2)().project,p=(0,el.W2)(),f=(0,td.WZ)(),m=(0,el.Fy)(c),h=S().mutateAsync;function y(e){return j.apply(this,arguments)}function j(){return(j=(0,r.Z)(s().mark(function e(t){var n;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,d){e.next=3;break}throw Error("No project");case 3:return e.next=5,h({projectRef:d.ref,connectionString:d.connectionString,sql:t});case 5:return n=e.sent,e.abrupt("return",n.result);case 9:return e.prev=9,e.t0=e.catch(0),console.error("formatPgsql error:",e.t0),e.abrupt("return",t);case 13:case"end":return e.stop()}},e,null,[[0,9]])}))).apply(this,arguments)}var w=v({projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString}),O=w.data,k=w.isSuccess,N=g({projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString}),E=N.data,_=N.isSuccess,C=(0,b.Q1)({projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString}),P=C.data,D=C.isSuccess,q=(0,x.K)({projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString}),Z=q.data,R=q.isSuccess,L=(0,l.useRef)(null),A=(0,l.useRef)(y);A.current=y;var I=R&&D&&k&&_;return I&&(null===L.current&&(L.current={}),L.current.tableColumns=null==Z?void 0:Z.result,L.current.schemas=P,L.current.keywords=null==O?void 0:O.result,L.current.functions=null==E?void 0:E.result),(0,l.useEffect)(function(){"new"===i&&void 0!==f.dashboardHistory.sql&&void 0!==m.find(function(e){return e.id===f.dashboardHistory.sql})&&e.push("/project/".concat(c,"/sql/").concat(f.dashboardHistory.sql))},[i,m]),(0,l.useEffect)(function(){if(t){var e=t.languages.registerDocumentFormattingEditProvider("pgsql",{provideDocumentFormattingEdits:function(e){return(0,r.Z)(s().mark(function t(){var n,r;return s().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.getValue(),t.next=3,A.current(n);case 3:return r=t.sent,i&&p.setSql(i,r),t.abrupt("return",[{range:e.getFullModelRange(),text:r}]);case 6:case"end":return t.stop()}},t)}))()}});return function(){return e.dispose()}}},[t]),(0,l.useEffect)(function(){if(I){var e,n;return t&&I&&(e=t.languages.registerCompletionItemProvider("pgsql",{triggerCharacters:[" ",".",'"'],provideCompletionItems:function(e,n,r){try{var i,s,a,o,c,l=new tc.Z(e,n.column-2,n.lineNumber-1);if('"'===r.triggerCharacter)return function(e,t,n){var r=[];if(!n.isFowardDQuote())return{suggestions:r};if(n.next(),n.isNextPeriod()){var i=n.readIdent(),s=!1;i.match(/^\".*?\"$/)&&(s=!0,i=tl(i));var a=t.current.tableColumns.find(function(e){return s&&e.tablename===i||!s&&e.tablename.toLocaleLowerCase()==i.toLocaleLowerCase()});if(!a)return{suggestions:r};a.columns.forEach(function(t){r.push({label:t.attname,kind:e.languages.CompletionItemKind.Property,detail:t.data_type,insertText:t.attname})})}else t.current.tableColumns.forEach(function(t){r.push({label:t.tablename,kind:e.languages.CompletionItemKind.Class,insertText:t.tablename})});return{suggestions:r}}(t,L,l);if("."===r.triggerCharacter)return function(e,t,n){var r=[],i=n.readIdents(3).map(function(e){var t=!1;return e.match(/^\".*?\"$/)&&(t=!0,e=tl(e)),{isQuoted:t,name:e}}),s=0,a=t.current.schemas.find(function(e){var t,n,r=i&&i.length>s?i[s]:{};return r.isQuoted&&e.name===r.name||!r.isQuoted&&(null===(t=e.name)||void 0===t?void 0:t.toLocaleLowerCase())==(null===(n=r.name)||void 0===n?void 0:n.toLocaleLowerCase())});if(a?s++:a=t.current.schemas.find(function(e){return"public"==e.name}),i.length==s)return t.current.tableColumns.forEach(function(t){t.schemaname==a.name&&r.push({label:t.tablename,kind:e.languages.CompletionItemKind.Class,detail:"public"!==t.schemaname?t.schemaname:null,insertText:tu(t.tablename)})}),{suggestions:r};var o=t.current.tableColumns.find(function(e){var t,n,r=i&&i.length>s?i[s]:{};return e.schemaname==a.name&&r.isQuoted&&e.tablename===r.name||!r.isQuoted&&(null===(t=e.tablename)||void 0===t?void 0:t.toLocaleLowerCase())==(null===(n=r.name)||void 0===n?void 0:n.toLocaleLowerCase())});return o&&o.columns.forEach(function(t){r.push({label:t.attname,kind:e.languages.CompletionItemKind.Property,detail:t.data_type,insertText:tu(t.attname)})}),{suggestions:r}}(t,L,l);return c=[],(null===(i=L.current.keywords)||void 0===i?void 0:i.length)>0&&L.current.keywords.forEach(function(e){c.push({label:e,kind:t.languages.CompletionItemKind.Keyword,insertText:e})}),(null===(s=L.current.schemas)||void 0===s?void 0:s.length)>0&&L.current.schemas.forEach(function(e){c.push({label:e.name,kind:t.languages.CompletionItemKind.Keyword,insertText:e.name})}),(null===(a=L.current.tableColumns)||void 0===a?void 0:a.length)>0&&L.current.tableColumns.forEach(function(e){var n="public"==e.schemaname?e.tablename:e.schemaname+"."+e.tablename;c.push({label:e.tablename,detail:"public"!==e.schemaname?e.schemaname:null,kind:e.is_table?t.languages.CompletionItemKind.Class:t.languages.CompletionItemKind.Interface,insertText:tu(n)}),e.columns.forEach(function(n){if(n){var r=c.find(function(e){return e.label===(null==n?void 0:n.attname)&&e.kind===t.languages.CompletionItemKind.Field&&e.detail===(null==n?void 0:n.data_type)});r?(r.tables.push(e.tablename),r.tables.sort(),r.documentation=r.tables.join(", ")):c.push({label:n.attname,kind:t.languages.CompletionItemKind.Field,detail:n.data_type,documentation:e.tablename,tables:[e.tablename],insertText:tu(n.attname)})}})}),(null===(o=L.current.functions)||void 0===o?void 0:o.length)>0&&L.current.functions.forEach(function(e){c.push({label:e.name,kind:t.languages.CompletionItemKind.Function,detail:e.result_type,documentation:e.description,insertText:e.name})}),{suggestions:c}}catch(e){return{suggestions:[]}}}}),n=t.languages.registerSignatureHelpProvider("pgsql",{signatureHelpTriggerCharacters:["(",","],provideSignatureHelp:function(e,t){var n=new tc.Z(e,t.column-2,t.lineNumber-1),r=n.readArguments();if(r<0)return null;var i=n.readIdent();if(!i||i.match(/^\".*?\"$/))return null;var s=L.current.functions.find(function(e){return e.name.toLocaleLowerCase()===i.toLocaleLowerCase()});if(!s||!s.args||s.args.length<r)return null;var a=Math.min(r,s.args.length-1),o=[];return o.push({label:"".concat(s.name,"( ").concat(s.args.join(" , ")," )"),documentation:s.description,parameters:s.args.map(function(e){return{label:e}})}),{value:{signatures:o,activeSignature:0,activeParameter:a},dispose:function(){}}}})),function(){var t,r;null===(t=e)||void 0===t||t.dispose(),null===(r=n)||void 0===r||r.dispose()}}},[I]),(0,ef.jsx)("div",{className:"SQLTabContainer flex-1",children:(0,ef.jsx)(ta,{})})};tp.getLayout=function(e){return(0,ef.jsx)(to.Vk,{title:"SQL",children:e})};var tf=(0,c.Pi)(tp)},24564:function(e,t,n){"use strict";var r=n(95235);n(2784);var i=n(52145),s=n(12223),a=n(52322);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}t.Z=function(e){return(0,a.jsx)(s.Z,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({icon:i.Z},e))}},98528:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/sql/[id]",function(){return n(81979)}])}},function(e){e.O(0,[1187,8421,4747,7287,7898,6218,3614,6782,2841,2923,2514,2187,2645,6823,7725,9774,2888,179],function(){return e(e.s=98528)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8447],{381:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return R}});var s=t(59491),r=t(46776),i=t(2784),c=t(92913),o=t(81333),a=t(24990),l=t(76635),d=t(14665),u=t(55210),x=t(8647),h=t(97064),f=t(85577),j=t(55268),m=t(45812),p=t(22812),g=t(59800),b=t(70203),N=t(85459),v=t(5632),y=t(93306),_=t(924),Z=t(61422),w=t(90464),S=t(77426),F=t(52322),E=(0,r.Pi)(function(e){var n=e.schema,t=e.filterString,r=e.isLocked,i=e.editFunction,c=void 0===i?l.noop:i,o=e.deleteFunction,d=void 0===o?l.noop:o,u=(0,v.useRouter)(),f=(0,b.oR)().meta,m=(0,h.d2)().project,p=f.functions.list().filter(function(e){return(0,l.includes)(e.name.toLowerCase(),t.toLowerCase())}).filter(function(e){return e.schema==n}),g=null==m?void 0:m.ref,N=(0,b.Xo)(s.KA.TENANT_SQL_ADMIN_WRITE,"functions");return 0===p.length&&0===t.length?(0,F.jsx)(j.Z.tr,{children:(0,F.jsxs)(j.Z.td,{colSpan:5,children:[(0,F.jsx)("p",{className:"text-sm text-foreground",children:"No functions created yet"}),(0,F.jsxs)("p",{className:"text-sm text-foreground-light",children:['There are no functions found in the schema "',n,'"']})]})},n):0===p.length&&t.length>0?(0,F.jsx)(j.Z.tr,{children:(0,F.jsxs)(j.Z.td,{colSpan:5,children:[(0,F.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,F.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',t,'" did not return any results']})]})},n):(0,F.jsx)(F.Fragment,{children:p.map(function(e){var t="public"==n&&"trigger"!==e.return_type;return(0,F.jsxs)(j.Z.tr,{children:[(0,F.jsx)(j.Z.td,{className:"truncate",children:(0,F.jsx)("p",{title:e.name,children:e.name})}),(0,F.jsx)(j.Z.td,{className:"hidden md:table-cell md:overflow-auto",children:(0,F.jsx)("p",{title:e.argument_types,children:e.argument_types||"-"})}),(0,F.jsx)(j.Z.td,{className:"hidden lg:table-cell",children:(0,F.jsx)("p",{title:e.return_type,children:e.return_type})}),(0,F.jsx)(j.Z.td,{className:"hidden lg:table-cell",children:e.security_definer?"Definer":"Invoker"}),(0,F.jsx)(j.Z.td,{className:"text-right",children:!r&&(0,F.jsx)("div",{className:"flex items-center justify-end",children:N?(0,F.jsxs)(y.h_,{children:[(0,F.jsx)(y.$F,{children:(0,F.jsx)(x.z,{asChild:!0,type:"default",icon:(0,F.jsx)(_.Z,{}),className:"px-1",children:(0,F.jsx)("span",{})})}),(0,F.jsxs)(y.AW,{side:"left",children:[t&&(0,F.jsxs)(y.Xi,{className:"space-x-2",onClick:function(){return u.push("/project/".concat(g,"/api?rpc=").concat(e.name))},children:[(0,F.jsx)(Z.Z,{size:"tiny"}),(0,F.jsx)("p",{children:"Client API docs"})]}),(0,F.jsxs)(y.Xi,{className:"space-x-2",onClick:function(){return c(e)},children:[(0,F.jsx)(w.Z,{size:"tiny"}),(0,F.jsx)("p",{children:"Edit function"})]}),(0,F.jsxs)(y.Xi,{className:"space-x-2",onClick:function(){return d(e)},children:[(0,F.jsx)(S.Z,{stroke:"red",size:"tiny"}),(0,F.jsx)("p",{children:"Delete function"})]})]})]}):(0,F.jsxs)(a.fC,{delayDuration:0,children:[(0,F.jsx)(a.xz,{asChild:!0,children:(0,F.jsx)(x.z,{disabled:!0,type:"default",icon:(0,F.jsx)(_.Z,{}),className:"px-1"})}),(0,F.jsx)(a.h_,{children:(0,F.jsxs)(a.VY,{side:"left",children:[(0,F.jsx)(a.Eh,{className:"radix-tooltip-arrow"}),(0,F.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,F.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to update functions"})})]})})]})})})]},e.id)})})}),O=t(19269),k=t(1846),C=(0,r.Pi)(function(e){var n=e.createFunction,t=void 0===n?l.noop:n,r=e.editFunction,c=void 0===r?l.noop:r,v=e.deleteFunction,y=void 0===v?l.noop:v,_=(0,h.d2)().project,Z=(0,b.oR)().meta,w=(0,i.useState)("public"),S=w[0],C=w[1],P=(0,i.useState)(""),A=P[0],D=P[1],L=(0,b.Xo)(s.KA.TENANT_SQL_ADMIN_WRITE,"functions"),R=(0,g.Q1)({projectRef:null==_?void 0:_.ref,connectionString:null==_?void 0:_.connectionString}).data,T=(0,l.partition)(null!=R?R:[],function(e){var n;return N.F.includes(null!==(n=null==e?void 0:e.name)&&void 0!==n?n:"")}),z=(0,o.Z)(T,1)[0],X=null==R?void 0:R.find(function(e){return e.name===S}),I=z.some(function(e){return e.id===(null==X?void 0:X.id)}),Q=Z.functions.list();return Z.functions.isLoading?(0,F.jsx)(p.A,{}):Z.functions.hasError?(0,F.jsx)(m.Z,{error:Z.functions.error,subject:"Failed to retrieve database functions"}):(0,F.jsx)(F.Fragment,{children:0==Q.length?(0,F.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,F.jsxs)(f.Z,{title:"Functions",ctaButtonLabel:"Create a new function",onClickCta:function(){return t()},disabled:!L,disabledMessage:"You need additional permissions to create functions",children:[(0,F.jsx)("p",{className:"text-sm text-foreground-light",children:"PostgreSQL functions, also known as stored procedures, is a set of SQL and procedural commands such as declarations, assignments, loops, flow-of-control, etc."}),(0,F.jsx)("p",{className:"text-sm text-foreground-light",children:"It's stored on the database server and can be invoked using the SQL interface."})]})}):(0,F.jsxs)("div",{className:"w-full space-y-4",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between",children:[(0,F.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,F.jsx)(O.Z,{className:"w-[260px]",size:"small",showError:!1,selectedSchemaName:S,onSelectSchema:C}),(0,F.jsx)(d.Z,{placeholder:"Search for a function",size:"small",icon:(0,F.jsx)(u.Z,{size:"tiny"}),value:A,className:"w-64",onChange:function(e){return D(e.target.value)}})]}),!I&&(0,F.jsxs)(a.fC,{delayDuration:0,children:[(0,F.jsx)(a.xz,{children:(0,F.jsx)(x.z,{disabled:!L,onClick:function(){return t()},children:"Create a new function"})}),!L&&(0,F.jsx)(a.h_,{children:(0,F.jsx)(a.h_,{children:(0,F.jsxs)(a.VY,{side:"bottom",children:[(0,F.jsx)(a.Eh,{className:"radix-tooltip-arrow"}),(0,F.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,F.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to create functions"})})]})})})]})]}),I&&(0,F.jsx)(k.Z,{schema:S,entity:"functions"}),(0,F.jsx)(j.Z,{className:"table-fixed",head:(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(j.Z.th,{children:"Name"},"name"),(0,F.jsx)(j.Z.th,{className:"hidden md:table-cell",children:"Arguments"},"arguments"),(0,F.jsx)(j.Z.th,{className:"hidden lg:table-cell",children:"Return type"},"return_type"),(0,F.jsx)(j.Z.th,{className:"hidden lg:table-cell w-[100px]",children:"Security"},"return_type"),(0,F.jsx)(j.Z.th,{className:"w-1/6"},"buttons")]}),body:(0,F.jsx)(E,{schema:S,filterString:A,isLocked:I,editFunction:c,deleteFunction:y})})]})})}),P=t(11425),A=t(86866),D=t(48125),L=function(){var e=(0,b.oR)(),n=e.ui,t=e.meta,r=(0,i.useState)(),o=r[0],a=r[1],l=(0,i.useState)(!1),d=l[0],u=l[1],x=(0,i.useState)(!1),h=x[0],f=x[1],j=(0,b.Xo)(s.KA.TENANT_SQL_ADMIN_READ,"functions");return((0,i.useEffect)(function(){n.selectedProjectRef&&t.functions.load()},[n.selectedProjectRef]),j)?(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(A._S,{children:(0,F.jsx)(A.jX,{children:(0,F.jsxs)("div",{className:"col-span-12",children:[(0,F.jsx)("h3",{className:" mb-4 text-xl text-foreground",children:"Database Functions"}),(0,F.jsx)(C,{createFunction:function(){a(void 0),u(!0)},editFunction:function(e){a(e),u(!0)},deleteFunction:function(e){a(e),f(!0)}})]})})}),(0,F.jsx)(c.B8,{func:o,visible:d,setVisible:u}),(0,F.jsx)(c.ZR,{func:o,visible:h,setVisible:f})]}):(0,F.jsx)(D.Z,{isFullPage:!0,resourceText:"view database functions"})};L.getLayout=function(e){return(0,F.jsx)(P._h,{title:"Database",children:e})};var R=(0,r.Pi)(L)},90464:function(e,n,t){"use strict";var s=t(95235);t(2784);var r=t(59330),i=t(12223),c=t(52322);function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,s)}return t}n.Z=function(e){return(0,c.jsx)(i.Z,function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach(function(n){(0,s.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}({icon:r.Z},e))}},35353:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/database/functions",function(){return t(381)}])}},function(e){e.O(0,[6139,1187,8421,4747,7287,7898,6218,9001,2758,7610,7142,2514,2187,2645,6823,7725,7740,1414,655,9774,2888,179],function(){return e(e.s=35353)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8367],{57626:function(e,t,n){"use strict";n.d(t,{iN:function(){return j},ph:function(){return u},by:function(){return x},hj:function(){return f},B4:function(){return m},S0:function(){return p},ld:function(){return s}});var r=n(52322);function s(e){return(0,r.jsxs)("div",{className:"mx-auto max-w-4xl px-5 pt-12 pb-20",children:[e.header&&(0,r.jsx)("h1",{className:"text-foreground mb-8 text-3xl",children:e.header}),(0,r.jsx)("div",{className:"space-y-20",children:e.children})]})}var o=n(39097),a=n.n(o),i=n(29071),c=n(8647),l=n(95223),u=function(e){var t=e.title,n=e.description,s=e.docsUrl;return(0,r.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("h3",{className:"text-foreground text-xl",children:(0,r.jsx)(i.D,{unwrapDisallowed:!0,disallowedElements:["p"],children:t})}),n&&(0,r.jsx)("div",{className:"text-foreground-lighter text-sm",children:(0,r.jsx)(i.D,{children:n})})]}),void 0!==s&&(0,r.jsx)(c.z,{asChild:!0,type:"default",icon:(0,r.jsx)(l.Z,{}),children:(0,r.jsx)(a(),{href:s,target:"_blank",rel:"noreferrer",children:"Documentation"})})]})},d=n(2784),f=function(e){var t=e.children,n=e.id,s=e.header,o=e.disabled,a=e.visible,i=e.className;return(0,r.jsxs)("div",{id:n,className:["grid grid-cols-12 gap-6 px-8 py-8","".concat(o?" opacity-30":" opacity-100"),"".concat(void 0===a||a?" block":" hidden"),"".concat(i)].join(" "),children:[s,t]})},p=function(e){var t=e.children,n=e.className,s=void 0===n?"":n,o=e.description;return void 0!==o?(0,r.jsxs)("div",{className:"flex flex-col space-y-2 col-span-12 lg:col-span-5 ".concat(s),children:[(0,r.jsx)("label",{className:"text-foreground text-sm",children:t}),o]}):(0,r.jsx)("label",{className:"text-foreground col-span-12 text-sm lg:col-span-5 ".concat(s),children:t})},h=function(){return(0,r.jsxs)("div",{className:"flex w-full flex-col gap-2",children:[(0,r.jsx)("div",{className:"shimmering-loader h-2 w-1/3 rounded"}),(0,r.jsx)("div",{className:"flex flex-col justify-between space-y-2",children:(0,r.jsx)("div",{className:"shimmering-loader h-[34px] w-2/3 rounded"})})]})},m=function(e){var t=e.children,n=e.loading,s=e.fullWidth,o=e.className;return(0,r.jsx)("div",{className:"\n        relative col-span-12 flex flex-col gap-6 lg:col-span-7\n        ".concat(s&&"!col-span-12","\n        ").concat(o,"\n      "),children:void 0===n||n?d.Children.map(t,function(e){return(0,r.jsx)(h,{})}):t})},x=function(e){var t=e.children,n=e.header,s=e.footer;return(0,r.jsxs)("div",{className:" bg-surface-100 border-default overflow-hidden  rounded-md border shadow",children:[n&&(0,r.jsx)("div",{className:"border-default border-b px-8 py-4",children:n}),(0,r.jsx)("div",{className:"divide-border flex flex-col gap-0 divide-y",children:t}),s&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"border-default border-t"}),s]})]})},j=function(e){var t=e.form,n=e.hasChanges,s=void 0===n?void 0:n,o=e.handleReset,a=e.helper,i=e.disabled,l=e.isSubmitting,u=e.submitText,d=l||void 0!==i&&i||!s&&void 0!==s;return(0,r.jsxs)("div",{className:["flex w-full items-center gap-2",a?"justify-between":"justify-end"].join(" "),children:[a&&(0,r.jsx)("span",{className:"text-sm text-foreground-lighter",children:a}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(c.z,{disabled:d,type:"default",htmlType:"reset",onClick:function(){return o()},children:"Cancel"}),(0,r.jsx)(c.z,{form:t,type:"primary",htmlType:"submit",disabled:d,loading:l,children:void 0===u?"Save":u})]})]})}},56163:function(e,t,n){"use strict";var r=n(8647),s=n(52322);t.Z=function(e){var t=e.searchString,n=e.onResetFilter;return(0,s.jsxs)("div",{className:"bg-surface-100 border border-default px-6 py-4 rounded flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"No results found"}),(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',t,'" did not return any results']})]}),void 0!==n&&(0,s.jsx)(r.z,{type:"default",onClick:function(){return n()},children:"Reset filter"})]})}},45684:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eY}});var r=n(20406),s=n(28526),o=n.n(s),a=n(59491),i=n(46776),c=n(2784),l=n(43991),u=n(97064),d=n(61329),f=n(95235),p=n(82269),h=n(62202),m=n(55830),x=n(62350),j=n(37552),b=n(9747),v={list:function(e){return["projects",e,"database-triggers"]},resource:function(e,t){return["projects",e,"resources",t]}},g=["onSuccess","onError"];function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function w(){return(w=(0,r.Z)(o().mark(function e(t){var n,r,s,a,i;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id,r=t.projectRef,s=t.connectionString,a=new Headers,s&&a.set("x-connection-encrypted",s),e.next=5,(0,j.$v)("".concat(b.T5,"/pg-meta/").concat(r,"/triggers?id=").concat(n),void 0,{headers:Object.fromEntries(a)});case 5:if(!(null!=(i=e.sent)&&i.error)){e.next=8;break}throw i.error;case 8:return e.abrupt("return",i);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}var N=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onSuccess,n=e.onError,s=(0,p.Z)(e,g),a=(0,m.NL)();return(0,x.D)(function(e){return function(e){return w.apply(this,arguments)}(e)},function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach(function(t){(0,f.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({onSuccess:function(e,n,s){return(0,r.Z)(o().mark(function r(){var i;return o().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i=n.projectRef,r.next=3,a.invalidateQueries(v.list(i));case 3:return r.next=5,null==t?void 0:t(e,n,s);case 5:case"end":return r.stop()}},r)}))()},onError:function(e,t,s){return(0,r.Z)(o().mark(function r(){return o().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:void 0===n?h.Am.error("Failed to delete database trigger: ".concat(e.message)):n(e,t,s);case 1:case"end":return r.stop()}},r)}))()}},s))},O=n(70203),k=n(52322),S=function(e){var t=e.selectedHook,n=e.visible,s=e.onClose,a=(0,O.oR)().ui,i=null!=t?t:{},c=i.id,l=i.name,f=i.schema,p=(0,u.d2)().project,h=N({onSuccess:function(){a.setNotification({category:"success",message:"Successfully deleted ".concat(l)}),s()}}),m=h.mutate,x=h.isLoading;function j(){return(j=(0,r.Z)(o().mark(function e(){return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p){e.next=2;break}return e.abrupt("return",console.error("Project ref is required"));case 2:if(c){e.next=4;break}return e.abrupt("return",a.setNotification({category:"error",message:"Unable find selected hook"}));case 4:m({id:c,projectRef:p.ref,connectionString:p.connectionString});case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}return(0,k.jsx)(d.Z,{visible:n,size:"medium",onCancel:function(){return s()},onConfirm:function(){return j.apply(this,arguments)},title:"Delete database webhook",loading:x,confirmLabel:"Delete ".concat(l),confirmPlaceholder:"Type in name of webhook",confirmString:l||"",text:'This will delete the webhook "'.concat(l,'" from the schema "').concat(f,'".'),alert:"You cannot recover this webhook once it is deleted!"})},_=n(81333),P=n(12741),Z=n(38421),T=n.n(Z),E=n(4300),R=n(13734),C=n(57626),D=["onSuccess","onError"];function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function A(){return(A=(0,r.Z)(o().mark(function e(t){var n,r,s,a,i;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.projectRef,r=t.connectionString,s=t.payload,a=new Headers,r&&a.set("x-connection-encrypted",r),e.next=5,(0,j.v_)("".concat(b.T5,"/pg-meta/").concat(n,"/triggers"),s,{headers:Object.fromEntries(a)});case 5:if(!(i=e.sent).error){e.next=8;break}throw i.error;case 8:return e.abrupt("return",i);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}var z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onSuccess,n=e.onError,s=(0,p.Z)(e,D),a=(0,m.NL)();return(0,x.D)(function(e){return function(e){return A.apply(this,arguments)}(e)},function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach(function(t){(0,f.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({onSuccess:function(e,n,s){return(0,r.Z)(o().mark(function r(){var i;return o().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i=n.projectRef,r.next=3,a.invalidateQueries(v.list(i));case 3:return r.next=5,null==t?void 0:t(e,n,s);case 5:case"end":return r.stop()}},r)}))()},onError:function(e,t,s){return(0,r.Z)(o().mark(function r(){return o().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:void 0===n?h.Am.error("Failed to create database trigger: ".concat(e.message)):n(e,t,s);case 1:case"end":return r.stop()}},r)}))()}},s))},U=n(94170),L=n(48834).Buffer,F=["onSuccess","onError"];function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function q(){return(q=(0,r.Z)(o().mark(function e(t){var n,r,s,a;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.projectRef,r=t.connectionString,a=function(e){var t,n=e.originalTrigger,r=e.updatedTrigger,s=r.name,o=r.activation,a=r.events,i=r.schema,c=r.table,l=r.function_schema,u=r.function_name,d=r.function_args;return'\nBEGIN;\nDROP TRIGGER "'.concat(n.name,'" ON "').concat(n.schema,'"."').concat(n.table,'";\nCREATE TRIGGER "').concat(s,'" ').concat(o," ").concat(a.join(" OR "),' ON "').concat(i,'"."').concat(c,'" \n  FOR EACH ROW EXECUTE FUNCTION \n  "').concat(l,'"."').concat(u,'"(').concat(null!==(t=null==d?void 0:d.map(function e(t){var n=null,r=null;if(null==t)return"NULL";if(!1===t)return"'f'";if(!0===t)return"'t'";if(t instanceof Date)return"'"+t.toISOString().replace("T"," ").replace("Z","+00")+"'";if(t instanceof L)return"E'\\\\x"+t.toString("hex")+"'";if(!0===Array.isArray(t)){for(var s=[],o=0;o<t.length;o++)!0===Array.isArray(t[o])?s.push(function(e,t,n){var r="";r+=e?" (":"(";for(var s=0;s<t.length;s++)r+=(0===s?"":", ")+n(t[s]);return r+")"}(0!==o,t[o],e)):s.push(e(t[o]));return s.toString()}t===Object(t)?(r="jsonb",n=JSON.stringify(t)):n=t.toString().slice(0);for(var a=!1,i="'",c=0;c<n.length;c++){var l=n[c];"'"===l?i+=l+l:"\\"===l?(i+=l+l,a=!0):i+=l}return i+="'",!0===a&&(i="E"+i),r&&(i+="::"+r),i}).join(","))&&void 0!==t?t:"",");\nCOMMIT;\n").trim()}({originalTrigger:t.originalTrigger,updatedTrigger:s=t.updatedTrigger}),e.next=4,(0,U.Rj)({projectRef:n,connectionString:r,sql:a});case 4:return e.abrupt("return",s);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}var I=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onSuccess,n=e.onError,s=(0,p.Z)(e,F),a=(0,m.NL)();return(0,x.D)(function(e){return function(e){return q.apply(this,arguments)}(e)},function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(Object(n),!0).forEach(function(t){(0,f.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({onSuccess:function(e,n,s){return(0,r.Z)(o().mark(function r(){var i;return o().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i=n.projectRef,r.next=3,a.invalidateQueries(v.list(i));case 3:return r.next=5,null==t?void 0:t(e,n,s);case 5:case"end":return r.stop()}},r)}))()},onError:function(e,t,s){return(0,r.Z)(o().mark(function r(){return o().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:void 0===n?h.Am.error("Failed to update database trigger: ".concat(e.message)):n(e,t,s);case 1:case"end":return r.stop()}},r)}))()}},s))},B=n(98572),G=n(39203),M=n(4167),X=n(210),Y=n(24888),$=n(8647),Q=n(43635),V=n(36849),J=n(14665),K=n(31786),ee=n(41503),et=n(60229),en=[{label:"Insert",value:"INSERT",description:"Any insert operation on the table"},{label:"Update",value:"UPDATE",description:"Any update operation, of any column in the table"},{label:"Delete",value:"DELETE",description:"Any deletion of a record"}],er=[{value:"http_request",icon:"".concat(b.GW,"/img/function-providers/http-request.png"),label:"HTTP Request",description:"Send an HTTP request to any URL."}].concat((0,P.Z)(b.Qy?[{value:"supabase_function",icon:"".concat(b.GW,"/img/function-providers/supabase-severless-function.png"),label:"Supabase Edge Functions",description:"Choose a Supabase edge function to run."}]:[])),es=n(6277),eo=n(39097),ea=n.n(eo),ei=n(31941),ec=n(77426),el=n(31375),eu=n(93306),ed=n(77740),ef=function(e){var t=e.type,n=e.errors,r=e.httpHeaders,s=e.httpParameters,o=e.onAddHeader,a=e.onUpdateHeader,i=e.onRemoveHeader,c=e.onAddParameter,l=e.onUpdateParameter,d=e.onRemoveParameter,f=(0,u.d2)().project,p=(0,E.UO)().ref,h=(0,ei.qP)({projectRef:p}).data,m=(0,B.IB)({projectRef:p}).data,x=null!=m?m:[],j=null==h?void 0:h.autoApiService,b=null!=j&&j.service_api_keys.find(function(e){return"service_role key"===e.name})?j.serviceApiKey:"[YOUR API KEY]";return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(C.hj,{header:(0,k.jsx)(C.S0,{className:"lg:!col-span-4",children:"http_request"===t?"HTTP Request":"supabase_function"===t?"Edge Function":""}),children:(0,k.jsxs)(C.B4,{loading:!1,className:"lg:!col-span-8",children:[(0,k.jsxs)(K.Z,{id:"http_method",name:"http_method",size:"medium",label:"Method",children:[(0,k.jsx)(K.Z.Option,{id:"GET",value:"GET",label:"GET",children:"GET"}),(0,k.jsx)(K.Z.Option,{id:"POST",value:"POST",label:"POST",children:"POST"})]}),"http_request"===t?(0,k.jsx)(J.Z,{id:"http_url",name:"http_url",label:"URL",placeholder:"http://api.com/path/resource",descriptionText:"URL of the HTTP request. Must include HTTP/HTTPS"}):"supabase_function"===t&&0===x.length?(0,k.jsxs)("div",{className:"space-y-1",children:[(0,k.jsx)("p",{className:"text-sm text-foreground-light",children:"Select which edge function to trigger"}),(0,k.jsxs)("div",{className:"px-4 py-4 border rounded bg-surface-300 border-strong flex items-center justify-between space-x-4",children:[(0,k.jsx)("p",{className:"text-sm",children:"No edge functions created yet"}),(0,k.jsx)($.z,{asChild:!0,children:(0,k.jsx)(ea(),{href:"/project/".concat(p,"/functions"),children:"Create an edge function"})})]}),n.http_url&&(0,k.jsx)("p",{className:"text-sm text-red-900",children:n.http_url})]}):"supabase_function"===t&&x.length>0?(0,k.jsx)(K.Z,{id:"http_url",name:"http_url",label:"Select which edge function to trigger",children:x.map(function(e){var t=null==f?void 0:f.restUrl,n=new URL(t).hostname.split(".").pop(),r="https://".concat(p,".supabase.").concat(n,"/functions/v1/").concat(e.slug);return(0,k.jsx)(K.Z.Option,{id:r,value:r,label:e.name,children:e.name},e.id)})}):null,(0,k.jsx)(J.Z,{id:"timeout_ms",name:"timeout_ms",label:"Timeout",labelOptional:"Between 1000ms to 5000ms",type:"number",actions:(0,k.jsx)("p",{className:"text-foreground-light pr-2",children:"ms"})})]})}),(0,k.jsx)(Y.ZP.Separator,{}),(0,k.jsx)(C.hj,{header:(0,k.jsx)(C.S0,{className:"lg:!col-span-4",children:"HTTP Headers"}),children:(0,k.jsx)(C.B4,{loading:!1,className:"lg:!col-span-8",children:(0,k.jsxs)("div",{className:"space-y-2",children:[(void 0===r?[]:r).map(function(e,t){return(0,k.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,k.jsx)(J.Z,{value:e.name,size:"small",className:"w-full",placeholder:"Header name",onChange:function(e){return a(t,"name",e.target.value)}}),(0,k.jsx)(J.Z,{value:e.value,size:"small",className:"w-full",placeholder:"Header value",onChange:function(e){return a(t,"value",e.target.value)}}),(0,k.jsx)($.z,{type:"default",size:"medium",icon:(0,k.jsx)(ec.Z,{size:"tiny"}),className:"px-[10px] py-[9px]",onClick:function(){return i(t)}})]},e.id)}),(0,k.jsxs)("div",{className:"flex items-center",children:[(0,k.jsx)($.z,{type:"default",size:"tiny",icon:(0,k.jsx)(el.Z,{}),className:(0,es.default)("supabase_function"===t&&"rounded-r-none px-3"),onClick:o,children:"Add a new header"}),"supabase_function"===t&&(0,k.jsxs)(eu.h_,{children:[(0,k.jsx)(eu.$F,{children:(0,k.jsx)($.z,{type:"default",className:"rounded-l-none px-[4px] py-[5px]",icon:(0,k.jsx)(ed.Z,{})})}),(0,k.jsxs)(eu.AW,{align:"end",side:"bottom",children:[(0,k.jsx)(eu.Xi,{onClick:function(){return o({id:(0,X.k$)(),name:"Authorization",value:"Bearer ".concat(b)})},children:(0,k.jsxs)("div",{className:"space-y-1",children:[(0,k.jsx)("p",{className:"block text-foreground",children:"Add auth header with service key"}),(0,k.jsx)("p",{className:"text-foreground-light",children:"Required if your edge function enforces JWT verification"})]})},"add-auth-header"),(0,k.jsx)(eu.VD,{}),(0,k.jsx)(eu.Xi,{onClick:function(){return o({id:(0,X.k$)(),name:"x-supabase-webhook-source",value:"[Use a secret value]"})},children:(0,k.jsxs)("div",{className:"space-y-1",children:[(0,k.jsx)("p",{className:"block text-foreground",children:"Add custom source header"}),(0,k.jsx)("p",{className:"text-foreground-light",children:"Useful to verify that the edge function was triggered from this webhook"})]})},"add-source-header")]})]})]})]})})}),(0,k.jsx)(Y.ZP.Separator,{}),(0,k.jsx)(C.hj,{header:(0,k.jsx)(C.S0,{className:"lg:!col-span-4",children:"HTTP Parameters"}),children:(0,k.jsx)(C.B4,{loading:!1,className:"lg:!col-span-8",children:(0,k.jsxs)("div",{className:"space-y-2",children:[(void 0===s?[]:s).map(function(e,t){return(0,k.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,k.jsx)(J.Z,{size:"small",value:e.name,className:"w-full",placeholder:"Parameter name",onChange:function(e){return l(t,"name",e.target.value)}}),(0,k.jsx)(J.Z,{size:"small",value:e.value,className:"w-full",placeholder:"Parameter value",onChange:function(e){return l(t,"value",e.target.value)}}),(0,k.jsx)($.z,{type:"default",size:"medium",icon:(0,k.jsx)(ec.Z,{size:"tiny"}),className:"px-[10px] py-[9px]",onClick:function(){return d(t)}})]},e.id)}),(0,k.jsx)("div",{children:(0,k.jsx)($.z,{type:"default",size:"tiny",icon:(0,k.jsx)(el.Z,{}),onClick:c,children:"Add a new parameter"})})]})})})]})};function ep(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eh(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ep(Object(n),!0).forEach(function(t){(0,f.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ep(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var em=function(e){var t,n,s,a,i,l,d,f,p,h,m,x=e.visible,j=e.selectedHook,b=e.onClose,v=(0,E.UO)().ref,g=(0,O.oR)().ui,y=(0,c.useRef)(null),w=(0,c.useState)(!1),N=w[0],S=w[1],Z=(0,c.useState)(!1),T=Z[0],C=Z[1],D=(0,c.useState)([]),H=D[0],A=D[1],U=(0,c.useState)(),L=U[0],F=U[1],W=(0,c.useState)([]),q=W[0],J=W[1],K=(0,c.useState)([]),ee=K[0],et=K[1],en=(0,u.d2)().project,er=(0,M.Bj)({projectRef:null==en?void 0:en.ref,connectionString:null==en?void 0:en.connectionString}).data,es=(0,B.IB)({projectRef:v}).data,eo=(0,c.useState)(!1),ea=eo[0],ei=eo[1],ec=z({onSuccess:function(e){g.setNotification({category:"success",message:'Successfully created new webhook "'.concat(e.name,'"')}),ei(!1),b()},onError:function(e){ei(!1),g.setNotification({error:e,category:"error",message:"Failed to create webhook: ".concat(e.message)})}}).mutate,el=I({onSuccess:function(e){ei(!1),g.setNotification({category:"success",message:'Successfully updated webhook "'.concat(e.name,'"')}),b()},onError:function(e){ei(!1),g.setNotification({error:e,category:"error",message:"Failed to update webhook: ".concat(e.message)})}}).mutate,eu=(0,c.useMemo)(function(){return(0,P.Z)(null!=er?er:[]).sort(function(e,t){return e.schema>t.schema?0:-1})},[er]),ed=null==en?void 0:en.restUrl,ef=new URL(ed).hostname.split(".").pop(),ep=function(e){return e.includes("https://".concat(v,".functions.supabase.").concat(ef,"/"))||e.includes("https://".concat(v,".supabase.").concat(ef,"/functions/"))},eh={name:null!==(n=null==j?void 0:j.name)&&void 0!==n?n:"",table_id:null!==(s=null==j?void 0:j.table_id)&&void 0!==s?s:"",http_url:null!==(a=null==j?void 0:null===(i=j.function_args)||void 0===i?void 0:i[0])&&void 0!==a?a:"",http_method:null!==(l=null==j?void 0:null===(d=j.function_args)||void 0===d?void 0:d[1])&&void 0!==l?l:"POST",function_type:ep(null!==(f=null==j?void 0:null===(p=j.function_args)||void 0===p?void 0:p[0])&&void 0!==f?f:"")?"supabase_function":"http_request",timeout_ms:Number(null!==(h=null==j?void 0:null===(m=j.function_args)||void 0===m?void 0:m[4])&&void 0!==h?h:1e3)};(0,c.useEffect)(function(){if(x){if(S(!1),C(!1),void 0!==j){A(j.events);var e=(0,_.Z)(j.function_args,4),t=(e[0],e[1],e[2]),n=e[3],r=(0,X.dW)(t)||{};J(Object.keys(r).map(function(e){return{id:(0,X.k$)(),name:e,value:r[e]}}));var s=(0,X.dW)(n)||{};et(Object.keys(s).map(function(e){return{id:(0,X.k$)(),name:e,value:s[e]}}))}else A([]),J([{id:(0,X.k$)(),name:"Content-type",value:"application/json"}]),et([{id:(0,X.k$)(),name:"",value:""}])}},[x,j]);var em=function(){N?C(!0):b()},ej=function(e){H.includes(e)?A(H.filter(function(t){return t!==e})):A(H.concat(e)),F(void 0)},eb=(t=(0,r.Z)(o().mark(function e(t){var n,r,s,a;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(ei(!0),null!=en&&en.ref){e.next=3;break}return e.abrupt("return",console.error("Project ref is required"));case 3:if(0!==H.length){e.next=5;break}return e.abrupt("return",F("Please select at least one event"));case 5:return e.next=7,(0,G.hC)({id:t.table_id,projectRef:null==en?void 0:en.ref,connectionString:null==en?void 0:en.connectionString});case 7:if(n=e.sent){e.next=11;break}return ei(!1),e.abrupt("return",g.setNotification({category:"error",message:"Unable to find selected table"}));case 11:r=q.filter(function(e){return e.name&&e.value}).reduce(function(e,t){return e[t.name]=t.value,e},{}),s=ee.filter(function(e){return e.name&&e.value}).reduce(function(e,t){return e[t.name]=t.value,e},{}),a={events:H,activation:"AFTER",orientation:"ROW",enabled_mode:"ORIGIN",name:t.name,table:n.name,schema:n.schema,table_id:t.table_id,function_name:"http_request",function_schema:"supabase_functions",function_args:[t.http_url,t.http_method,JSON.stringify(r),JSON.stringify(s),t.timeout_ms.toString()]},void 0===j?ec({projectRef:null==en?void 0:en.ref,connectionString:null==en?void 0:en.connectionString,payload:a}):el({projectRef:null==en?void 0:en.ref,connectionString:null==en?void 0:en.connectionString,originalTrigger:j,updatedTrigger:a});case 15:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)});return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(Y.ZP,{size:"xlarge",visible:x,header:void 0===j?"Create a new database webhook":(0,k.jsxs)(k.Fragment,{children:["Update webhook ",(0,k.jsx)("code",{className:"text-sm",children:j.name})]}),className:"hooks-sidepanel mr-0 transform transition-all duration-300 ease-in-out",onConfirm:function(){},onCancel:function(){return em()},customFooter:(0,k.jsxs)("div",{className:"flex w-full justify-end space-x-3 border-t border-default px-3 py-4",children:[(0,k.jsx)($.z,{size:"tiny",type:"default",htmlType:"button",onClick:em,disabled:ea,children:"Cancel"}),(0,k.jsx)($.z,{size:"tiny",type:"primary",htmlType:"button",disabled:ea,loading:ea,onClick:function(){var e;return null==y?void 0:null===(e=y.current)||void 0===e?void 0:e.click()},children:void 0===j?"Create webhook":"Update webhook"})]}),children:(0,k.jsx)(Q.Z,{validateOnBlur:!0,initialValues:eh,onSubmit:eb,validate:function(e){var t={};return e.name||(t.name="Please provide a name for your webhook"),e.table_id||(t.table_id="Please select a table for which your webhook will trigger from"),"http_request"===e.function_type?e.http_url?e.http_url.startsWith("http")?(0,X.HH)(e.http_url)||(t.http_url="Please provide a valid URL"):t.http_url="Please include HTTP/HTTPs to your URL":t.http_url="Please provide a URL":"supabase_function"===e.function_type&&e.http_url.includes("undefined")&&(t.http_url="No edge functions available for selection"),(e.timeout_ms<1e3||e.timeout_ms>5e3)&&(t.timeout_ms="Timeout should be between 1000ms and 5000ms"),JSON.stringify(e)!==JSON.stringify(eh)&&S(!0),t},children:function(e){var t=e.values,n=e.resetForm,r=e.errors;return(0,k.jsx)(ex,{values:t,resetForm:n,errors:r,projectRef:v,restUrlTld:ef,functions:es,isEdgeFunction:ep,tables:eu,events:H,eventsError:L,onUpdateSelectedEvents:ej,httpHeaders:q,httpParameters:ee,setHttpHeaders:J,setHttpParameters:et,submitRef:y,selectedHook:j})}})}),(0,k.jsx)(R.Z,{visible:T,header:"Discard changes",buttonLabel:"Discard",onSelectCancel:function(){return C(!1)},onSelectConfirm:function(){C(!1),S(!1),b()},children:(0,k.jsx)(V.C.Content,{children:(0,k.jsx)("p",{className:"py-4 text-sm text-foreground-light",children:"There are unsaved changes. Are you sure you want to close the panel? Your changes will be lost."})})})]})},ex=function(e){var t=e.values,n=e.resetForm,r=e.errors,s=e.projectRef,o=e.restUrlTld,a=e.selectedHook,i=e.functions,l=e.isEdgeFunction,u=e.tables,d=e.events,p=e.eventsError,h=e.onUpdateSelectedEvents,m=e.httpHeaders,x=e.httpParameters,j=e.setHttpHeaders,b=e.setHttpParameters,v=e.submitRef;return(0,c.useEffect)(function(){if("http_request"===t.function_type){if(void 0!==a){var e=(0,_.Z)(a.function_args,2),r=e[0],c=e[1],u=eh(eh({},t),{},{http_url:r,http_method:c});n({values:u,initialValues:u})}else{var d=eh(eh({},t),{},{http_url:""});n({values:d,initialValues:d})}}else if("supabase_function"===t.function_type){var f,p=null===(f=(null!=i?i:[])[0])||void 0===f?void 0:f.slug,h="https://".concat(s,".supabase.").concat(o,"/functions/v1/").concat(p),m=eh(eh({},t),{},{http_url:l(t.http_url)?t.http_url:h});n({values:m,initialValues:m})}},[t.function_type]),(0,k.jsxs)("div",{children:[(0,k.jsx)(C.hj,{header:(0,k.jsx)(C.S0,{className:"lg:!col-span-4",children:"General"}),children:(0,k.jsx)(C.B4,{loading:!1,className:"lg:!col-span-8",children:(0,k.jsx)(J.Z,{id:"name",name:"name",label:"Name",descriptionText:"Do not use spaces/whitespaces"})})}),(0,k.jsx)(Y.ZP.Separator,{}),(0,k.jsx)(C.hj,{header:(0,k.jsx)(C.S0,{className:"lg:!col-span-4",description:(0,k.jsx)("p",{className:"text-sm text-foreground-light",children:"Select which table and events will trigger your webhook"}),children:"Conditions to fire webhook"}),children:(0,k.jsxs)(C.B4,{loading:!1,className:"lg:!col-span-8",children:[(0,k.jsxs)(K.Z,{size:"medium",id:"table_id",name:"table_id",label:"Table",descriptionText:"This is the table the trigger will watch for changes. You can only select 1 table for a trigger.",children:[(0,k.jsx)(K.Z.Option,{id:"table-no-selection",label:"---",value:"no-selection",children:"---"},"table-no-selection"),u.map(function(e){return(0,k.jsx)(K.Z.Option,{id:e.id.toString(),value:e.id,label:e.name,children:(0,k.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,k.jsx)("p",{className:"text-foreground-light",children:e.schema}),(0,k.jsx)("p",{className:"text-foreground",children:e.name})]})},e.id)})]}),(0,k.jsx)(ee.Z.Group,{id:"events",name:"events",label:"Events",error:p,descriptionText:"These are the events that are watched by the webhook, only the events selected above will fire the webhook on the table you've selected.",children:en.map(function(e){return(0,k.jsx)(ee.Z,{value:e.value,label:e.label,description:e.description,checked:d.includes(e.value),onChange:function(){return h(e.value)}},e.value)})})]})}),(0,k.jsx)(Y.ZP.Separator,{}),(0,k.jsx)(C.hj,{header:(0,k.jsx)(C.S0,{className:"lg:!col-span-4",children:"Webhook configuration"}),children:(0,k.jsx)(C.B4,{loading:!1,className:"lg:!col-span-8",children:(0,k.jsx)(et.Z.Group,{id:"function_type",name:"function_type",label:"Type of webhook",type:"cards",children:er.map(function(e){return(0,k.jsx)(et.Z,{id:e.value,value:e.value,label:"",beforeLabel:(0,k.jsxs)("div",{className:"flex items-center space-x-5",children:[(0,k.jsx)(T(),{src:e.icon,layout:"fixed",width:"32",height:"32"}),(0,k.jsxs)("div",{className:"flex-col space-y-0",children:[(0,k.jsx)("div",{className:"flex space-x-2",children:(0,k.jsx)("p",{className:"text-foreground",children:e.label})}),(0,k.jsx)("p",{className:"text-foreground-light",children:e.description})]})]})},e.value)})})})}),(0,k.jsx)(Y.ZP.Separator,{}),(0,k.jsx)(ef,{type:t.function_type,errors:r,httpHeaders:m,httpParameters:x,onAddHeader:function(e){e?j(m.concat(e)):j(m.concat({id:(0,X.k$)(),name:"",value:""}))},onUpdateHeader:function(e,t,n){return j(m.map(function(r,s){return e===s?eh(eh({},r),{},(0,f.Z)({},t,n)):r}))},onRemoveHeader:function(e){return j(m.filter(function(t,n){return e!==n}))},onAddParameter:function(){return b(x.concat({id:(0,X.k$)(),name:"",value:""}))},onUpdateParameter:function(e,t,n){return b(x.map(function(r,s){return e===s?eh(eh({},r),{},(0,f.Z)({},t,n)):r}))},onRemoveParameter:function(e){return b(x.filter(function(t,n){return e!==n}))}}),(0,k.jsx)("button",{ref:v,type:"submit",className:"hidden"})]})},ej=n(24990),eb=n(76635),ev=n(55210),eg=n(95223),ey=n(85577),ew=n(45812),eN=n(56163),eO=n(22812),ek=n(58943),eS=["enabled"];function e_(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eP(){return(eP=(0,r.Z)(o().mark(function e(t,n){var r,s,a,i;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.projectRef,s=t.connectionString,r){e.next=3;break}throw Error("projectRef is required");case 3:return a=new Headers,s&&a.set("x-connection-encrypted",s),e.next=7,(0,j.U2)("".concat(b.T5,"/pg-meta/").concat(r,"/triggers"),{headers:Object.fromEntries(a),signal:n});case 7:if(!(!Array.isArray(i=e.sent)&&i.error)){e.next=10;break}throw i.error;case 10:return e.abrupt("return",i);case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}var eZ=function(e){var t=e.projectRef,n=e.connectionString,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=r.enabled,o=(0,p.Z)(r,eS);return(0,ek.a)(v.list(t),function(e){return function(e,t){return eP.apply(this,arguments)}({projectRef:t,connectionString:n},e.signal)},function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?e_(Object(n),!0).forEach(function(t){(0,f.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):e_(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({select:function(e){return e.filter(function(e){return"supabase_functions"===e.function_schema&&("net"!==e.schema||0===e.function_args.length)})},enabled:(void 0===s||s)&&void 0!==t&&void 0!==n},o))},eT=n(55268),eE=n(73302),eR=n(924),eC=n(90464),eD=function(e){var t=e.schema,n=e.filterString,r=e.editHook,s=void 0===r?eb.noop:r,o=e.deleteHook,i=void 0===o?eb.noop:o,c=(0,E.UO)().ref,l=(0,u.d2)().project,d=eZ({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString}).data,f=null==l?void 0:l.restUrl,p=new URL(f).hostname.split(".").pop(),h=(null!=d?d:[]).filter(function(e){return(0,eb.includes)(e.name.toLowerCase(),n.toLowerCase())&&e.schema===t&&e.function_args.length>=2}),m=(0,O.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"triggers");return(0,k.jsx)(k.Fragment,{children:h.map(function(e){var t=function(e){return e.includes("https://".concat(c,".functions.supabase.").concat(p,"/"))||e.includes("https://".concat(c,".supabase.").concat(p,"/functions/"))},n=(0,_.Z)(e.function_args,2),r=n[0],o=n[1];return(0,k.jsxs)(eT.Z.tr,{children:[(0,k.jsx)(eT.Z.td,{children:(0,k.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,k.jsx)(T(),{src:t(r)?"".concat(b.GW,"/img/function-providers/supabase-severless-function.png"):"".concat(b.GW,"/img/function-providers/http-request.png"),layout:"fixed",width:"20",height:"20",title:t(r)?"Supabase Edge Function":"HTTP Request"}),(0,k.jsx)("p",{title:e.name,children:e.name})]})}),(0,k.jsx)(eT.Z.td,{className:"hidden space-x-2 lg:table-cell",children:(0,k.jsx)("p",{title:e.table,children:e.table})}),(0,k.jsx)(eT.Z.td,{className:"hidden space-x-1 xl:table-cell",children:e.events.map(function(e){return(0,k.jsx)(eE.Z,{children:e},e)})}),(0,k.jsx)(eT.Z.td,{className:"hidden xl:table-cell",children:(0,k.jsxs)("p",{className:"truncate",title:r,children:[(0,k.jsx)("code",{className:"font-mono text-xs",children:o}),": ",r]})}),(0,k.jsx)(eT.Z.td,{className:"text-right",children:(0,k.jsx)("div",{className:"flex justify-end gap-4",children:m?(0,k.jsxs)(eu.h_,{children:[(0,k.jsx)(eu.$F,{children:(0,k.jsx)($.z,{asChild:!0,type:"default",icon:(0,k.jsx)(eR.Z,{}),className:"px-1",children:(0,k.jsx)("span",{})})}),(0,k.jsx)(eu.AW,{side:"left",children:(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(eu.Xi,{className:"space-x-2",onClick:function(){return s(e)},children:[(0,k.jsx)(eC.Z,{size:"tiny"}),(0,k.jsx)("p",{children:"Edit hook"})]}),(0,k.jsx)(eu.VD,{}),(0,k.jsxs)(eu.Xi,{className:"space-x-2",onClick:function(){return i(e)},children:[(0,k.jsx)(ec.Z,{stroke:"red",size:"tiny"}),(0,k.jsx)("p",{children:"Delete hook"})]})]})})]}):(0,k.jsxs)(ej.fC,{delayDuration:0,children:[(0,k.jsx)(ej.xz,{asChild:!0,children:(0,k.jsx)($.z,{disabled:!0,type:"default",icon:(0,k.jsx)(eR.Z,{})})}),(0,k.jsx)(ej.h_,{children:(0,k.jsxs)(ej.VY,{side:"left",children:[(0,k.jsx)(ej.Eh,{className:"radix-tooltip-arrow"}),(0,k.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,k.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to update webhooks"})})]})})]})})})]},e.id)})})},eH=(0,i.Pi)(function(e){var t=e.schema,n=e.filterString,r=e.editHook,s=void 0===r?eb.noop:r,o=e.deleteHook,a=void 0===o?eb.noop:o;return(0,k.jsxs)("div",{className:"",children:[(0,k.jsx)("div",{className:"sticky top-0 backdrop-blur backdrop-filter",children:(0,k.jsxs)("div",{className:"flex items-baseline space-x-1 py-2",children:[(0,k.jsx)("h5",{className:"text-foreground-light",children:"schema"}),(0,k.jsx)("h4",{children:t})]})}),(0,k.jsx)(eT.Z,{className:"table-fixed",head:(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(eT.Z.th,{className:"w-[20%]",children:(0,k.jsx)("p",{className:"translate-x-[36px]",children:"Name"})},"name"),(0,k.jsx)(eT.Z.th,{className:"w-[15%] hidden lg:table-cell",children:"Table"},"table"),(0,k.jsx)(eT.Z.th,{className:"w-[24%] hidden xl:table-cell",children:"Events"},"events"),(0,k.jsx)(eT.Z.th,{className:"hidden xl:table-cell",children:"Webhook"},"webhook"),(0,k.jsx)(eT.Z.th,{className:"w-[5%]"},"buttons")]}),body:(0,k.jsx)(eD,{filterString:n,schema:t,editHook:s,deleteHook:a})})]},t)}),eA=(0,i.Pi)(function(e){var t=e.createHook,n=void 0===t?function(){}:t,r=e.editHook,s=void 0===r?function(){}:r,o=e.deleteHook,i=void 0===o?function(){}:o,l=(0,u.d2)().project,d=eZ({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString}),f=d.error,p=d.data,h=d.isLoading,m=d.isError,x=(0,c.useState)(""),j=x[0],b=x[1],v=(p||[]).filter(function(e){return(0,eb.includes)(e.name.toLowerCase(),j.toLowerCase())}),g=(0,eb.map)((0,eb.uniqBy)(v,"schema"),"schema"),y=(0,O.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"triggers");return(0,k.jsx)(k.Fragment,{children:h?(0,k.jsx)("div",{className:"py-4",children:(0,k.jsx)(eO.A,{})}):m?(0,k.jsx)(ew.Z,{error:f,subject:"Failed to retrieve database webhooks"}):0==(p||[]).length?(0,k.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,k.jsx)(ey.Z,{title:"Database Webhooks",ctaButtonLabel:"Create Webhook",onClickCta:function(){return n()},disabled:!y,disabledMessage:"You need additional permissions to create webhooks",children:(0,k.jsx)("p",{className:"text-sm text-foreground-light",children:"Database Webhooks can be used to trigger serverless functions or send requests to an HTTP endpoint."})})}):(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{className:"flex items-center justify-between",children:(0,k.jsx)(C.ph,{title:"Database Webhooks",description:"Send real-time data from your database to another system whenever a table event occurs"})}),(0,k.jsxs)("div",{className:"w-full space-y-4",children:[(0,k.jsxs)("div",{className:"flex items-center justify-between",children:[(0,k.jsx)(J.Z,{placeholder:"Search for a webhook",size:"small",icon:(0,k.jsx)(ev.Z,{size:"tiny"}),value:j,className:"w-64",onChange:function(e){return b(e.target.value)}}),(0,k.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,k.jsx)($.z,{asChild:!0,type:"default",icon:(0,k.jsx)(eg.Z,{strokeWidth:1.5}),children:(0,k.jsx)(ea(),{href:"https://supabase.com/docs/guides/database/webhooks",target:"_blank",rel:"noreferrer",children:"Documentation"})}),(0,k.jsxs)(ej.fC,{delayDuration:0,children:[(0,k.jsx)(ej.xz,{children:(0,k.jsx)($.z,{disabled:!y,onClick:function(){return n()},children:"Create a new hook"})}),!y&&(0,k.jsx)(ej.h_,{children:(0,k.jsxs)(ej.VY,{side:"bottom",children:[(0,k.jsx)(ej.Eh,{className:"radix-tooltip-arrow"}),(0,k.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,k.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to create webhooks"})})]})})]})]})]}),v.length<=0&&(0,k.jsx)(eN.Z,{searchString:j,onResetFilter:function(){return b("")}}),g.map(function(e){return(0,k.jsx)(eH,{filterString:j,schema:e,editHook:s,deleteHook:i},e)})]})]})})}),ez=n(11425),eU=n(86866),eL=n(48125),eF=n(81229),eW=["onSuccess","onError"];function eq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eI(){return(eI=(0,r.Z)(o().mark(function e(t){var n,r,s,a;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.ref,e.next=3,(0,eF.v_)("/platform/database/{ref}/hook-enable",{params:{path:{ref:n}}});case 3:if(s=(r=e.sent).data,!(a=r.error)){e.next=8;break}throw a;case 8:return e.abrupt("return",s);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}var eB=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onSuccess,n=e.onError,s=(0,p.Z)(e,eW);return(0,x.D)(function(e){return function(e){return eI.apply(this,arguments)}(e)},function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eq(Object(n),!0).forEach(function(t){(0,f.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eq(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({onSuccess:function(e,n,s){return(0,r.Z)(o().mark(function r(){return o().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,null==t?void 0:t(e,n,s);case 2:case"end":return r.stop()}},r)}))()},onError:function(e,t,s){return(0,r.Z)(o().mark(function r(){return o().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:void 0===n?h.Am.error("Failed to enable webhooks: ".concat(e.message)):n(e,t,s);case 1:case"end":return r.stop()}},r)}))()}},s))},eG=n(59800),eM=n(29027),eX=function(){var e,t=(0,u.d2)().project,n=(0,O.oR)(),s=n.meta,i=n.ui,d=(0,l.UO)().ref,f=(0,eG.Q1)({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString}),p=f.data,h=f.isLoading,m=f.refetch,x=(0,c.useState)(),j=x[0],b=x[1],v=(0,c.useState)(!1),g=v[0],y=v[1],w=(0,c.useState)(!1),N=w[0],_=w[1],P=null==p?void 0:p.some(function(e){return"supabase_functions"===e.name}),Z=(0,O.Xo)(a.KA.TENANT_SQL_ADMIN_READ,"triggers"),T=(0,O.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"triggers"),E=eB({onSuccess:function(){m(),i.setNotification({category:"success",message:"Successfully enabled webhooks"})}}),R=E.mutate,C=E.isLoading;(0,c.useEffect)(function(){i.selectedProjectRef&&s.hooks.load()},[i.selectedProjectRef]);var D=(e=(0,r.Z)(o().mark(function e(){return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(d){e.next=2;break}return e.abrupt("return",console.error("Project ref is required"));case 2:R({ref:d});case 3:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)});return Z?h?(0,k.jsxs)("div",{className:"w-full h-full flex items-center justify-center space-x-2",children:[(0,k.jsx)(eM.Z,{className:"animate-spin",size:"tiny",strokeWidth:1.5}),(0,k.jsx)("p",{className:"text-sm text-foreground-light",children:"Checking if hooks are enabled"})]}):P?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(eU._S,{className:"h-full",children:(0,k.jsx)(eU.jX,{className:"h-full",children:(0,k.jsx)("div",{className:"col-span-12",children:(0,k.jsx)(eA,{createHook:function(){b(void 0),y(!0)},editHook:function(e){b(e),y(!0)},deleteHook:function(e){b(e),_(!0)}})})})}),(0,k.jsx)(em,{visible:g,selectedHook:j,onClose:function(){return y(!1)}}),(0,k.jsx)(S,{visible:N,selectedHook:j,onClose:function(){return _(!1)}})]}):(0,k.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,k.jsxs)(ey.Z,{size:"large",title:"Database Webhooks",ctaButtonLabel:"Enable webhooks",onClickCta:function(){return D()},loading:C,disabled:C||!T,disabledMessage:T?void 0:"You need additional permissions to enable webhooks",children:[(0,k.jsx)("p",{className:"text-sm text-foreground-light",children:"Database Webhooks can be used to trigger serverless functions or send requests to an HTTP endpoint."}),(0,k.jsx)("p",{className:"text-sm text-foreground-light",children:"Enable database webhooks on your project."})]})}):(0,k.jsx)(eL.Z,{isFullPage:!0,resourceText:"view database webhooks"})};eX.getLayout=function(e){return(0,k.jsx)(ez._h,{title:"Hooks",children:e})};var eY=(0,i.Pi)(eX)},90464:function(e,t,n){"use strict";var r=n(95235);n(2784);var s=n(59330),o=n(12223),a=n(52322);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}t.Z=function(e){return(0,a.jsx)(o.Z,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({icon:s.Z},e))}},69755:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/database/hooks",function(){return n(45684)}])},59330:function(e,t,n){"use strict";var r=n(2784),s=n(13980),o=n.n(s);function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var i=(0,r.forwardRef)(function(e,t){var n=e.color,s=e.size,o=void 0===s?24:s,i=function(e,t){if(null==e)return{};var n,r,s=function(e,t){if(null==e)return{};var n,r,s={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}(e,["color","size"]);return r.createElement("svg",a({ref:t,xmlns:"http://www.w3.org/2000/svg",width:o,height:o,viewBox:"0 0 24 24",fill:"none",stroke:void 0===n?"currentColor":n,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},i),r.createElement("path",{d:"M12 20h9"}),r.createElement("path",{d:"M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"}))});i.propTypes={color:o().string,size:o().oneOfType([o().string,o().number])},i.displayName="Edit3",t.Z=i}},function(e){e.O(0,[1187,8421,4747,7287,7898,6218,2514,2187,2645,6823,7725,9774,2888,179],function(){return e(e.s=69755)}),_N_E=e.O()}]);
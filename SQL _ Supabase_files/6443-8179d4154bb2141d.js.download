"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6443],{36443:function(e,n,t){t.d(n,{Z:function(){return G}});var r=t(20406),o=t(95235),c=t(81333),i=t(28526),a=t.n(i),l=t(55830),s=t(39097),u=t.n(s),f=t(62202),d=t(36849),p=t(41503),m=t(67270),b=t(8647),v=t(95223),g=t(90989),h=t(97064),y=t(13734),w=t(30098),j=t(52712),x=t(82269),D=t(62350),O=t(19452),S=t(94170),k=t(18431),P=["onSuccess","onError"];function C(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Z(){return(Z=(0,r.Z)(a().mark(function e(n){var t,r,o,c;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.projectRef,r=n.connectionString,o=function(e){var n,t=e.table,r=e.filters,o=new O.Query().from(t.name,null!==(n=t.schema)&&void 0!==n?n:void 0).delete();return r.filter(function(e){return e.value&&""!==e.value}).forEach(function(e){var n=(0,k.q)(t,e);o=o.filter(e.column,e.operator,n)}),o.toSql()}({table:n.table,filters:n.filters}),e.next=4,(0,S.Rj)({projectRef:t,connectionString:r,sql:o});case 4:return c=e.sent.result,e.abrupt("return",c);case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}var N=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.onSuccess,t=e.onError,c=(0,x.Z)(e,P),i=(0,l.NL)();return(0,D.D)(function(e){return function(e){return Z.apply(this,arguments)}(e)},function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?C(Object(t),!0).forEach(function(n){(0,o.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):C(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}({onSuccess:function(e,t,o){return(0,r.Z)(a().mark(function r(){var c,l;return a().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return c=t.projectRef,l=t.table,r.next=3,i.invalidateQueries(j.M.query(c,[l.schema,l.name]));case 3:return r.next=5,null==n?void 0:n(e,t,o);case 5:case"end":return r.stop()}},r)}))()},onError:function(e,n,o){return(0,r.Z)(a().mark(function r(){return a().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:void 0===t?f.Am.error("Failed to delete all table rows: ".concat(e.message)):t(e,n,o);case 1:case"end":return r.stop()}},r)}))()}},c))},E=["onSuccess","onError"];function R(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function q(){return(q=(0,r.Z)(a().mark(function e(n){var t,r,o,c;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.projectRef,r=n.connectionString,o=function(e){var n,t=e.table,r=e.rows,o=(0,k.h)({table:t}),c=o.primaryKeys,i=o.error;if(i)throw i;var a=new O.Query().from(t.name,null!==(n=t.schema)&&void 0!==n?n:void 0).delete();return c.forEach(function(e){var n=r.map(function(n){return n[e]});a=a.filter(e,"in",n)}),a.toSql()}({table:n.table,rows:n.rows}),e.next=4,(0,S.Rj)({projectRef:t,connectionString:r,sql:o});case 4:return c=e.sent.result,e.abrupt("return",c);case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}var A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.onSuccess,t=e.onError,c=(0,x.Z)(e,E),i=(0,l.NL)();return(0,D.D)(function(e){return function(e){return q.apply(this,arguments)}(e)},function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?R(Object(t),!0).forEach(function(n){(0,o.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):R(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}({onSuccess:function(e,t,o){return(0,r.Z)(a().mark(function r(){var c,l;return a().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return c=t.projectRef,l=t.table,r.next=3,i.invalidateQueries(j.M.query(c,[l.schema,l.name]));case 3:return r.next=5,null==n?void 0:n(e,t,o);case 5:case"end":return r.stop()}},r)}))()},onError:function(e,n,o){return(0,r.Z)(a().mark(function r(){return a().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:void 0===t?f.Am.error("Failed to delete table row: ".concat(e.message)):t(e,n,o);case 1:case"end":return r.stop()}},r)}))()}},c))},L=["onSuccess","onError"];function Q(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function F(){return(F=(0,r.Z)(a().mark(function e(n){var t,r,o,c;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.projectRef,r=n.connectionString,o=function(e){var n,t=e.table;return new O.Query().from(t.name,null!==(n=t.schema)&&void 0!==n?n:void 0).truncate().toSql()}({table:n.table}),e.next=4,(0,S.Rj)({projectRef:t,connectionString:r,sql:o});case 4:return c=e.sent.result,e.abrupt("return",c);case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}var _=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.onSuccess,t=e.onError,c=(0,x.Z)(e,L),i=(0,l.NL)();return(0,D.D)(function(e){return function(e){return F.apply(this,arguments)}(e)},function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Q(Object(t),!0).forEach(function(n){(0,o.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Q(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}({onSuccess:function(e,t,o){return(0,r.Z)(a().mark(function r(){var c,l;return a().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return c=t.projectRef,l=t.table,r.next=3,i.invalidateQueries(j.M.query(c,[l.schema,l.name]));case 3:return r.next=5,null==n?void 0:n(e,t,o);case 5:case"end":return r.stop()}},r)}))()},onError:function(e,n,o){return(0,r.Z)(a().mark(function r(){return a().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:void 0===t?f.Am.error("Failed to truncate table row: ".concat(e.message)):t(e,n,o);case 1:case"end":return r.stop()}},r)}))()}},c))},z=t(68040),M=t(4167),T=t(70203),W=t(84485),I=t(55144),B=t(52322);function K(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function Y(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?K(Object(t),!0).forEach(function(n){(0,o.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):K(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var G=function(e){var n,t,o,i,s,x,D,O,S,k,P,C,Z=e.projectRef,E=e.selectedTable,R=e.onAfterDeleteTable,q=void 0===R?W.ZT:R,L=(0,T.oR)(),Q=L.meta,F=L.ui,K=(0,l.NL)(),G=(0,h.d2)().project,H=(0,I._2)(),J=(0,T.x3)({arrayKeys:["filter","sort"]}),U=(0,c.Z)(J,2),V=U[0].filter,X=U[1],$=(0,g.Yb)(V),ee=(0,M.AF)({projectRef:null==G?void 0:G.ref,connectionString:null==G?void 0:G.connectionString}),en=A({onSuccess:function(){var e,n,t;(null===(e=H.confirmationDialog)||void 0===e?void 0:e.type)==="row"&&(null===(n=(t=H.confirmationDialog).callback)||void 0===n||n.call(t)),f.ZP.success("Successfully deleted selected row(s)"),H.closeConfirmationDialog()},onError:function(e){f.ZP.error("Failed to delete row: ".concat(e.message)),H.closeConfirmationDialog()}}).mutate,et=N({onSuccess:function(){var e,n,t;(null===(e=H.confirmationDialog)||void 0===e?void 0:e.type)==="row"&&(null===(n=(t=H.confirmationDialog).callback)||void 0===n||n.call(t)),f.ZP.success("Successfully deleted selected rows"),H.closeConfirmationDialog()},onError:function(e){f.ZP.error("Failed to delete rows: ".concat(e.message)),H.closeConfirmationDialog()}}).mutateAsync,er=_({onSuccess:function(){var e,n,t;(null===(e=H.confirmationDialog)||void 0===e?void 0:e.type)==="row"&&(null===(n=(t=H.confirmationDialog).callback)||void 0===n||n.call(t)),f.ZP.success("Successfully deleted all rows from table"),H.closeConfirmationDialog()},onError:function(e){f.ZP.error("Failed to delete rows: ".concat(e.message)),H.closeConfirmationDialog()}}).mutateAsync,eo=(null===(i=H.confirmationDialog)||void 0===i?void 0:i.type)==="row"&&H.confirmationDialog.allRowsSelected,ec=(null===(s=H.confirmationDialog)||void 0===s?void 0:s.type)==="row"?H.confirmationDialog.allRowsSelected?null!==(x=H.confirmationDialog.numRows)&&void 0!==x?x:0:H.confirmationDialog.rows.length:0,ei=function(e){X(function(n){var t,r,o=null!==(t=null==n?void 0:n.filter)&&void 0!==t?t:[],i=null!==(r=null==n?void 0:n.sort)&&void 0!==r?r:[];return Y(Y({},n),{},{filter:o.filter(function(n){var t=n.split(":");if((0,c.Z)(t,1)[0]!==e)return n}),sort:i.filter(function(n){var t=n.split(":");if((0,c.Z)(t,1)[0]!==e)return n})})})},ea=((null===(D=H.confirmationDialog)||void 0===D?void 0:D.type)==="column"||(null===(O=H.confirmationDialog)||void 0===O?void 0:O.type)==="table")&&H.confirmationDialog.isDeleteWithCascade,el=(n=(0,r.Z)(a().mark(function e(){var n,t,r;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((null===(n=H.confirmationDialog)||void 0===n?void 0:n.type)==="column"){e.next=2;break}return e.abrupt("return");case 2:if(t=H.confirmationDialog.column,e.prev=3,void 0!==t){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,Q.columns.del(t.id,ea);case 8:if(!(r=e.sent).error){e.next=11;break}throw r.error;case 11:return ei(t.name),F.setNotification({category:"success",message:'Successfully deleted column "'.concat(t.name,'"')}),e.next=15,Promise.all([K.invalidateQueries(j.M.query(null==G?void 0:G.ref,["foreign-key-constraints"])),K.invalidateQueries(z.W.table(null==G?void 0:G.ref,t.table_id)),K.invalidateQueries(j.M.query(null==G?void 0:G.ref,[E.schema,E.name])),K.invalidateQueries(j.M.query(null==G?void 0:G.ref,["table-definition",E.schema,E.name]))]);case 15:if(!H.selectedSchemaName){e.next=18;break}return e.next=18,Q.views.loadBySchema(H.selectedSchemaName);case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(3),F.setNotification({category:"error",message:"Failed to delete ".concat(t.name,": ").concat(e.t0.message)});case 23:return e.prev=23,H.closeConfirmationDialog(),e.finish(23);case 26:case"end":return e.stop()}},e,null,[[3,20,23,26]])})),function(){return n.apply(this,arguments)}),es=(t=(0,r.Z)(a().mark(function e(){var n,t,r,o;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((null===(n=H.confirmationDialog)||void 0===n?void 0:n.type)==="table"){e.next=2;break}return e.abrupt("return");case 2:if(t=E,e.prev=3,void 0!==t){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,Q.tables.del(t.id,ea);case 8:if(!(r=e.sent).error){e.next=11;break}throw r.error;case 11:return e.next=13,ee(H.selectedSchemaName);case 13:return o=e.sent,e.next=16,K.invalidateQueries(w.C.list(Z));case 16:if(q(o),F.setNotification({category:"success",message:'Successfully deleted table "'.concat(t.name,'"')}),!H.selectedSchemaName){e.next=21;break}return e.next=21,Q.views.loadBySchema(H.selectedSchemaName);case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(3),F.setNotification({error:e.t0,category:"error",message:"Failed to delete ".concat(null==t?void 0:t.name,": ").concat(e.t0.message)});case 26:return e.prev=26,H.closeConfirmationDialog(),e.finish(26);case 29:case"end":return e.stop()}},e,null,[[3,23,26,29]])})),function(){return t.apply(this,arguments)}),eu=(o=(0,r.Z)(a().mark(function e(){var n,t;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(G){e.next=2;break}return e.abrupt("return",console.error("Project ref is required"));case 2:if(E){e.next=4;break}return e.abrupt("return",console.error("Selected table required"));case 4:if(!((null===(n=H.confirmationDialog)||void 0===n?void 0:n.type)!=="row")){e.next=6;break}return e.abrupt("return");case 6:t=H.confirmationDialog.rows,H.confirmationDialog.allRowsSelected?0===$.length?er({projectRef:G.ref,connectionString:G.connectionString,table:E}):et({projectRef:G.ref,connectionString:G.connectionString,table:E,filters:$}):en({projectRef:G.ref,connectionString:G.connectionString,table:E,rows:t});case 8:case"end":return e.stop()}},e)})),function(){return o.apply(this,arguments)});return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(y.Z,{danger:!0,size:"small",visible:(null===(S=H.confirmationDialog)||void 0===S?void 0:S.type)==="column",header:'Confirm deletion of column "'.concat((null===(k=H.confirmationDialog)||void 0===k?void 0:k.type)==="column"&&H.confirmationDialog.column.name,'"'),buttonLabel:"Delete",buttonLoadingLabel:"Deleting",onSelectCancel:function(){H.closeConfirmationDialog()},onSelectConfirm:el,children:(0,B.jsx)(d.C.Content,{children:(0,B.jsxs)("div",{className:"py-4 space-y-4",children:[(0,B.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you want to delete the selected column? This action cannot be undone."}),(0,B.jsx)(p.Z,{label:"Drop column with cascade?",description:"Deletes the column and its dependent objects",checked:ea,onChange:function(){return H.toggleConfirmationIsWithCascade()}}),ea&&(0,B.jsxs)(m.b,{withIcon:!0,variant:"warning",title:"Warning: Dropping with cascade may result in unintended consequences",children:[(0,B.jsx)("p",{className:"mb-4",children:"All dependent objects will be removed, as will any objects that depend on them, recursively."}),(0,B.jsx)(b.z,{asChild:!0,size:"tiny",type:"default",icon:(0,B.jsx)(v.Z,{}),children:(0,B.jsx)(u(),{href:"https://www.postgresql.org/docs/current/ddl-depend.html",target:"_blank",rel:"noreferrer",children:"About dependency tracking"})})]})]})})}),(0,B.jsx)(y.Z,{danger:!0,size:"small",visible:(null===(P=H.confirmationDialog)||void 0===P?void 0:P.type)==="table",header:(0,B.jsx)("span",{className:"break-words",children:'Confirm deletion of table "'.concat(null==E?void 0:E.name,'"')}),buttonLabel:"Delete",buttonLoadingLabel:"Deleting",onSelectCancel:function(){H.closeConfirmationDialog()},onSelectConfirm:es,children:(0,B.jsx)(d.C.Content,{children:(0,B.jsxs)("div",{className:"py-4 space-y-4",children:[(0,B.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you want to delete the selected table? This action cannot be undone."}),(0,B.jsx)(p.Z,{label:"Drop table with cascade?",description:"Deletes the table and its dependent objects",checked:ea,onChange:function(){return H.toggleConfirmationIsWithCascade(!ea)}}),ea&&(0,B.jsxs)(m.b,{withIcon:!0,variant:"warning",title:"Warning: Dropping with cascade may result in unintended consequences",children:[(0,B.jsx)("p",{className:"mb-4",children:"All dependent objects will be removed, as will any objects that depend on them, recursively."}),(0,B.jsx)(b.z,{asChild:!0,size:"tiny",type:"default",icon:(0,B.jsx)(v.Z,{}),children:(0,B.jsx)(u(),{href:"https://www.postgresql.org/docs/current/ddl-depend.html",target:"_blank",rel:"noreferrer",children:"About dependency tracking"})})]})]})})}),(0,B.jsx)(y.Z,{danger:!0,size:"small",visible:(null===(C=H.confirmationDialog)||void 0===C?void 0:C.type)==="row",header:(0,B.jsxs)("span",{className:"break-words",children:["Confirm to delete the selected row",ec>1&&"s"]}),buttonLabel:"Delete",buttonLoadingLabel:"Deleting",onSelectCancel:function(){return H.closeConfirmationDialog()},onSelectConfirm:function(){return eu()},children:(0,B.jsx)(d.C.Content,{children:(0,B.jsx)("div",{className:"py-4 space-y-4",children:(0,B.jsxs)("p",{className:"text-sm text-foreground-light",children:["Are you sure you want to delete ",eo?"all":"the selected"," ",ec>1&&"".concat(ec," "),"row",ec>1&&"s","? This action cannot be undone."]})})})})]})}}}]);
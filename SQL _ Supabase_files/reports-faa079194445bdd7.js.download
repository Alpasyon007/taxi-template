(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8594],{20722:function(t,e,r){"use strict";r.r(e),r.d(e,{UserReportPage:function(){return x},default:function(){return k}});var n,a=r(20406),o=r(28526),s=r.n(o),u=r(59491),i=r(5632),c=r(2784),p=r(4300),l=r(11425),f=r(85577),h=r(61586),d={name:"new report",description:"",type:"report",visibility:"project",content:{schema_version:1,period_start:{time_period:"7d",date:""},period_end:{time_period:"today",date:""},interval:"1d",layout:[]}},v=(n=(0,a.Z)(s().mark(function t(e){var r,n,a,o,u,i;return s().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=(r=e.router).query.ref,a=(0,h.I)(n),t.next=5,a.create(d);case 5:if(u=(o=t.sent).data,!(i=o.error)){t.next=10;break}throw i;case 10:return t.next=12,a.load();case 12:r.push("/project/".concat(n,"/reports/").concat(u[0].id));case 13:case"end":return t.stop()}},t)})),function(t){return n.apply(this,arguments)}),y=r(17578),m=r(70203),w=r(44183),b=r(52322),x=function(){var t=(0,c.useState)(!0),e=t[0],r=t[1],n=(0,i.useRouter)(),o=(0,p.UO)().ref,l=(0,w.Un)().profile,d=(0,m.oR)().ui,x=(0,h.I)(o),k=(0,m.Xo)(u.KA.CREATE,"user_content",{resource:{type:"report",owner_id:null==l?void 0:l.id},subject:{id:null==l?void 0:l.id}});function O(){return(O=(0,a.Z)(s().mark(function t(){var e;return s().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x.load();case 2:(e=x.reports()).length>=1?n.push("/project/".concat(o,"/reports/").concat(e[0].id)):r(!1);case 4:case"end":return t.stop()}},t)}))).apply(this,arguments)}return(0,c.useEffect)(function(){!function(){O.apply(this,arguments)}()},[o]),(0,b.jsx)("div",{className:"mx-auto my-32 w-full max-w-7xl flex-grow space-y-16",children:e?(0,b.jsx)(y.Z,{}):(0,b.jsxs)(f.Z,{title:"Reports",ctaButtonLabel:"Create report",onClickCta:function(){try{v({router:n})}catch(t){d.setNotification({category:"error",message:"Failed to create report: ".concat(t.message)})}},disabled:!k,disabledMessage:"You need additional permissions to create a report",children:[(0,b.jsx)("p",{className:"text-foreground-light text-sm",children:"Create custom reports for your projects."}),(0,b.jsx)("p",{className:"text-foreground-light text-sm",children:"Get a high level overview of your network traffic, user actions, and infrastructure health."})]})})};x.getLayout=function(t){return(0,b.jsx)(l.li,{children:t})};var k=x},61586:function(t,e,r){"use strict";r.d(e,{I:function(){return m}});var n=r(20406),a=r(96412),o=r(13089),s=r(95235),u=r(28526),i=r.n(u),c=r(80075),p=r(37552),l=r(76635),f=r(9747);function h(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function d(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?h(Object(r),!0).forEach(function(e){(0,s.Z)(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var v=null,y=null;function m(t){if(null===v||t!==y){y=t;var e="".concat(f.T5,"/projects/").concat(t,"/content");v=new w(e)}return v}var w=function(){var t,e,r,u,f,h,v;function y(t){(0,a.Z)(this,y),(0,s.Z)(this,"STATES",{INITIAL:"initial",LOADING:"loading",ERROR:"error",LOADED:"loaded"}),(0,s.Z)(this,"rootStore",null),(0,s.Z)(this,"url",""),(0,s.Z)(this,"state",this.STATES.INITIAL),(0,s.Z)(this,"data",{}),(0,s.Z)(this,"error",null),this.url=t,(0,c.rC)(this,{state:c.LO,data:c.LO,list:c.LO,hasError:c.Fl,isLoading:c.Fl})}return(0,o.Z)(y,[{key:"fetchData",value:(t=(0,n.Z)(i().mark(function t(){var e,r;return i().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e={"Content-Type":"application/json"},t.next=3,(0,p.U2)(this.url,{headers:e});case 3:if(!(r=t.sent).error){t.next=6;break}throw r.error;case 6:return this.data=r.data.length>0?(0,l.keyBy)(r.data,"id"):r.data,t.abrupt("return",r);case 8:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"load",value:(e=(0,n.Z)(i().mark(function t(){var e,r,n,a;return i().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=(e=this.STATES).LOADING,n=e.ERROR,a=e.LOADED,t.prev=1,this.error=null,this.state=r,t.next=6,this.fetchData();case 6:return this.state=a,t.abrupt("return",this.data);case 10:t.prev=10,t.t0=t.catch(1),console.error("e.message",t.t0.message),this.error=t.t0,this.state=n;case 15:case"end":return t.stop()}},t,this,[[1,10]])})),function(){return e.apply(this,arguments)})},{key:"hasError",get:function(){return this.state===this.STATES.ERROR}},{key:"isLoading",get:function(){return this.state===this.STATES.INITIAL||this.state===this.STATES.LOADING}},{key:"list",value:function(t){var e=Object.values(this.data);return t?e.filter(t).sort(function(t,e){return t.name.localeCompare(e.name)}):e.sort(function(t,e){return t.name.localeCompare(e.name)})}},{key:"reports",value:function(t){var e=Object.values(this.data);return t?e.filter(function(t){return"report"==t.type}).filter(t).sort(function(t,e){return t.name.localeCompare(e.name)}):e.filter(function(t){return"report"==t.type}).sort(function(t,e){return t.name.localeCompare(e.name)})}},{key:"sqlSnippets",value:function(t){var e=Object.values(this.data);return t?e.filter(function(t){return"sql"==t.type}).filter(t).sort(function(t,e){return t.name.localeCompare(e.name)}):e.filter(function(t){return"sql"==t.type}).sort(function(t,e){return t.name.localeCompare(e.name)})}},{key:"byId",value:function(t){return this.data[t]}},{key:"create",value:(r=(0,n.Z)(i().mark(function t(e){var r,n;return i().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r={"Content-Type":"application/json"},t.next=4,(0,p.v_)(this.url,e,{headers:r});case 4:if(!(n=t.sent).error){t.next=7;break}throw n.error;case 7:return this.data[n.id]=n,t.abrupt("return",{data:n,error:null});case 11:return t.prev=11,t.t0=t.catch(0),t.abrupt("return",{data:null,error:t.t0});case 14:case"end":return t.stop()}},t,this,[[0,11]])})),function(t){return r.apply(this,arguments)})},{key:"update",value:(u=(0,n.Z)(i().mark(function t(e,r,n){var a,o,s,u;return i().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a={"Content-Type":"application/json"},o=d(d({},r),{},{type:n,id:e}),s="".concat(this.url,"?id=").concat(e),t.next=6,(0,p.r$)(s,o,{headers:a});case 6:if(!(u=t.sent).error){t.next=9;break}throw u.error;case 9:return this.data[e]=u,t.abrupt("return",{data:u,error:null});case 13:return t.prev=13,t.t0=t.catch(0),t.abrupt("return",{data:null,error:t.t0});case 16:case"end":return t.stop()}},t,this,[[0,13]])})),function(t,e,r){return u.apply(this,arguments)})},{key:"updateSql",value:(f=(0,n.Z)(i().mark(function t(e,r){return i().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.update(e,r,"sql"));case 1:case"end":return t.stop()}},t,this)})),function(t,e){return f.apply(this,arguments)})},{key:"updateReport",value:(h=(0,n.Z)(i().mark(function t(e,r){return i().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.update(e,r,"report"));case 1:case"end":return t.stop()}},t,this)})),function(t,e){return h.apply(this,arguments)})},{key:"del",value:(v=(0,n.Z)(i().mark(function t(e){var r,n,a;return i().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r={"Content-Type":"application/json"},n="".concat(this.url,"?id=").concat(e),t.next=5,(0,p.$v)(n,{},{headers:r});case 5:if(!(a=t.sent).error){t.next=8;break}throw a.error;case 8:return delete this.data[e],t.abrupt("return",{data:!0,error:null});case 12:return t.prev=12,t.t0=t.catch(0),t.abrupt("return",{data:!1,error:t.t0});case 15:case"end":return t.stop()}},t,this,[[0,12]])})),function(t){return v.apply(this,arguments)})}]),y}()},68756:function(t,e,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/reports",function(){return r(20722)}])}},function(t){t.O(0,[1187,8421,4747,7287,7898,6218,2514,2187,2645,6823,7725,9774,2888,179],function(){return t(t.s=68756)}),_N_E=t.O()}]);
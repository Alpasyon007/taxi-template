"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[655],{41993:function(e,t,n){var r=n(49631),a=n(52322);t.Z=function(){return(0,a.jsx)("div",{className:"block w-full rounded border border-gray-400 border-opacity-50 bg-gray-300 p-3",children:(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)(r.Z,{size:20,strokeWidth:1.5}),(0,a.jsx)("p",{className:"text-sm",children:"No backups created yet - check again tomorrow."})]})})}},56275:function(e,t,n){n.d(t,{Z:function(){return E}});var r=n(20406),a=n(28526),s=n.n(a),i=n(59491),o=n(46776),c=n(2784),l=n(13734),d=n(70203),u=n(37552),p=n(39097),m=n.n(p),f=n(90394),h=n(95223),x=n(29027),b=n(49257),v=n(73302),j=n(36849),g=n(43635),y=n(14665),w=n(31786),N=n(31375),Z=n(89083),S=n(8647),O=n(97064),_=n(22812),k=n(59800),C=n(52322),P=function(e){var t,n=e.visible,a=e.extension,i=e.onCancel,o=(0,O.d2)().project,l=(0,d.oR)(),u=l.ui,p=l.meta,m=(0,c.useState)(),f=m[0],h=m[1],x=(0,c.useState)(!1),b=x[0],v=x[1],P=(0,k.Q1)({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString}),E=P.data,D=P.isLoading;(0,c.useEffect)(function(){var e,t=!1;return n&&(e=(0,r.Z)(s().mark(function e(){var n;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t||(v(!0),h(void 0)),e.next=3,p.query("select * from pg_available_extension_versions where name = '".concat(a.name,"'"));case 3:(n=e.sent).error||t||h(n[0].schema),v(!1);case 6:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)})(),function(){t=!0}},[n,a.name]);var T=(t=(0,r.Z)(s().mark(function e(t,n){var r,o,c,l;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((r=n.setSubmitting)(!0),(o=null!=f?f:"custom"===t.schema?t.name:t.schema).startsWith("pg_")){e.next=10;break}return e.next=6,p.query("create schema if not exists ".concat(o));case 6:if(!(c=e.sent.error)){e.next=10;break}return e.abrupt("return",u.setNotification({error:c,category:"error",message:"Failed to create schema: ".concat(c.message)}));case 10:return e.next=12,p.extensions.create({schema:o,name:a.name,version:a.default_version,cascade:!0});case 12:(l=e.sent.error)?u.setNotification({error:l,category:"error",message:"Failed to toggle ".concat(a.name.toUpperCase(),": ").concat(l.message)}):u.setNotification({category:"success",message:"".concat(a.name.toUpperCase()," is on.")}),r(!1),i();case 17:case"end":return e.stop()}},e)})),function(e,n){return t.apply(this,arguments)});return(0,C.jsx)(j.C,{closable:!0,hideFooter:!0,visible:n,onCancel:i,size:"small",header:(0,C.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,C.jsx)("h5",{className:"text-sm text-foreground",children:"Confirm to enable"}),(0,C.jsx)("code",{className:"text-xs",children:a.name})]}),children:(0,C.jsx)(g.Z,{initialValues:{name:a.name,schema:"extensions"},validate:function(e){var t={};return"custom"!==e.schema||e.name||(t.name="Required field"),t},onSubmit:T,children:function(e){var t=e.isSubmitting,n=e.values;return(0,C.jsxs)("div",{className:"space-y-4 py-4",children:[(0,C.jsx)(j.C.Content,{children:b||D?(0,C.jsxs)("div",{className:"space-y-2",children:[(0,C.jsx)(_.Z,{}),(0,C.jsx)("div",{className:"w-3/4",children:(0,C.jsx)(_.Z,{})})]}):f?(0,C.jsx)(y.Z,{disabled:!0,id:"schema",name:"schema",value:f,label:"Select a schema to enable the extension for",descriptionText:"Extension must be installed in ".concat(f,".")}):(0,C.jsxs)(w.Z,{size:"small",name:"schema",label:"Select a schema to enable the extension for",children:[(0,C.jsxs)(w.Z.Option,{id:"custom",label:'Create a new schema "'.concat(a.name,'"'),value:"custom",addOnBefore:function(){return(0,C.jsx)(N.Z,{size:16,strokeWidth:1.5})},children:['Create a new schema "',a.name,'"']},"custom"),(0,C.jsx)(j.C.Separator,{}),null==E?void 0:E.map(function(e){return(0,C.jsx)(w.Z.Option,{id:e.name,label:e.name,value:e.name,addOnBefore:function(){return(0,C.jsx)(Z.Z,{size:16,strokeWidth:1.5})},children:e.name},e.id)})]})}),"custom"===n.schema&&(0,C.jsx)(j.C.Content,{children:(0,C.jsx)(y.Z,{id:"name",name:"name",label:"Schema name"})}),(0,C.jsx)(j.C.Separator,{}),(0,C.jsx)(j.C.Content,{children:(0,C.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,C.jsx)(S.z,{type:"default",disabled:t,onClick:function(){return i()},children:"Cancel"}),(0,C.jsx)(S.z,{htmlType:"submit",disabled:t,loading:t,children:"Enable extension"})]})})]})}})})},E=(0,o.Pi)(function(e){var t,n,a,o,p,g=e.extension,y=(0,d.oR)(),w=y.ui,N=y.meta,Z=null!==g.installed_version,S=(0,c.useState)(!1),O=S[0],_=S[1],k=(0,c.useState)(!1),E=k[0],D=k[1],T=(0,d.Xo)(i.KA.TENANT_SQL_ADMIN_WRITE,"extensions");function R(){return(R=(0,r.Z)(s().mark(function e(){return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",D(!0));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}var F=(0,c.useState)(!1),z=F[0],A=F[1];function I(){return(I=(0,r.Z)(s().mark(function e(){var t;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,_(!0),e.next=4,N.extensions.del(g.name);case 4:if(t=e.sent,(0,u.d8)(t)){e.next=7;break}throw t.error;case 7:w.setNotification({category:"success",message:"".concat(g.name.toUpperCase()," is off.")}),A(!1),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),w.setNotification({category:"error",message:"Toggle ".concat(g.name.toUpperCase()," failed: ").concat(e.t0.message)});case 14:return e.prev=14,N.extensions.load(),_(!1),e.finish(14);case 18:case"end":return e.stop()}},e,null,[[0,11,14,18]])}))).apply(this,arguments)}return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)("div",{className:"flex border-overlay flex-col overflow-hidden rounded border shadow-sm",children:[(0,C.jsxs)("div",{className:"border-overlay bg-surface-100 flex justify-between w-full border-b py-3 px-4",children:[(0,C.jsxs)("div",{className:"flex items-center gap-1 max-w-[85%]",children:[(0,C.jsxs)("div",{className:"flex items-center space-x-2 truncate",children:[(0,C.jsx)("h3",{title:g.name,className:"h-5 m-0 text-sm truncate cursor-pointer text-foreground",children:g.name}),(0,C.jsx)("p",{className:"text-sm text-foreground-light",children:null!==(t=null==g?void 0:g.installed_version)&&void 0!==t?t:g.default_version})]}),f.Rw.find(function(e){return e.name===g.name})?(0,C.jsx)(m(),{href:null!==(n=f.Rw.find(function(e){return e.name===g.name}))&&void 0!==n&&n.link.startsWith("/guides")?"https://supabase.com/docs".concat(null===(a=f.Rw.find(function(e){return e.name===g.name}))||void 0===a?void 0:a.link):null!==(o=null===(p=f.Rw.find(function(e){return e.name===g.name}))||void 0===p?void 0:p.link)&&void 0!==o?o:"",className:"max-w-[85%] cursor-default zans",target:"_blank",rel:"noreferrer",children:(0,C.jsx)(h.Z,{className:"ml-2.5 cursor-pointer",size:14})}):null]}),O?(0,C.jsx)(x.Z,{className:"animate-spin",size:16}):(0,C.jsx)(b.Z,{size:"tiny",checked:Z,disabled:!T,onChange:function(){return Z?void A(!0):function(){return R.apply(this,arguments)}()}})]}),(0,C.jsxs)("div",{className:"bg-panel-header-light bg-panel-secondary-light flex h-full flex-col justify-between",children:[(0,C.jsx)("div",{className:"py-3 px-4",children:(0,C.jsx)("p",{className:"text-sm text-foreground-light capitalize-sentence",children:g.comment})}),Z&&g.schema&&(0,C.jsx)("div",{className:"py-3 px-4",children:(0,C.jsxs)("div",{className:"flex items-center flex-grow space-x-2 text-sm text-foreground-light",children:[(0,C.jsx)("span",{children:"Schema:"}),(0,C.jsx)(v.Z,{color:"scale",children:"".concat(g.schema)})]})})]})]}),(0,C.jsx)(P,{visible:E,extension:g,onCancel:function(){return D(!1)}}),(0,C.jsx)(l.Z,{visible:z,header:"Confirm to disable extension",buttonLabel:"Disable",onSelectCancel:function(){return A(!1)},onSelectConfirm:function(){!function(){I.apply(this,arguments)}()},children:(0,C.jsx)(j.C.Content,{children:(0,C.jsxs)("p",{className:"py-4 text-sm text-foreground-light",children:['Are you sure you want to turn OFF "',g.name,'" extension?']})})})]})})},92913:function(e,t,n){n.d(t,{M4:function(){return tU},TH:function(){return _},B8:function(){return nD},RA:function(){return nu},ZY:function(){return e8},ZR:function(){return nM},eX:function(){return nN},_h:function(){return tp},Ms:function(){return rj},IP:function(){return ev},Vj:function(){return tw},_y:function(){return tS},yT:function(){return el},bw:function(){return A},Hm:function(){return tg}});var r=n(24990),a=n(59491),s=n(76635),i=n(46776),o=n(2784),c=n(88688),l=n(8647),d=n(51803),u=n(14665),p=n(55210),m=n(31375),f=n(93306),h=n(924),x=n(34040),b=n(77426),v=n(53526),j=n(55268),g=n(45812),y=n(22812),w=n(70203),N=n(41337),Z=n(85459),S=n(1846),O=n(52322),_=(0,i.Pi)(function(e){var t,n,i,_,k=e.table,C=e.onSelectBack,P=void 0===C?s.noop:C,E=e.onAddColumn,D=void 0===E?s.noop:E,T=e.onEditColumn,R=void 0===T?s.noop:T,F=e.onDeleteColumn,z=void 0===F?s.noop:F,A=(0,o.useState)(""),I=A[0],V=A[1],L=(0,N.Z)(k.id),W=L.data,q=L.error,Y=L.isError,M=L.isLoading,U=L.isSuccess,B=null!==(t=0===I.length?null!==(n=null==W?void 0:W.columns)&&void 0!==n?n:[]:null==W?void 0:null===(i=W.columns)||void 0===i?void 0:i.filter(function(e){return e.name.includes(I)}))&&void 0!==t?t:[],X=Z.F.includes(null!==(_=k.schema)&&void 0!==_?_:""),H=(0,w.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"columns");return(0,O.jsxs)("div",{className:"space-y-4",children:[(0,O.jsx)("div",{className:"flex items-center space-x-2",children:(0,O.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,O.jsx)("h3",{className:"mb-1 text-xl text-foreground",children:"Database Tables"}),(0,O.jsx)(c.Z,{strokeWidth:1.5,className:"text-foreground-light"}),(0,O.jsx)("h3",{className:"mb-1 text-xl text-foreground",children:k.name})]})}),(0,O.jsxs)("div",{className:"flex items-center justify-between",children:[(0,O.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,O.jsx)(l.z,{type:"outline",onClick:function(){return P()},icon:(0,O.jsx)(d.Z,{size:"small"}),style:{padding:"5px"}}),(0,O.jsx)(u.Z,{size:"small",placeholder:"Filter columns",value:I,onChange:function(e){return V(e.target.value)},icon:(0,O.jsx)(p.Z,{size:"tiny"})})]}),!X&&(0,O.jsx)("div",{children:(0,O.jsxs)(r.fC,{delayDuration:0,children:[(0,O.jsx)(r.xz,{children:(0,O.jsx)(l.z,{disabled:!H,icon:(0,O.jsx)(m.Z,{}),onClick:function(){return D()},children:"New column"})}),!H&&(0,O.jsx)(r.h_,{children:(0,O.jsxs)(r.VY,{side:"bottom",children:[(0,O.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,O.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,O.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to create columns"})})]})})]})})]}),X&&(0,O.jsx)(S.Z,{schema:k.schema,entity:"columns"}),M&&(0,O.jsx)(y.A,{}),Y&&(0,O.jsx)(g.Z,{error:q,subject:'Failed to retrieve columns for table "'.concat(k.schema,".").concat(k.name,'"')}),U&&(0,O.jsx)(O.Fragment,{children:0===B.length?(0,O.jsx)(v.Z,{}):(0,O.jsx)("div",{children:(0,O.jsx)(j.Z,{head:[(0,O.jsx)(j.Z.th,{children:"Name"},"name"),(0,O.jsx)(j.Z.th,{className:"hidden lg:table-cell",children:"Description"},"description"),(0,O.jsx)(j.Z.th,{className:"hidden xl:table-cell",children:"Data Type"},"type"),(0,O.jsx)(j.Z.th,{className:"hidden xl:table-cell",children:"Format"},"format"),(0,O.jsx)(j.Z.th,{},"buttons")],body:B.map(function(e,t){return(0,O.jsxs)(j.Z.tr,{className:"border-t",children:[(0,O.jsx)(j.Z.td,{children:(0,O.jsx)("p",{children:e.name})}),(0,O.jsx)(j.Z.td,{className:"break-all whitespace-normal",children:null!==e.comment?(0,O.jsx)("p",{title:e.comment,children:e.comment}):(0,O.jsx)("p",{className:"text-border-stronger",children:"No description"})}),(0,O.jsx)(j.Z.td,{children:(0,O.jsx)("code",{className:"text-xs",children:e.data_type})}),(0,O.jsx)(j.Z.td,{className:"font-mono text-xs",children:(0,O.jsx)("code",{className:"text-xs",children:e.format})}),(0,O.jsx)(j.Z.td,{className:"text-right",children:!X&&(0,O.jsxs)(f.h_,{children:[(0,O.jsx)(f.$F,{children:(0,O.jsx)(l.z,{asChild:!0,type:"default",icon:(0,O.jsx)(h.Z,{}),className:"px-1",children:(0,O.jsx)("span",{})})}),(0,O.jsxs)(f.AW,{side:"bottom",align:"end",className:"w-32",children:[(0,O.jsx)(f.Xi,{disabled:!H,onClick:function(){return R(e)},children:(0,O.jsxs)(r.fC,{delayDuration:0,children:[(0,O.jsxs)(r.xz,{className:"flex items-center space-x-2",children:[(0,O.jsx)(x.Z,{size:"tiny"}),(0,O.jsx)("p",{children:"Edit column"})]}),!H&&(0,O.jsx)(r.h_,{children:(0,O.jsxs)(r.VY,{side:"bottom",children:[(0,O.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,O.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,O.jsx)("span",{className:"text-xs text-foreground",children:"Additional permissions required to edit column"})})]})})]})}),(0,O.jsx)(f.Xi,{disabled:!H||X,onClick:function(){return z(e)},children:(0,O.jsxs)(r.fC,{delayDuration:0,children:[(0,O.jsxs)(r.xz,{className:"flex items-center space-x-2",children:[(0,O.jsx)(b.Z,{stroke:"red",size:"tiny"}),(0,O.jsx)("p",{children:"Delete column"})]}),!H&&(0,O.jsx)(r.h_,{children:(0,O.jsxs)(r.VY,{side:"bottom",children:[(0,O.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,O.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,O.jsx)("span",{className:"text-xs text-foreground",children:"Additional permissions required to edit column"})})]})})]})})]})]})})]},e.name)})})})})]})}),k=n(81333),C=n(97064),P=n(19269),E=n(59800),D=n(4167),T=n(55144),R=n(97346),F=n(59227),z=n(25063),A=(0,i.Pi)(function(e){var t=e.onAddTable,n=void 0===t?s.noop:t,i=e.onEditTable,c=void 0===i?s.noop:i,d=e.onDeleteTable,N=void 0===d?s.noop:d,_=e.onOpenTable,A=void 0===_?s.noop:_,I=(0,w.oR)().meta,V=(0,C.d2)().project,L=(0,T._2)(),W=(0,o.useState)(""),q=W[0],Y=W[1],M=(0,w.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"tables"),U=(0,E.Q1)({projectRef:null==V?void 0:V.ref,connectionString:null==V?void 0:V.connectionString}).data,B=(0,s.partition)(null!=U?U:[],function(e){var t;return Z.F.includes(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"")}),X=(0,k.Z)(B,1)[0],H=(0,D.Bj)({projectRef:null==V?void 0:V.ref,connectionString:null==V?void 0:V.connectionString,schema:L.selectedSchemaName},{select:function(e){return 0===q.length?e:e.filter(function(e){return e.name.includes(q)})}}),Q=H.data,K=H.isLoading,G=H.isSuccess,J=H.isError,$=H.error,ee=I.publications.list().find(function(e){return"supabase_realtime"===e.name}),et=null==U?void 0:U.find(function(e){return e.name===L.selectedSchemaName}),en=X.some(function(e){return e.id===(null==et?void 0:et.id)});return(0,O.jsxs)("div",{className:"space-y-4",children:[(0,O.jsx)("h3",{className:"mb-1 text-xl text-foreground",children:"Database Tables"}),(0,O.jsxs)("div",{className:"flex items-center justify-between",children:[(0,O.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,O.jsx)(P.Z,{className:"w-[260px]",size:"small",showError:!1,selectedSchemaName:L.selectedSchemaName,onSelectSchema:L.setSelectedSchemaName}),(0,O.jsx)(u.Z,{size:"small",className:"w-64",placeholder:"Search for a table",value:q,onChange:function(e){return Y(e.target.value)},icon:(0,O.jsx)(p.Z,{size:"tiny"})})]}),!en&&(0,O.jsx)("div",{children:(0,O.jsxs)(r.fC,{delayDuration:0,children:[(0,O.jsx)(r.xz,{children:(0,O.jsx)(l.z,{disabled:!M,icon:(0,O.jsx)(m.Z,{}),onClick:function(){return n()},children:"New table"})}),!M&&(0,O.jsx)(r.h_,{children:(0,O.jsxs)(r.VY,{side:"bottom",children:[(0,O.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,O.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,O.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to create tables"})})]})})]})})]}),en&&(0,O.jsx)(S.Z,{schema:L.selectedSchemaName,entity:"tables"}),K&&(0,O.jsx)(y.A,{}),J&&(0,O.jsx)(g.Z,{error:$,subject:"Failed to retrieve tables"}),G&&(0===Q.length?(0,O.jsx)(v.Z,{}):(0,O.jsx)("div",{className:"my-4 w-full",children:(0,O.jsx)(j.Z,{head:[(0,O.jsx)(j.Z.th,{children:"Name"},"name"),(0,O.jsx)(j.Z.th,{className:"hidden lg:table-cell",children:"Description"},"description"),(0,O.jsx)(j.Z.th,{className:"hidden text-right xl:table-cell",children:"Rows (Estimated)"},"rows"),(0,O.jsx)(j.Z.th,{className:"hidden text-right xl:table-cell",children:"Size (Estimated)"},"size"),(0,O.jsx)(j.Z.th,{className:"hidden xl:table-cell text-center",children:"Realtime Enabled"},"realtime"),(0,O.jsx)(j.Z.th,{},"buttons")],body:(0,O.jsxs)(O.Fragment,{children:[0===Q.length&&0===q.length&&(0,O.jsx)(j.Z.tr,{children:(0,O.jsxs)(j.Z.td,{colSpan:6,children:[(0,O.jsx)("p",{className:"text-sm text-foreground",children:"No tables created yet"}),(0,O.jsxs)("p",{className:"text-sm text-foreground-light",children:['There are no tables found in the schema "',L.selectedSchemaName,'"']})]})},L.selectedSchemaName),0===Q.length&&q.length>0&&(0,O.jsx)(j.Z.tr,{children:(0,O.jsxs)(j.Z.td,{colSpan:6,children:[(0,O.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,O.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',q,'" did not return any results']})]})},L.selectedSchemaName),Q.length>0&&Q.map(function(e,t){var n,a,s;return(0,O.jsxs)(j.Z.tr,{children:[(0,O.jsx)(j.Z.td,{children:e.name.length>20?(0,O.jsxs)(r.fC,{delayDuration:0,disableHoverableContent:!0,children:[(0,O.jsx)(r.xz,{asChild:!0,className:"max-w-[95%] overflow-hidden text-ellipsis whitespace-nowrap",children:(0,O.jsx)("p",{children:e.name})}),(0,O.jsx)(r.h_,{children:(0,O.jsxs)(r.VY,{side:"bottom",children:[(0,O.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,O.jsx)("div",{className:"rounded bg-scale-100 py-1 px-2 leading-none shadow border border-scale-200",children:(0,O.jsx)("span",{className:"text-xs text-foreground",children:e.name})})]})})]}):(0,O.jsx)("p",{children:e.name})}),(0,O.jsx)(j.Z.td,{className:"hidden max-w-sm truncate lg:table-cell break-all whitespace-normal",children:null!==e.comment?(0,O.jsx)("p",{title:e.comment,children:e.comment}):(0,O.jsx)("p",{className:"text-border-stronger",children:"No description"})}),(0,O.jsx)(j.Z.td,{className:"hidden text-right xl:table-cell",children:(null!==(n=e.live_rows_estimate)&&void 0!==n?n:e.live_row_count).toLocaleString()}),(0,O.jsx)(j.Z.td,{className:"hidden text-right xl:table-cell",children:(0,O.jsx)("code",{className:"text-sm",children:e.size})}),(0,O.jsx)(j.Z.td,{className:"hidden xl:table-cell text-center",children:(null!==(a=null==ee?void 0:ee.tables)&&void 0!==a?a:[]).find(function(t){return t.id===e.id})?(0,O.jsx)("div",{className:"flex justify-center",children:(0,O.jsx)(R.Z,{strokeWidth:2,className:"text-brand"})}):(0,O.jsx)("div",{className:"flex justify-center",children:(0,O.jsx)(F.Z,{strokeWidth:2,className:"text-foreground-lighter"})})}),(0,O.jsx)(j.Z.td,{children:(0,O.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,O.jsxs)(l.z,{type:"default",iconRight:(0,O.jsx)(z.Z,{}),className:"whitespace-nowrap hover:border-gray-500",style:{paddingTop:3,paddingBottom:3},onClick:function(){return A(e)},children:[null===(s=e.columns)||void 0===s?void 0:s.length," columns"]}),!en&&(0,O.jsxs)(f.h_,{children:[(0,O.jsx)(f.$F,{children:(0,O.jsx)(l.z,{asChild:!0,type:"default",icon:(0,O.jsx)(h.Z,{}),className:"px-1",children:(0,O.jsx)("span",{})})}),(0,O.jsxs)(f.AW,{side:"bottom",align:"end",className:"w-32",children:[(0,O.jsx)(f.Xi,{disabled:!M,onClick:function(){return c(e)},children:(0,O.jsxs)(r.fC,{delayDuration:0,children:[(0,O.jsxs)(r.xz,{className:"flex items-center space-x-2",children:[(0,O.jsx)(x.Z,{size:"tiny"}),(0,O.jsx)("p",{children:"Edit table"})]}),!M&&(0,O.jsx)(r.h_,{children:(0,O.jsxs)(r.VY,{side:"bottom",children:[(0,O.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,O.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,O.jsx)("span",{className:"text-xs text-foreground",children:"Additional permissions required to edit table"})})]})})]})}),(0,O.jsx)(f.Xi,{disabled:!M||en,onClick:function(){return N(e)},children:(0,O.jsxs)(r.fC,{delayDuration:0,children:[(0,O.jsxs)(r.xz,{className:"flex items-center space-x-2",children:[(0,O.jsx)(b.Z,{stroke:"red",size:"tiny"}),(0,O.jsx)("p",{children:"Delete table"})]}),!M&&(0,O.jsx)(r.h_,{children:(0,O.jsxs)(r.VY,{side:"bottom",children:[(0,O.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,O.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,O.jsx)("span",{className:"text-xs text-foreground",children:"Additional permissions required to delete table"})})]})})]})})]})]})]})})]},e.id)})]})})}))]})}),I=n(20406),V=n(19011),L=n(28526),W=n.n(L),q=n(73302),Y=n(57626),M=n(56163),U=n(2741),B=n(24888),X=n(43635),H=n(49257),Q=n(81253),K=["anon","service_role","authenticated","authenticator","dashboard_user","supabase_admin","supabase_auth_admin","supabase_replication_admin","supabase_storage_admin","supabase_functions_admin","pgbouncer","pgsodium_keyholder","pgsodium_keyiduser","pgsodium_keymaker"],G={can_login:{disabled:!1,description:"User can login"},can_create_role:{disabled:!1,description:"User can create roles"},can_create_db:{disabled:!1,description:"User can create databases"},can_bypass_rls:{disabled:!0,description:"User bypasses every row level security policy"},is_superuser:{disabled:!0,description:"User is a Superuser"},is_replication_role:{disabled:!0,description:"User can initiate streaming replication and put the system in and out of backup mode"}},J=function(e){var t,n=e.visible,a=e.onClose,s=(0,o.useRef)(),i=(0,w.oR)(),c=i.ui,d=i.meta,p=(0,o.useState)(!1),m=p[0],f=p[1],h=(t=(0,I.Z)(W().mark(function e(t){var n;return W().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return f(!0),e.next=3,d.roles.create(t);case 3:if(n=e.sent,f(!1),!n.error){e.next=9;break}return e.abrupt("return",c.setNotification({category:"error",message:"Failed to create role: ".concat(n.error.message)}));case 9:c.setNotification({category:"success",message:"Successfully created new role: ".concat(n.name)}),a();case 11:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)});return(0,O.jsx)(B.ZP,{size:"large",visible:n,header:"Create a new role",className:"mr-0 transform transition-all duration-300 ease-in-out",loading:!1,onCancel:a,customFooter:(0,O.jsxs)("div",{className:"flex w-full justify-end space-x-3 border-t border-default px-3 py-4",children:[(0,O.jsx)(l.z,{size:"tiny",type:"default",htmlType:"button",onClick:a,disabled:m,children:"Cancel"}),(0,O.jsx)(l.z,{size:"tiny",type:"primary",htmlType:"button",disabled:m,loading:m,onClick:function(){var e;return null==s?void 0:null===(e=s.current)||void 0===e?void 0:e.click()},children:"Create role"})]}),children:(0,O.jsx)(X.Z,{validateOnBlur:!0,id:"create-new-role",initialValues:{name:"",is_superuser:!1,can_login:!1,can_create_role:!1,can_create_db:!1,is_replication_role:!1,can_bypass_rls:!1},validate:function(e){var t={};return 0===e.name.length&&(t.name="Please provide a name for your role"),t},onSubmit:h,children:function(e){return e.isSubmitting,e.handleReset,e.values,e.initialValues,(0,O.jsxs)("div",{children:[(0,O.jsx)(Y.hj,{header:(0,O.jsx)(Y.S0,{className:"lg:!col-span-4",children:"Role Configuration"}),children:(0,O.jsx)(Y.B4,{loading:!1,className:"lg:!col-span-8",children:(0,O.jsx)(u.Z,{id:"name",label:"Name"})})}),(0,O.jsx)(B.ZP.Separator,{}),(0,O.jsx)(Y.hj,{header:(0,O.jsx)(Y.S0,{className:"lg:!col-span-4",children:"Role Privileges"}),children:(0,O.jsx)(Y.B4,{loading:!1,className:"lg:!col-span-8",children:(0,O.jsx)("div",{className:"space-y-[9px]",children:Object.keys(G).map(function(e){return(0,O.jsx)(H.Z,{size:"small",disabled:G[e].disabled,className:["roles-toggle",G[e].disabled?"opacity-50":""].join(" "),id:e,name:e,label:G[e].description,afterLabel:G[e].disabled&&(0,O.jsxs)(r.fC,{delayDuration:0,children:[(0,O.jsx)(r.xz,{type:"button",children:(0,O.jsx)(Q.Z,{size:"tiny",strokeWidth:2,className:"ml-2 relative top-[3px]"})}),(0,O.jsxs)(r.VY,{align:"center",side:"bottom",children:[(0,O.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,O.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background space-y-1",children:(0,O.jsx)("span",{className:"text-xs",children:"This privilege cannot be granted via the dashboard"})})]})]})},e)})})})}),(0,O.jsx)("button",{ref:s,type:"submit",className:"hidden"})]})}})})},$=n(36849),ee=function(e){var t,n=e.role,r=e.visible,a=e.onClose,s=(0,w.oR)(),i=s.ui,c=s.meta,l=(0,o.useState)(!1),d=l[0],u=l[1],p=(t=(0,I.Z)(W().mark(function e(){var t;return W().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",console.error("Failed to delete role: role is missing"));case 2:return u(!0),e.next=5,c.roles.del(n.id);case 5:if(t=e.sent,u(!1),!t.error){e.next=11;break}return e.abrupt("return",i.setNotification({category:"error",message:"Failed to delete role: ".concat(t.error.message)}));case 11:i.setNotification({category:"success",message:'Successfully deleted role: "'.concat(n.name,'"')}),a();case 13:case"end":return e.stop()}},e)})),function(){return t.apply(this,arguments)});return(0,O.jsx)($.C,{size:"small",alignFooter:"right",visible:r,onCancel:a,onConfirm:p,header:(0,O.jsxs)("h3",{children:['Confirm to delete role "',null==n?void 0:n.name,'"']}),loading:d,children:(0,O.jsx)("div",{className:"py-4",children:(0,O.jsx)($.C.Content,{children:(0,O.jsx)("p",{className:"text-sm",children:"This will automatically revoke any membership of this role in other roles, and this action cannot be undone."})})})})},et=n(95235),en=n(82269),er=n(30265),ea=n(7980),es=["is_superuser","is_replication_role"];function ei(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ei(Object(n),!0).forEach(function(t){(0,et.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ei(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var ec=function(e){var t,n=e.role,a=e.disabled,s=void 0!==a&&a,i=e.onSelectDelete,c=(0,w.oR)(),d=c.ui,u=c.meta,p=(0,o.useState)(!1),m=p[0],x=p[1],v=n.is_superuser,j=n.can_login,g=n.can_create_role,y=n.can_create_db,N=n.is_replication_role,Z=n.can_bypass_rls,S=(t=(0,I.Z)(W().mark(function e(t,r){var a,s,i,o;return W().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.setSubmitting,s=r.resetForm,a(!0),t.is_superuser,t.is_replication_role,i=(0,en.Z)(t,es),e.next=5,u.roles.update(n.id,i);case 5:o=e.sent,a(!1),o.error?d.setNotification({category:"error",message:'Failed to update role "'.concat(n.name,'": ').concat(o.error.message)}):(d.setNotification({category:"success",message:'Successfully updated role "'.concat(n.name,'"')}),s({values:eo({},t),initialValues:eo({},t)}));case 8:case"end":return e.stop()}},e)})),function(e,n){return t.apply(this,arguments)});return(0,O.jsx)(X.Z,{name:"role-update-form",initialValues:{is_superuser:v,can_login:j,can_create_role:g,can_create_db:y,is_replication_role:N,can_bypass_rls:Z},onSubmit:S,className:"bg-surface-100 hover:bg-overlay-hover data-open:bg-selection border-default hover:border-strong data-open:border-strong data-open:pb-px col-span-12 mx-auto -space-y-px overflow-hidden border border-t-0 first:border-t first:!mt-0 hover:border-t hover:-mt-[1px] shadow transition hover:z-50 first:rounded-tl first:rounded-tr last:rounded-bl last:rounded-br",children:function(e){var t=e.values,a=e.initialValues,o=e.handleReset,c=e.isSubmitting,d=JSON.stringify(t)!==JSON.stringify(a);return(0,O.jsxs)(er.ZP,{open:m,children:[(0,O.jsx)(er.ZP.Trigger,{asChild:!0,children:(0,O.jsxs)("button",{id:"collapsible-trigger",type:"button",className:"group flex w-full items-center justify-between rounded py-3 px-6 text-foreground",onClick:function(e){"collapsible-trigger"===e.target.id&&x(!m)},children:[(0,O.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,O.jsx)(ea.Z,{id:"collapsible-trigger",className:"text-border-stronger transition data-open-parent:rotate-0 data-closed-parent:rotate-180",strokeWidth:2,width:14}),(0,O.jsxs)("div",{className:"space-x-2 flex items-center",children:[(0,O.jsx)("p",{className:"text-left text-sm",id:"collapsible-trigger",children:n.name}),(0,O.jsxs)("p",{className:"text-left text-sm text-foreground-light",id:"collapsible-trigger",children:["(ID: ",n.id,")"]})]})]}),(0,O.jsxs)("div",{className:"flex items-center space-x-4",children:[n.active_connections>0&&(0,O.jsx)("div",{className:"relative h-2 w-2",children:(0,O.jsxs)("span",{className:"flex h-2 w-2",children:[(0,O.jsx)("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-brand opacity-75"}),(0,O.jsx)("span",{className:"relative inline-flex h-2 w-2 rounded-full bg-brand opacity-75"})]})}),(0,O.jsxs)("p",{id:"collapsible-trigger",className:"text-sm ".concat(n.active_connections>0?"text-foreground":"text-foreground-light"),children:[n.active_connections," connections"]}),!s&&(0,O.jsxs)(f.h_,{children:[(0,O.jsx)(f.$F,{children:(0,O.jsx)(l.z,{asChild:!0,type:"default",className:"px-1",icon:(0,O.jsx)(h.Z,{}),children:(0,O.jsx)("span",{})})}),(0,O.jsx)(f.AW,{side:"bottom",className:"w-[120px]",children:(0,O.jsxs)(f.Xi,{className:"space-x-2",onClick:function(e){e.stopPropagation(),i(n)},children:[(0,O.jsx)(b.Z,{className:"text-red-800",size:"tiny",strokeWidth:2}),(0,O.jsx)("p",{children:"Delete"})]})})]})]})]})}),(0,O.jsx)(er.ZP.Content,{children:(0,O.jsxs)("div",{className:"group border-t border-default bg-surface-100 py-6 px-20 text-foreground",children:[(0,O.jsx)("div",{className:"py-4 space-y-[9px]",children:Object.keys(G).map(function(e){return(0,O.jsx)(H.Z,{size:"small",id:e,name:e,label:G[e].description,disabled:s||G[e].disabled,className:["roles-toggle",s||G[e].disabled?"opacity-50":""].join(" "),afterLabel:!s&&G[e].disabled&&(0,O.jsxs)(r.fC,{delayDuration:0,children:[(0,O.jsx)(r.xz,{type:"button",children:(0,O.jsx)(Q.Z,{size:"tiny",strokeWidth:2,className:"ml-2 relative top-[3px]"})}),(0,O.jsx)(r.h_,{children:(0,O.jsxs)(r.VY,{align:"center",side:"bottom",children:[(0,O.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,O.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background space-y-1",children:(0,O.jsx)("span",{className:"text-xs",children:"This privilege cannot be updated via the dashboard"})})]})})]})},e)})}),!s&&(0,O.jsxs)("div",{className:"py-4 flex items-center space-x-2 justify-end",children:[(0,O.jsx)(l.z,{type:"default",disabled:!d||c,onClick:function(){return o()},children:"Cancel"}),(0,O.jsx)(l.z,{type:"primary",htmlType:"submit",disabled:!d||c,loading:c,children:"Save"})]})]})})]})}})},el=(0,i.Pi)(function(e){(0,V.Z)(e);var t=(0,w.oR)().meta,n=(0,o.useState)(0),i=n[0],c=n[1],d=(0,o.useState)(""),f=d[0],h=d[1],x=(0,o.useState)("all"),b=x[0],v=x[1],j=(0,o.useState)(!1),g=j[0],y=j[1],N=(0,o.useState)(),Z=N[0],S=N[1],_=(0,w.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"roles");(0,o.useEffect)(function(){var e;(e=(0,I.Z)(W().mark(function e(){var n,r,a;return W().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.query("show max_connections");case 2:(n=e.sent).error||c(Number(null!==(r=null===(a=n[0])||void 0===a?void 0:a.max_connections)&&void 0!==r?r:0));case 4:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)})()},[]);var C=t.roles.list(),P=("active"===b?t.roles.list(function(e){return e.active_connections>0}):t.roles.list()).filter(function(e){return e.name.includes(f)}),E=(0,s.partition)(P,function(e){return K.includes(e.name)}),D=(0,k.Z)(E,2),T=D[0],R=D[1],z=C.map(function(e){return e.active_connections}).reduce(function(e,t){return e+t},0),A=C.filter(function(e){return e.active_connections>0}).sort(function(e,t){return t.active_connections-e.active_connections});return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)("div",{children:[(0,O.jsx)("div",{className:"flex items-center justify-between",children:(0,O.jsx)(Y.ph,{title:"Database Roles",description:"Manage access control to your database through users, groups, and permissions"})}),(0,O.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,O.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,O.jsx)(u.Z,{size:"small",placeholder:"Search for a role",icon:(0,O.jsx)(p.Z,{size:"tiny"}),value:f,onChange:function(e){return h(e.target.value)},actions:f&&(0,O.jsx)(l.z,{size:"tiny",type:"text",onClick:function(){return h("")},className:"px-1 mr-1",children:(0,O.jsx)(F.Z,{size:12,strokeWidth:2})})}),(0,O.jsxs)("div",{className:"flex items-center border border-strong rounded-full w-min h-[34px]",children:[(0,O.jsx)("button",{className:["text-xs w-[90px] h-full text-center rounded-l-full flex items-center justify-center transition","all"===b?"bg-overlay-hover text-foreground":"hover:bg-surface-200 text-foreground-light"].join(" "),onClick:function(){return v("all")},children:"All roles"}),(0,O.jsx)("div",{className:"h-full w-[1px] border-r border-strong"}),(0,O.jsx)("button",{className:["text-xs w-[90px] h-full text-center rounded-r-full flex items-center justify-center transition","active"===b?"bg-overlay-hover text-foreground":"hover:bg-surface-200 text-foreground-light"].join(" "),onClick:function(){return v("active")},children:"Active roles"})]})]}),(0,O.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,O.jsxs)(r.fC,{delayDuration:0,children:[(0,O.jsx)(r.xz,{children:(0,O.jsx)("div",{className:"w-42",children:(0,O.jsx)(U.Z,{type:"horizontal",max:i,value:z,barClass:0===i?"bg-control":z>.9*i?"bg-red-800":z>.75*i?"bg-amber-900":"bg-green-800",labelTop:"".concat(z,"/").concat(i),labelBottom:"Active connections"})})}),(0,O.jsxs)(r.VY,{align:"start",side:"bottom",children:[(0,O.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,O.jsxs)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background space-y-1",children:[(0,O.jsx)("p",{className:"text-xs text-foreground-light pr-2",children:"Connections by roles:"}),A.map(function(e){return(0,O.jsxs)("div",{className:"text-xs text-foreground",children:[e.name,": ",e.active_connections]},e.id)})]})]})]}),(0,O.jsxs)(r.fC,{delayDuration:0,children:[(0,O.jsx)(r.xz,{children:(0,O.jsx)(l.z,{type:"primary",disabled:!_,icon:(0,O.jsx)(m.Z,{size:"tiny"}),onClick:function(){return y(!0)},children:"Add role"})}),!_&&(0,O.jsxs)(r.VY,{align:"start",side:"bottom",children:[(0,O.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,O.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background text-xs",children:"You need additional permissions to add a new role"})]})]})]})]}),(0,O.jsxs)("div",{className:"space-y-4",children:[(0,O.jsxs)("div",{children:[T.length>0&&(0,O.jsxs)("div",{className:"bg-surface-100 border border-default px-6 py-3 rounded-t flex items-center space-x-4",children:[(0,O.jsx)("p",{className:"text-sm text-foreground-light",children:"Roles managed by Supabase"}),(0,O.jsx)(q.Z,{color:"green",children:"Protected"})]}),T.map(function(e,t){return(0,O.jsx)(ec,{disabled:!0,role:e,onSelectDelete:S},e.id)})]}),(0,O.jsxs)("div",{children:[R.length>0&&(0,O.jsx)("div",{className:"bg-surface-100 border border-default px-6 py-3 rounded-t",children:(0,O.jsx)("p",{className:"text-sm text-foreground-light",children:"Other database roles"})}),R.map(function(e,t){return(0,O.jsx)(ec,{disabled:!_,role:e,onSelectDelete:S},e.id)})]})]}),f.length>0&&0===P.length&&(0,O.jsx)(M.Z,{searchString:f,onResetFilter:function(){return h("")}})]}),(0,O.jsx)(J,{visible:g,onClose:function(){return y(!1)}}),(0,O.jsx)(ee,{role:Z,visible:void 0!==Z,onClose:function(){return S(void 0)}})]})}),ed=n(39097),eu=n.n(ed),ep=n(23733),em=n(95223),ef=n(4300),eh=n(88281),ex=n(56275),eb=["adminpack","amcheck","file_fdw","lo","old_snapshot","pageinspect","pg_buffercache","pg_freespacemap","pg_prewarm","pg_surgery","pg_visibility","pgstattuple","supabase_vault","intagg","xml2","pg_tle"],ev=(0,i.Pi)(function(){var e=(0,w.oR)().meta,t=(0,ef.UO)().filter,n=(0,o.useState)(""),r=n[0],i=n[1],c=0===r.length?e.extensions.list():e.extensions.list(function(e){return e.name.includes(r)}),d=c.filter(function(e){return!eb.includes(e.name)}),m=(0,s.partition)(d,function(e){return!(0,s.isNull)(e.installed_version)}),f=(0,k.Z)(m,2),h=f[0],x=f[1],b=(0,w.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"extensions");return(0,o.useEffect)(function(){void 0!==t&&i(t)},[t]),(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("div",{className:"mb-4",children:(0,O.jsxs)("div",{className:"flex items-center justify-between",children:[(0,O.jsx)(u.Z,{size:"small",placeholder:"Search for an extension",value:r,onChange:function(e){return i(e.target.value)},className:"w-64",icon:(0,O.jsx)(p.Z,{size:"tiny"})}),b?(0,O.jsx)(l.z,{asChild:!0,type:"default",icon:(0,O.jsx)(em.Z,{}),children:(0,O.jsx)(eu(),{href:"https://supabase.com/docs/guides/database/extensions",target:"_blank",rel:"noreferrer",children:"Documentation"})}):(0,O.jsx)("div",{className:"w-[500px]",children:(0,O.jsx)(eh.Z,{icon:(0,O.jsx)(ep.Z,{className:"text-foreground-light",strokeWidth:2}),title:"You need additional permissions to update database extensions"})})]})}),0===c.length&&(0,O.jsx)(M.Z,{searchString:r,onResetFilter:function(){return i("")}}),(0,O.jsxs)("div",{className:"my-8 w-full space-y-12",children:[h.length>0&&(0,O.jsxs)("div",{className:"space-y-4",children:[(0,O.jsx)("h4",{className:"text-lg",children:"Enabled extensions"}),(0,O.jsx)("div",{className:"mb-4 grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-3",children:h.map(function(e){return(0,O.jsx)(ex.Z,{extension:e},e.name)})})]}),x.length>0&&(0,O.jsxs)("div",{className:"space-y-4",children:[(0,O.jsx)("h4",{className:"text-lg",children:"Available extensions"}),(0,O.jsx)("div",{className:"mb-4 grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-3",children:x.map(function(e){return(0,O.jsx)(ex.Z,{extension:e},e.name)})})]})]})]})}),ej=n(12741),eg=n(55830),ey=n(5632),ew=n(62350),eN=n(62202),eZ=n(94170),eS=n(52712);function eO(e){return"\n    begin;\n\n    ".concat(e,"\n    \n    commit;\n  ")}var e_=["onSuccess","onError"];function ek(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eC(e){var t=e.wrapperMeta,n=e.formState,r=e.tables,a=r.filter(function(e){return e.is_new_schema}).map(function(e){return"create schema if not exists ".concat(e.schema_name,";")}).join("\n"),s="\n    create foreign data wrapper ".concat(n.wrapper_name,"\n    handler ").concat(t.handlerName,"\n    validator ").concat(t.validatorName,";\n  "),i=t.server.options.filter(function(e){return e.encrypted}),o=t.server.options.filter(function(e){return!e.encrypted}),c=i.map(function(e){var t="".concat(n.wrapper_name,"_").concat(e.name),r=(n[e.name]||"").replace(/'/g,"''");return"\n      select pgsodium.create_key(\n        name := '".concat(t,"'\n      );\n\n      select vault.create_secret (\n        new_secret := '").concat(r,"',\n        new_name   := '").concat(t,"',\n        new_key_id := (select id from pgsodium.valid_key where name = '").concat(t,"')\n      );\n    ")}).join("\n"),l=i.map(function(e){return"".concat(e.name," ''%s''")}),d=o.map(function(e){return"".concat(e.name," ''").concat(n[e.name],"''")}),u=[].concat((0,ej.Z)(l),(0,ej.Z)(d)).join(","),p="\n    do $$\n    declare\n      ".concat(i.map(function(e){return"v_".concat(e.name," text;")}).join("\n"),"\n    begin\n      ").concat(i.map(function(e){return"select id into v_".concat(e.name," from pgsodium.valid_key where name = '").concat(n.wrapper_name,"_").concat(e.name,"' limit 1;")}).join("\n"),"\n    \n      execute format(\n        E'create server ").concat(n.server_name,"\\n'\n        '   foreign data wrapper ").concat(n.wrapper_name,"\\n'\n        '   options (\\n'\n        '     ").concat(u,"\\n'\n        '   );',\n        ").concat(i.map(function(e){return"v_".concat(e.name)}).join(",\n"),"\n      );\n    end $$;\n  "),m=r.map(function(e){var t=e.columns;return'\n        create foreign table "'.concat(e.schema_name,'"."').concat(e.table_name,'" (\n          ').concat(t.map(function(e){return'"'.concat(e.name,'" ').concat(e.type)}).join(",\n          "),"\n        )\n        server ").concat(n.server_name,"\n        options (\n          ").concat(Object.entries(e).filter(function(e){var t=(0,k.Z)(e,2),n=t[0],r=t[1];return"table_name"!==n&&"schema_name"!==n&&"columns"!==n&&"index"!==n&&"is_new_schema"!==n&&!!r}).map(function(e){var t=(0,k.Z)(e,2),n=t[0],r=t[1];return"".concat(n," '").concat(r,"'")}).join(",\n          "),"\n        );\n      ")}).join("\n\n");return"\n    ".concat(a,"\n\n    ").concat(s,"\n\n    ").concat(c,"\n\n    ").concat(p,"\n\n    ").concat(m,"\n  ")}function eP(){return(eP=(0,I.Z)(W().mark(function e(t){var n,r,a,s;return W().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.projectRef,r=t.connectionString,a=eO(eC({wrapperMeta:t.wrapperMeta,formState:t.formState,tables:t.tables})),e.next=4,(0,eZ.Rj)({projectRef:n,connectionString:r,sql:a});case 4:return s=e.sent.result,e.abrupt("return",s);case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}var eE=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onSuccess,n=e.onError,r=(0,en.Z)(e,e_),a=(0,eg.NL)(),s=(0,w.oR)().vault;return(0,ew.D)(function(e){return function(e){return eP.apply(this,arguments)}(e)},function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ek(Object(n),!0).forEach(function(t){(0,et.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ek(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({onSuccess:function(e,n,r){return(0,I.Z)(W().mark(function i(){var o;return W().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return o=n.projectRef,i.next=3,Promise.all([a.invalidateQueries(eS.M.query(o,["fdws"]),{refetchType:"all"}),s.load()]);case 3:return i.next=5,null==t?void 0:t(e,n,r);case 5:case"end":return i.stop()}},i)}))()},onError:function(e,t,r){return(0,I.Z)(W().mark(function a(){return W().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:void 0===n?eN.Am.error("Failed to create ".concat(t.wrapperMeta.label," foreign data wrapper: ").concat(e.message)):n(e,t,r);case 1:case"end":return a.stop()}},a)}))()}},r))},eD=n(55535),eT=n(29027),eR=n(37927),eF=n(11306),ez=function(e){var t,n,r,a=e.option,s=e.loading,i=e.error,c=(0,o.useState)(!a.hidden),d=c[0],p=c[1];return a.isTextArea?(0,O.jsx)("div",{className:"text-area-text-sm text-area-resize-none",children:(0,O.jsx)(u.Z.TextArea,{rows:6,error:i,className:"input-mono",disabled:s,id:a.name,name:a.name,label:(0,O.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,O.jsx)("p",{children:a.label}),void 0!==a.urlHelper&&(0,O.jsx)(eu(),{href:a.urlHelper,target:"_blank",rel:"noreferrer",children:(0,O.jsx)(Q.Z,{strokeWidth:2,size:14,className:"text-foreground-light hover:text-foreground cursor-pointer transition"})})]}),value:s?"Fetching value from Vault...":void 0,defaultValue:null!==(t=a.defaultValue)&&void 0!==t?t:"",required:null!==(n=a.required)&&void 0!==n&&n},a.name)}):(0,O.jsx)(u.Z,{id:a.name,name:a.name,label:(0,O.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,O.jsx)("p",{children:a.label}),void 0!==a.urlHelper&&(0,O.jsx)(eu(),{href:a.urlHelper,target:"_blank",rel:"noreferrer",children:(0,O.jsx)(Q.Z,{strokeWidth:2,size:14,className:"text-foreground-light hover:text-foreground cursor-pointer transition"})})]}),defaultValue:null!==(r=a.defaultValue)&&void 0!==r?r:"",error:i,value:s?"Fetching value from Vault...":void 0,type:!a.hidden||s?"text":d?"text":"password",disabled:s,actions:s?(0,O.jsx)("div",{className:"flex items-center justify-center mr-1",children:(0,O.jsx)(l.z,{disabled:!0,type:"default",icon:(0,O.jsx)(eT.Z,{className:"animate-spin"})})}):a.hidden?(0,O.jsx)("div",{className:"flex items-center justify-center mr-1",children:(0,O.jsx)(l.z,{type:"default",icon:d?(0,O.jsx)(eR.Z,{}):(0,O.jsx)(eF.Z,{}),onClick:function(){return p(!d)}})}):null},a.name)},eA=n(9747),eI={STRIPE:"stripe_fdw_handler",FIREBASE:"firebase_fdw_handler",S3:"s3_fdw_handler",CLICK_HOUSE:"click_house_fdw_handler",BIG_QUERY:"big_query_fdw_handler",AIRTABLE:"airtable_fdw_handler",LOGFLARE:"logflare_fdw_handler"},eV=[{name:"stripe_wrapper",handlerName:eI.STRIPE,validatorName:"stripe_fdw_validator",icon:"".concat(eA.GW,"/img/icons/stripe-icon.svg"),extensionName:"StripeFdw",label:"Stripe",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/stripe",server:{options:[{name:"api_key_id",label:"Stripe Secret Key",required:!0,encrypted:!0,hidden:!0,urlHelper:"https://stripe.com/docs/keys"},{name:"api_url",label:"Stripe API URL",defaultValue:"https://api.stripe.com/v1",required:!1,encrypted:!1,hidden:!1}]},tables:[{label:"Balance",description:"The balance currently on your Stripe account",availableColumns:[{name:"balance_type",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"balance",editable:!1,required:!0,type:"text"}]},{label:"Balance Transactions",description:"Transactions that have contributed to the balance on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"description",type:"text"},{name:"fee",type:"bigint"},{name:"net",type:"bigint"},{name:"status",type:"text"},{name:"type",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"balance_transactions",editable:!1,required:!0,type:"text"}]},{label:"Charges",description:"Charges made on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"customer",type:"text"},{name:"description",type:"text"},{name:"invoice",type:"text"},{name:"payment_intent",type:"text"},{name:"status",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"charges",editable:!1,required:!0,type:"text"}]},{label:"Customers",description:"Customers on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"email",type:"text"},{name:"name",type:"text"},{name:"description",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"customers",editable:!1,required:!0,type:"text"}]},{label:"Invoices",description:"Invoices on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"customer",type:"text"},{name:"subscription",type:"text"},{name:"status",type:"text"},{name:"total",type:"bigint"},{name:"currency",type:"text"},{name:"period_start",type:"timestamp"},{name:"period_end",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"invoices",editable:!1,required:!0,type:"text"}]},{label:"Payment Intents",description:"Payment Intents on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"customer",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"payment_method",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"payment_intents",editable:!1,required:!0,type:"text"}]},{label:"Products",description:"Products on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"name",type:"text"},{name:"active",type:"bool"},{name:"default_price",type:"text"},{name:"description",type:"text"},{name:"created",type:"timestamp"},{name:"updated",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"products",editable:!1,required:!0,type:"text"}]},{label:"Subscriptions",description:"Subscriptions on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"customer",type:"text"},{name:"currency",type:"text"},{name:"current_period_start",type:"timestamp"},{name:"current_period_end",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"subscriptions",editable:!1,required:!0,type:"text"}]}]},{name:"firebase_wrapper",handlerName:eI.FIREBASE,validatorName:"firebase_fdw_validator",icon:"".concat(eA.GW,"/img/icons/firebase-icon.svg"),extensionName:"FirebaseFdw",label:"Firebase",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/firebase",server:{options:[{name:"project_id",label:"Project ID",required:!0,encrypted:!1,hidden:!1},{name:"sa_key_id",label:"Service Account Key",required:!0,encrypted:!0,hidden:!0,isTextArea:!0,urlHelper:"https://firebase.google.com/docs/admin/setup#initialize-sdk"}]},tables:[{label:"Users",description:"Shows your Firebase users",availableColumns:[{name:"uid",type:"text"},{name:"email",type:"text"},{name:"created_at",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"auth/users",editable:!1,required:!0,type:"text"},{name:"base_url",label:"Base URL",defaultValue:"https://identitytoolkit.googleapis.com/v1/projects",editable:!0,required:!0,type:"text"},{name:"limit",label:"Limit",defaultValue:"10000",editable:!0,required:!0,type:"text"}]},{label:"Firestore Collection",description:"Map to a Firestore collection",availableColumns:[{name:"name",type:"text"},{name:"created_at",type:"timestamp"},{name:"updated_at",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",label:"Object",placeholder:"firestore/[collection_id]",editable:!0,required:!0,type:"text"},{name:"base_url",label:"Base URL",defaultValue:"https://firestore.googleapis.com/v1beta1/projects",editable:!0,required:!0,type:"text"},{name:"limit",label:"Limit",defaultValue:"10000",editable:!0,required:!0,type:"text"}]}]},{name:"s3_wrapper",handlerName:eI.S3,validatorName:"s3_fdw_validator",icon:"".concat(eA.GW,"/img/icons/s3-icon.svg"),extensionName:"S3Fdw",label:"S3",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/s3",server:{options:[{name:"vault_access_key_id",label:"Access Key ID",required:!0,encrypted:!0,hidden:!0},{name:"vault_secret_access_key",label:"Access Key Secret",required:!0,encrypted:!0,hidden:!0},{name:"aws_region",label:"AWS Region",required:!0,encrypted:!1,hidden:!1,defaultValue:"us-east-1"}]},tables:[{label:"S3 File",description:"Map to a file in S3 (CSV or JSON only)",options:[{name:"uri",label:"URI",editable:!0,required:!0,placeholder:"s3://bucket/s3_table.csv",type:"text"},{name:"format",label:"Format",editable:!0,required:!0,type:"select",defaultValue:"csv",options:[{label:"CSV",value:"csv"},{label:"JSONL (JSON Lines)",value:"jsonl"}]},{name:"has_header",label:"Has Header",editable:!0,required:!0,type:"select",defaultValue:"true",options:[{label:"True",value:"true"},{label:"False",value:"false"}]},{name:"compress",label:"Compression",editable:!0,required:!1,type:"select",options:[{label:"GZIP",value:"gzip"}]}]}]},{name:"clickhouse_wrapper",handlerName:eI.CLICK_HOUSE,validatorName:"click_house_fdw_validator",icon:"".concat(eA.GW,"/img/icons/clickhouse-icon.svg"),extensionName:"ClickHouseFdw",label:"ClickHouse",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/clickhouse",server:{options:[{name:"conn_string_id",label:"ClickHouse Connection String",required:!0,encrypted:!0,hidden:!0}]},tables:[{label:"ClickHouse Table",description:"Map to a ClickHouse Table",options:[{name:"table",label:"ClickHouse Table Name",editable:!0,required:!0,placeholder:"my_clickhouse_table",type:"text"},{name:"rowid_column",label:"Row ID Column",defaultValue:"id",editable:!0,required:!0,type:"text"}]}]},{name:"bigquery_wrapper",handlerName:eI.BIG_QUERY,validatorName:"big_query_fdw_validator",icon:"".concat(eA.GW,"/img/icons/bigquery-icon.svg"),extensionName:"BigQueryFdw",label:"BigQuery",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/bigquery",server:{options:[{name:"sa_key_id",label:"Service Account Key",required:!0,encrypted:!0,hidden:!0},{name:"project_id",label:"Project ID",required:!0,encrypted:!1,hidden:!1},{name:"dataset_id",label:"Dataset ID",required:!0,encrypted:!1,hidden:!1}]},tables:[{label:"BigQuery Table",description:"Map to a BigQuery Table",options:[{name:"table",label:"BigQuery Table Name",editable:!0,required:!0,placeholder:"my_bigquery_table",type:"text"},{name:"location",label:"Location",defaultValue:"US",editable:!0,required:!1,type:"text"},{name:"timeout",label:"Timeout (ms)",defaultValue:"30000",editable:!0,required:!1,type:"text"},{name:"rowid_column",label:"Row ID Column",defaultValue:"id",editable:!0,required:!1,type:"text"}]}]},{name:"airtable_wrapper",handlerName:eI.AIRTABLE,validatorName:"airtable_fdw_validator",icon:"".concat(eA.GW,"/img/icons/airtable-icon.svg"),extensionName:"airtableFdw",label:"Airtable",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/airtable",server:{options:[{name:"api_key_id",label:"API Key ID",required:!0,encrypted:!0,hidden:!0}]},tables:[{label:"Airtable Table",description:"Map to an Airtable Table",options:[{name:"base_id",label:"Base ID",editable:!0,required:!0,type:"text"},{name:"table_id",label:"Table ID",editable:!0,required:!0,type:"text"}]}]},{name:"logflare_wrapper",handlerName:eI.LOGFLARE,validatorName:"logflare_fdw_validator",icon:"".concat(eA.GW,"/img/icons/logflare-icon.svg"),extensionName:"logflareFdw",label:"Logflare",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/logflare",server:{options:[{name:"api_key_id",label:"API Key ID",required:!0,encrypted:!0,hidden:!0}]},tables:[{label:"Logflare Table",description:"Map to a Logflare Table",options:[{name:"endpoint",label:"Endpoint",editable:!0,required:!0,type:"text"}]}]}];function eL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eW(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eL(Object(n),!0).forEach(function(t){(0,et.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eL(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var eq=function(e){var t=new Set(e.filter(function(e){return e.required}).map(function(e){return e.name})),n=new Set(Array.from(t).filter(function(e){return e.includes(".")})),r=Array.from(n);return function(e){return Object.fromEntries(Object.entries(e).flatMap(function(e){var t=(0,k.Z)(e,2),n=t[0],r=t[1];return Array.isArray(r)?[[n,r]].concat((0,ej.Z)(r.map(function(e,t){return["".concat(n,".").concat(t),e]}))):[[n,r]]}).filter(function(e){var a=(0,k.Z)(e,2),s=a[0],i=a[1],o=s.split("."),c=(0,k.Z)(o,2),l=c[0];if(void 0!==c[1]&&t.has(l)&&Object.keys(i).some(function(e){return n.has("".concat(l,".").concat(e))})){var d=r.find(function(e){return e.startsWith("".concat(l,"."))});return!!d&&!i[d.split(".")[1]]}return t.has(l)&&(Array.isArray(i)?i.length<1:!i)}).map(function(e){var t=(0,k.Z)(e,1)[0];return"table_name"===t?[t,"Please provide a name for your table"]:"columns"===t?[t,"Please select at least one column"]:[t,"This field is required"]}))}},eY=function(e,t){var n;return(null!==(n=null==e?void 0:e.tables)&&void 0!==n?n:[]).map(function(n){var r,a,s,i=0,o=Object.fromEntries(n.options.map(function(e){return e.split("=")}));switch(e.handler){case eI.STRIPE:i=null!==(r=null==t?void 0:t.tables.findIndex(function(e){var t;return(null===(t=e.options.find(function(e){return"object"===e.name}))||void 0===t?void 0:t.defaultValue)===o.object}))&&void 0!==r?r:0;break;case eI.FIREBASE:i="auth/users"===o.object?null!==(a=null==t?void 0:t.tables.findIndex(function(e){return e.options.find(function(e){return"auth/users"===e.defaultValue})}))&&void 0!==a?a:0:null!==(s=null==t?void 0:t.tables.findIndex(function(e){return"Firestore Collection"===e.label}))&&void 0!==s?s:0;case eI.S3:case eI.AIRTABLE:case eI.LOGFLARE:case eI.BIG_QUERY:case eI.CLICK_HOUSE:}return eW(eW({},o),{},{index:i,columns:n.columns,is_new_schema:!1,schema:n.schema,schema_name:n.schema,table_name:n.name})})},eM=n(28926),eU=n(31786),eB=n(89083),eX=n(58359),eH=n(14086);function eQ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eK(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eQ(Object(n),!0).forEach(function(t){(0,et.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eQ(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var eG=[{name:"",type:"text"}],eJ=function(e){var t=e.initialColumns,n=void 0===t?eG:t,r=e.onChange,a=e.errors,s=void 0===a?{}:a,i=(0,o.useReducer)(function(e,t){switch(t.type){case"ADD_COLUMN":return eK(eK({},e),{},{columns:eK(eK({},e.columns),{},(0,et.Z)({},e.nextId,{id:e.nextId,name:"",type:"text"})),nextId:e.nextId+1});case"REMOVE_COLUMN":return eK(eK({},e),{},{columns:Object.fromEntries(Object.entries(e.columns).filter(function(e){return Number((0,k.Z)(e,1)[0])!==t.payload.id}))});case"UPDATE_COLUMN":return eK(eK({},e),{},{columns:eK(eK({},e.columns),{},(0,et.Z)({},t.payload.id,eK(eK({},e.columns[t.payload.id]),{},(0,et.Z)({},t.payload.key,t.payload.value))))});default:return e}},{columns:Object.fromEntries(n.map(function(e,t){return[t,eK(eK({},e),{},{id:t})]})),nextId:n.length}),c=i[0],d=i[1],p=(0,eH.Z)(r);(0,o.useEffect)(function(){var e;null===(e=p.current)||void 0===e||e.call(p,e$(c.columns))},[c.columns]);var m=function(){d({type:"ADD_COLUMN"})},f=function(e){d({type:"REMOVE_COLUMN",payload:{id:e}})},h=function(e,t,n){d({type:"UPDATE_COLUMN",payload:{id:e,key:t,value:n}})},x=e$(c.columns);return(0,O.jsxs)("div",{className:"w-full flex flex-col gap-4",children:[(0,O.jsx)("div",{className:"flex flex-col gap-4",children:x.map(function(e,t){return(0,O.jsxs)("div",{className:"flex flex-col",children:[(0,O.jsxs)("div",{className:"flex items-center gap-2",children:[(0,O.jsx)(u.Z,{className:"flex-1 [&_label]:!p-0",layout:"vertical",label:"Name",value:e.name,onChange:function(t){return h(e.id,"name",t.target.value)}}),(0,O.jsx)("div",{className:"flex-1",children:(0,O.jsx)(eX.Z,{value:e.type,enumTypes:[],onOptionSelect:function(t){return h(e.id,"type",t)},layout:"vertical",className:"[&_label]:!p-0"})}),(0,O.jsx)(l.z,{onClick:function(){return f(e.id)},icon:(0,O.jsx)(F.Z,{size:14,strokeWidth:1.5}),type:"outline",className:"self-end -translate-y-1 !px-2 !py-2"})]}),s["columns.".concat(t)]&&(0,O.jsx)("span",{className:"text-red-900 text-sm mt-2",children:s["columns.".concat(t)]})]},e.id)})}),(0,O.jsx)(l.z,{type:"default",onClick:function(){return m()},className:"self-start",children:"Add column"})]})};function e$(e){return Object.values(e).sort(function(e,t){return e.id-t.id})}function e0(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function e1(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?e0(Object(n),!0).forEach(function(t){(0,et.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):e0(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var e2=function(e){var t=e.visible,n=e.onCancel,r=e.onSave,a=e.tables,s=e.initialData,i=(0,o.useState)(""),c=i[0],l=i[1];(0,o.useEffect)(function(){s&&l(String(s.index))},[s]);var d=""===c?void 0:a[parseInt(c)],u=function(){l(""),n()};return(0,O.jsx)(B.ZP,{size:"medium",visible:t,onCancel:u,header:(0,O.jsx)("span",{children:"Edit foreign table"}),customFooter:(0,O.jsx)(eM.Z,{backButtonLabel:"Cancel",applyButtonLabel:"Save",formId:"wrapper-table-editor-form",closePanel:u}),children:(0,O.jsx)(B.ZP.Content,{children:(0,O.jsxs)("div",{className:"my-4 space-y-6",children:[(0,O.jsxs)(eU.Z,{size:"small",label:"Select a target the table will point to",value:c,onChange:function(e){return l(e)},children:[(0,O.jsx)(eU.Z.Option,{value:"",label:"---",children:"---"},"empty"),a.map(function(e,t){return(0,O.jsx)(eU.Z.Option,{className:"group",value:String(t),label:e.label,children:(0,O.jsxs)("div",{className:"space-y-1",children:[(0,O.jsx)("p",{children:e.label}),(0,O.jsx)("p",{className:"opacity-50",children:e.description})]})},String(t))})]}),d&&(0,O.jsx)(e4,{table:d,onSubmit:function(e,t){var n=t.resetForm;r(e1(e1({},e),{},{index:parseInt(c),schema_name:"custom"===e.schema?e.schema_name:e.schema,is_new_schema:"custom"===e.schema})),n(),l("")},initialData:s})]})})},"WrapperTableEditor")},e3=function(e){var t,n,r,a=e.option;return"select"===a.type?(0,O.jsx)(eU.Z,{id:a.name,name:a.name,label:a.label,defaultValue:null!==(r=a.defaultValue)&&void 0!==r?r:"",children:[].concat((0,ej.Z)(a.required?[]:[(0,O.jsx)(eU.Z.Option,{value:"",label:"---",children:"---"},"empty")]),(0,ej.Z)(a.options.map(function(e){return(0,O.jsx)(eU.Z.Option,{id:a.name+e.value,value:e.value,label:e.label,children:e.label},e.value)})))},a.name):(0,O.jsx)(u.Z,{id:a.name,name:a.name,label:a.label,placeholder:null!==(t=a.placeholder)&&void 0!==t?t:"",defaultValue:null!==(n=a.defaultValue)&&void 0!==n?n:""},a.name)},e4=function(e){var t,n,r,a=e.table,s=e.onSubmit,i=e.initialData,o=(0,C.d2)().project,c=(0,E.Q1)({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString}),l=c.data,d=c.isLoading,p=c.isSuccess,f=null!==(t=a.options.filter(function(e){return e.editable&&e.required&&!e.defaultValue}))&&void 0!==t?t:[],h=null!==(n=a.options.filter(function(e){return e.editable&&(!e.required||e.defaultValue)}))&&void 0!==n?n:[],x=null!=i?i:e1(e1({table_name:"",columns:null!==(r=a.availableColumns)&&void 0!==r?r:[]},Object.fromEntries(a.options.map(function(e){var t;return[e.name,null!==(t=e.defaultValue)&&void 0!==t?t:""]}))),{},{schema:"public",schema_name:""}),b=eq([].concat((0,ej.Z)(a.options),[{name:"table_name",required:!0},{name:"columns",required:!0}],(0,ej.Z)(a.availableColumns?[]:[{name:"columns.name",required:!0}])));return(0,O.jsx)(X.Z,{id:"wrapper-table-editor-form",initialValues:x,validate:b,onSubmit:s,enableReinitialize:!0,children:function(e){var t,n=e.errors,r=e.values,s=e.setFieldValue;return(0,O.jsxs)("div",{className:"space-y-4",children:[d&&(0,O.jsx)(y.Z,{className:"py-4"}),p&&(0,O.jsxs)(eU.Z,{size:"small",name:"schema",label:"Select a schema for the foreign table",children:[(0,O.jsx)(eU.Z.Option,{id:"custom",label:"Create a new schema",value:"custom",addOnBefore:function(){return(0,O.jsx)(m.Z,{size:16,strokeWidth:1.5})},children:"Create a new schema"},"custom"),(0,O.jsx)($.C.Separator,{}),null===(t=null!=l?l:[])||void 0===t?void 0:t.map(function(e){return(0,O.jsx)(eU.Z.Option,{id:e.name,label:e.name,value:e.name,addOnBefore:function(){return(0,O.jsx)(eB.Z,{size:16,strokeWidth:1.5})},children:e.name},e.id)})]}),"custom"===r.schema&&(0,O.jsx)(u.Z,{id:"schema_name",name:"schema_name",label:"Schema name"}),(0,O.jsx)(u.Z,{id:"table_name",name:"table_name",label:"Table name",descriptionText:"You can query from this table after the wrapper is enabled."}),f.map(function(e){return(0,O.jsx)(e3,{option:e},e.name)}),(0,O.jsxs)("div",{className:"form-group",children:[(0,O.jsx)("label",{className:"!w-full",children:a.availableColumns?"Select the columns to be added to your table":"Add columns to your table"}),(0,O.jsx)("div",{className:"flex flex-wrap gap-2 w-full",children:a.availableColumns?a.availableColumns.map(function(e){var t=!!r.columns.find(function(t){return t.name===e.name});return(0,O.jsx)("div",{className:["px-2 py-1 rounded cursor-pointer transition","".concat(t?"bg-brand-300":"bg-surface-300 hover:bg-selection")].join(" "),onClick:function(){t?s("columns",r.columns.filter(function(t){return t.name!==e.name})):s("columns",r.columns.concat([e]))},children:(0,O.jsx)("p",{className:"text-sm",children:e.name})},e.name)}):(0,O.jsx)(eJ,{initialColumns:r.columns,onChange:function(e){s("columns",e)},errors:n})}),n.columns&&(0,O.jsx)("span",{className:"text-red-900 text-sm mt-2",children:n.columns})]}),h.map(function(e){return(0,O.jsx)(e3,{option:e},e.name)})]})}})};function e5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function e6(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?e5(Object(n),!0).forEach(function(t){(0,et.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):e5(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var e8=(0,i.Pi)(function(){var e,t="create-wrapper-form",n=(0,ey.useRouter)(),r=(0,eg.NL)(),i=(0,w.oR)().ui,c=(0,ef.UO)(),d=c.ref,p=c.type,m=(0,C.d2)().project,f=(0,w.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"wrappers"),h=(0,o.useState)([]),v=h[0],j=h[1],g=(0,o.useState)(!1),y=g[0],N=g[1],Z=(0,o.useState)(),S=Z[0],_=Z[1],k=(0,o.useState)({}),P=k[0],D=k[1],T=eE({onSuccess:function(){i.setNotification({category:"success",message:"Successfully created ".concat(null==z?void 0:z.label," foreign data wrapper")}),j([]),v.some(function(e){return e.is_new_schema})&&(0,E.XL)(r,d),n.push("/project/".concat(d,"/database/wrappers"))}}),R=T.mutate,F=T.isLoading,z=eV.find(function(e){return e.name===p}),A=void 0!==z?e6({wrapper_name:"",server_name:""},Object.fromEntries(z.server.options.map(function(e){var t;return[e.name,null!==(t=e.defaultValue)&&void 0!==t?t:""]}))):{};if(void 0===z)return(0,O.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-full space-y-4",children:[(0,O.jsxs)("div",{className:"space-y-2 flex flex-col items-center w-[400px]",children:[(0,O.jsx)("p",{children:"Unsupported wrapper type"}),(0,O.jsxs)("p",{className:"text-sm text-center text-foreground-light",children:["The wrapper type ",p," not supported by the dashboard. Head back to create a different wrapper."]})]}),(0,O.jsx)(l.z,{asChild:!0,type:"default",children:(0,O.jsx)(eu(),{href:"/project/".concat(d,"/database/wrappers"),children:"Head back"})})]});var V=(e=(0,I.Z)(W().mark(function e(t){var n,r;return W().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=eq(z.server.options)(t),0===(r=t.wrapper_name).length&&(n.name="Please provide a name for your wrapper"),0===v.length&&(n.tables="Please add at least one table"),(0,s.isEmpty)(n)){e.next=7;break}return e.abrupt("return",D(n));case 7:R({projectRef:null==m?void 0:m.ref,connectionString:null==m?void 0:m.connectionString,wrapperMeta:z,formState:e6(e6({},t),{},{server_name:"".concat(r,"_server")}),tables:v});case 8:case"end":return e.stop()}},e)})),function(t){return e.apply(this,arguments)});return(0,O.jsxs)(Y.ld,{children:[(0,O.jsxs)("div",{children:[(0,O.jsxs)("div",{className:"relative flex items-center justify-between mb-6",children:[(0,O.jsx)("div",{className:"transition cursor-pointer absolute -left-20 top-1 opacity-75 hover:opacity-100",children:(0,O.jsx)(eu(),{href:"/project/".concat(d,"/database/wrappers"),children:(0,O.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,O.jsx)(eD.Z,{strokeWidth:1.5,size:14}),(0,O.jsx)("p",{className:"text-sm",children:"Back"})]})})}),(0,O.jsxs)("h3",{className:"mb-2 text-xl text-foreground",children:["Create a ",z.label," Wrapper"]}),(0,O.jsx)("div",{className:"flex items-center space-x-2",children:(0,O.jsx)(l.z,{asChild:!0,type:"default",icon:(0,O.jsx)(em.Z,{strokeWidth:1.5}),children:(0,O.jsx)(eu(),{href:z.docsUrl,target:"_blank",rel:"noreferrer",children:"Documentation"})})})]}),(0,O.jsx)(X.Z,{id:t,initialValues:A,onSubmit:V,children:function(e){var n,r=e.handleReset,a=e.values,s=e.initialValues,i=JSON.stringify(a)!==JSON.stringify(s);return(0,O.jsxs)(Y.by,{disabled:!f,footer:(0,O.jsx)("div",{className:"flex px-8 py-4",children:(0,O.jsx)(Y.iN,{form:t,isSubmitting:F,hasChanges:i,handleReset:r,disabled:!f,helper:f?void 0:"You need additional permissions to create a foreign data wrapper"})}),children:[(0,O.jsx)(Y.hj,{header:(0,O.jsx)(Y.S0,{children:"Wrapper Configuration"}),children:(0,O.jsx)(Y.B4,{loading:!1,children:(0,O.jsx)(u.Z,{id:"wrapper_name",label:"Wrapper Name",error:P.wrapper_name,descriptionText:(null!==(n=null==a?void 0:a.wrapper_name)&&void 0!==n?n:"").length>0?(0,O.jsxs)(O.Fragment,{children:["Your wrapper's server name will be"," ",(0,O.jsxs)("code",{className:"text-xs",children:[a.wrapper_name,"_server"]})]}):""})})}),(0,O.jsx)(Y.hj,{header:(0,O.jsxs)(Y.S0,{children:[z.label," Configuration"]}),children:(0,O.jsx)(Y.B4,{loading:!1,children:z.server.options.map(function(e){return(0,O.jsx)(ez,{option:e,loading:!1,error:P[e.name]},e.name)})})}),(0,O.jsx)(Y.hj,{header:(0,O.jsxs)(Y.S0,{children:[(0,O.jsx)("p",{children:"Foreign Tables"}),(0,O.jsx)("p",{className:"text-foreground-light mt-2 w-[90%]",children:"You can query your data from these foreign tables after the wrapper is created"})]}),children:(0,O.jsxs)(Y.B4,{loading:!1,children:[0===v.length?(0,O.jsx)("div",{className:"flex justify-end translate-y-4",children:(0,O.jsx)(l.z,{type:"default",onClick:function(){return N(!0)},children:"Add foreign table"})}):(0,O.jsx)("div",{className:"space-y-2",children:v.map(function(e,t){return(0,O.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 border rounded-md border-control",children:[(0,O.jsxs)("div",{children:[(0,O.jsxs)("p",{className:"text-sm",children:[e.schema_name,".",e.table_name]}),(0,O.jsxs)("p",{className:"text-sm text-foreground-light",children:[z.tables[e.index].label,":"," ",e.columns.map(function(e){return e.name}).join(", ")]})]}),(0,O.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,O.jsx)(l.z,{type:"default",className:"px-1",icon:(0,O.jsx)(x.Z,{}),onClick:function(){N(!0),_(e6(e6({},e),{},{tableIndex:t}))}}),(0,O.jsx)(l.z,{type:"default",className:"px-1",icon:(0,O.jsx)(b.Z,{}),onClick:function(){j(function(e){return e.filter(function(e,n){return n!==t})})}})]})]},"".concat(e.schema_name,".").concat(e.table_name))})}),v.length>0&&(0,O.jsx)("div",{className:"flex justify-end",children:(0,O.jsx)(l.z,{type:"default",onClick:function(){return N(!0)},children:"Add foreign table"})}),0===v.length&&P.tables&&(0,O.jsx)("p",{className:"text-sm text-right text-red-900",children:P.tables})]})})]})}})]}),(0,O.jsx)(e2,{visible:y,tables:z.tables,onCancel:function(){_(void 0),N(!1)},onSave:function(e){j(function(t){if(void 0!==e.tableIndex){var n=e.tableIndex,r=(0,ej.Z)(t);return delete e.tableIndex,r[n]=e,r}return[].concat((0,ej.Z)(t),[e])}),N(!1),_(void 0)},initialData:S})]})}),e7=n(17578),e9=["onSuccess","onError"];function te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var tt=function(e){var t=e.wrapper,n=e.wrapperMeta.server.options.filter(function(e){return e.encrypted}).map(function(e){var n="".concat(t.name,"_").concat(e.name);return"\n      delete from vault.secrets where key_id = (select id from pgsodium.valid_key where name = '".concat(n,"');\n\n      delete from pgsodium.key where name = '").concat(n,"';\n    ")}).join("\n");return"\n    drop foreign data wrapper if exists ".concat(t.name," cascade;\n\n    ").concat(n,"\n  ")};function tn(){return(tn=(0,I.Z)(W().mark(function e(t){var n,r,a,s;return W().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.projectRef,r=t.connectionString,a=eO(tt({wrapper:t.wrapper,wrapperMeta:t.wrapperMeta})),e.next=4,(0,eZ.Rj)({projectRef:n,connectionString:r,sql:a});case 4:return s=e.sent.result,e.abrupt("return",s);case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}var tr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onSuccess,n=e.onError,r=(0,en.Z)(e,e9),a=(0,eg.NL)(),s=(0,w.oR)().vault;return(0,ew.D)(function(e){return function(e){return tn.apply(this,arguments)}(e)},function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?te(Object(n),!0).forEach(function(t){(0,et.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):te(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({onSuccess:function(e,n,r){return(0,I.Z)(W().mark(function i(){var o;return W().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return o=n.projectRef,i.next=3,Promise.all([a.invalidateQueries(eS.M.query(o,["fdws"])),s.load()]);case 3:return i.next=5,null==t?void 0:t(e,n,r);case 5:case"end":return i.stop()}},i)}))()},onError:function(e,t,r){return(0,I.Z)(W().mark(function a(){return W().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:void 0===n?eN.Am.error("Failed to disable ".concat(t.wrapper.name," foreign data wrapper: ").concat(e.message)):n(e,t,r);case 1:case"end":return a.stop()}},a)}))()}},r))},ta=["onSuccess","onError"];function ts(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var ti=function(e){var t=e.wrapper,n=e.wrapperMeta,r=e.formState,a=e.tables,s=tt({wrapper:t,wrapperMeta:n}),i=eC({wrapperMeta:n,formState:r,tables:a});return"\n    ".concat(s,"\n\n    ").concat(i,"\n  ")};function to(){return(to=(0,I.Z)(W().mark(function e(t){var n,r,a,s,i;return W().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.projectRef,r=t.connectionString,a=t.wrapper,s=eO(ti({wrapper:a,wrapperMeta:t.wrapperMeta,formState:t.formState,tables:t.tables})),e.next=4,(0,eZ.Rj)({projectRef:n,connectionString:r,sql:s});case 4:return i=e.sent.result,e.abrupt("return",i);case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}var tc=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onSuccess,n=e.onError,r=(0,en.Z)(e,ta),a=(0,eg.NL)(),s=(0,w.oR)().vault;return(0,ew.D)(function(e){return function(e){return to.apply(this,arguments)}(e)},function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ts(Object(n),!0).forEach(function(t){(0,et.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ts(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({onSuccess:function(e,n,r){return(0,I.Z)(W().mark(function i(){var o;return W().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return o=n.projectRef,i.next=3,Promise.all([a.invalidateQueries(eS.M.query(o,["fdws"])),s.load()]);case 3:return i.next=5,null==t?void 0:t(e,n,r);case 5:case"end":return i.stop()}},i)}))()},onError:function(e,t,r){return(0,I.Z)(W().mark(function a(){return W().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:void 0===n?eN.Am.error("Failed to update ".concat(t.wrapper.name," foreign data wrapper: ").concat(e.message)):n(e,t,r);case 1:case"end":return a.stop()}},a)}))()}},r))},tl=function(e){var t=e.projectRef,n=e.connectionString,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,eZ.cp)({projectRef:t,connectionString:n,sql:"\n    select\n      s.oid as \"id\",\n      w.fdwname as \"name\",\n      s.srvname as \"server_name\",\n      s.srvoptions as \"server_options\",\n      c.proname as \"handler\",\n      (\n        select jsonb_agg(\n          jsonb_build_object(\n            'id', c.oid::bigint,\n            'schema', relnamespace::regnamespace::text,\n            'name', c.relname,\n            'columns', (\n              select jsonb_agg(\n                jsonb_build_object(\n                  'name', a.attname,\n                  'type', pg_catalog.format_type(a.atttypid, a.atttypmod)\n                )\n              )\n              from pg_catalog.pg_attribute a\n              where a.attrelid = c.oid and a.attnum > 0 and not a.attisdropped\n            ),\n            'options', t.ftoptions\n          )\n        )\n        from pg_catalog.pg_class c\n        join pg_catalog.pg_foreign_table t on c.oid = t.ftrelid\n        where c.oid = any (select t.ftrelid from pg_catalog.pg_foreign_table t where t.ftserver = s.oid)\n      ) as \"tables\"\n    from pg_catalog.pg_foreign_server s\n    join pg_catalog.pg_foreign_data_wrapper w on s.srvfdw = w.oid\n    join pg_catalog.pg_proc c on w.fdwhandler = c.oid;\n  ",queryKey:["fdws"]},r)};function td(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?td(Object(n),!0).forEach(function(t){(0,et.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):td(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var tp=(0,i.Pi)(function(){var e,t,n,r="edit-wrapper-form",i=(0,ey.useRouter)(),c=(0,eg.NL)(),d=(0,w.oR)(),p=d.ui,m=d.vault,f=(0,ef.UO)(),h=f.ref,v=f.id,j=(0,C.d2)().project,g=tl({projectRef:null==j?void 0:j.ref,connectionString:null==j?void 0:j.connectionString}),y=g.data,N=g.isLoading,Z=(null!==(t=null==y?void 0:y.result)&&void 0!==t?t:[]).find(function(e){return Number(e.id)===Number(v)}),S=(0,w.Je)(Z),_=eV.find(function(e){return e.handlerName===(null==S?void 0:S.handler)}),P=tc({onSuccess:function(){p.setNotification({category:"success",message:"Successfully updated ".concat(null==_?void 0:_.label," foreign data wrapper")}),z([]),F.some(function(e){return e.is_new_schema})&&(0,E.XL)(c,h),i.push("/project/".concat(h,"/database/wrappers"))}}),D=P.mutate,T=P.isLoading,R=(0,o.useState)([]),F=R[0],z=R[1],A=(0,o.useState)(!1),V=A[0],L=A[1],q=(0,o.useState)(),M=q[0],U=q[1],B=(0,o.useState)({}),H=B[0],Q=B[1],K=(0,w.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"wrappers"),G=void 0!==_?tu({wrapper_name:null==S?void 0:S.name,server_name:null==S?void 0:S.server_name},Object.fromEntries((null!==(n=null==S?void 0:S.server_options)&&void 0!==n?n:[]).map(function(e){return e.split("=")}))):{};if((0,o.useEffect)(function(){null!=S&&S.id&&z(eY(S,_))},[null==S?void 0:S.id]),N)return(0,O.jsx)("div",{className:"flex items-center justify-center w-full h-full",children:(0,O.jsx)(e7.Z,{})});if(void 0===S||void 0===_)return T?(0,O.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-full space-y-4",children:(0,O.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,O.jsx)(eT.Z,{className:"animate-spin",size:16}),(0,O.jsx)("p",{className:"text-sm",children:"Updating wrapper"})]})}):(0,O.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-full space-y-4",children:[(0,O.jsxs)("div",{className:"space-y-2 flex flex-col items-center w-[400px]",children:[(0,O.jsx)("p",{children:"Unknown wrapper"}),(0,O.jsxs)("p",{className:"text-sm text-center text-foreground-light",children:["The wrapper ID ",v," cannot be found in your project. Head back to select another wrapper."]})]}),(0,O.jsx)(l.z,{asChild:!0,type:"default",children:(0,O.jsx)(eu(),{href:"/project/".concat(h,"/database/wrappers"),children:"Head back"})})]});var J=(e=(0,I.Z)(W().mark(function e(t){var n,r;return W().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=eq(_.server.options)(t),0===(r=t.wrapper_name).length&&(n.name="Please provide a name for your wrapper"),0===F.length&&(n.tables="Please add at least one table"),(0,s.isEmpty)(n)){e.next=7;break}return e.abrupt("return",Q(n));case 7:D({projectRef:null==j?void 0:j.ref,connectionString:null==j?void 0:j.connectionString,wrapper:S,wrapperMeta:_,formState:tu(tu({},t),{},{server_name:"".concat(r,"_server")}),tables:F});case 8:case"end":return e.stop()}},e)})),function(t){return e.apply(this,arguments)});return(0,O.jsxs)(Y.ld,{children:[(0,O.jsxs)("div",{children:[(0,O.jsxs)("div",{className:"relative flex items-center justify-between mb-6",children:[(0,O.jsx)("div",{className:"transition cursor-pointer absolute -left-20 top-1 opacity-75 hover:opacity-100",children:(0,O.jsx)(eu(),{href:"/project/".concat(h,"/database/wrappers"),children:(0,O.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,O.jsx)(eD.Z,{strokeWidth:1.5,size:14}),(0,O.jsx)("p",{className:"text-sm",children:"Back"})]})})}),(0,O.jsxs)("h3",{className:"mb-2 text-xl text-foreground",children:["Edit wrapper: ",S.name]}),(0,O.jsx)("div",{className:"flex items-center space-x-2",children:(0,O.jsx)(l.z,{asChild:!0,type:"default",icon:(0,O.jsx)(em.Z,{strokeWidth:1.5}),children:(0,O.jsx)(eu(),{href:"https://supabase.github.io/wrappers/stripe/",target:"_blank",rel:"noreferrer",children:"Documentation"})})})]}),(0,O.jsx)(X.Z,{id:r,initialValues:G,onSubmit:J,children:function(e){var t,n=e.handleReset,a=e.values,s=e.initialValues,i=e.resetForm,c=(0,o.useState)(!1),d=c[0],p=c[1],f=eY(null!==(t=null==S?void 0:S.tables)&&void 0!==t?t:[]),h=JSON.stringify(a)!==JSON.stringify(s),v=JSON.stringify(f)!==JSON.stringify(F),j=_.server.options.filter(function(e){return e.encrypted});return(0,o.useEffect)(function(){var e,t=(e=(0,I.Z)(W().mark(function e(){var t;return W().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return p(!0),e.next=3,Promise.all(j.map(function(){var e=(0,I.Z)(W().mark(function e(t){var n,r,a;return W().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=m.listSecrets(function(e){return e.name==="".concat(S.name,"_").concat(t.name)}),!(void 0!==(r=(0,k.Z)(n,1)[0]))){e.next=8;break}return e.next=4,m.fetchSecretValue(r.id);case 4:return a=e.sent,e.abrupt("return",(0,et.Z)({},t.name,a));case 8:return e.abrupt("return",(0,et.Z)({},t.name,""));case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 3:t=e.sent.reduce(function(e,t){var n=Object.keys(t),r=(0,k.Z)(n,1)[0];return tu(tu({},e),{},(0,et.Z)({},r,t[r]))},{}),i({values:tu(tu({},a),t),initialValues:tu(tu({},s),t)}),p(!1);case 7:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)});j.length>0&&t()},[]),(0,O.jsxs)(Y.by,{disabled:!K,footer:(0,O.jsx)("div",{className:"flex px-8 py-4",children:(0,O.jsx)(Y.iN,{form:r,isSubmitting:T,hasChanges:h||v,handleReset:function(){n(),z(f)},disabled:!K,helper:K?void 0:"You need additional permissions to edit a foreign data wrapper"})}),children:[(0,O.jsx)(Y.hj,{header:(0,O.jsx)(Y.S0,{children:"Wrapper Configuration"}),children:(0,O.jsx)(Y.B4,{loading:!1,children:(0,O.jsx)(u.Z,{id:"wrapper_name",label:"Wrapper Name",error:H.wrapper_name,descriptionText:a.wrapper_name!==s.wrapper_name?(0,O.jsxs)(O.Fragment,{children:["Your wrapper's server name will be updated to"," ",(0,O.jsxs)("code",{className:"text-xs",children:[a.wrapper_name,"_server"]})]}):(0,O.jsxs)(O.Fragment,{children:["Your wrapper's server name is"," ",(0,O.jsxs)("code",{className:"text-xs",children:[a.wrapper_name,"_server"]})]})})})}),(0,O.jsx)(Y.hj,{header:(0,O.jsxs)(Y.S0,{children:[_.label," Configuration"]}),children:(0,O.jsx)(Y.B4,{loading:!1,children:_.server.options.map(function(e){return(0,O.jsx)(ez,{option:e,loading:!!e.encrypted&&d,error:H[e.name]},e.name)})})}),(0,O.jsx)(Y.hj,{header:(0,O.jsxs)(Y.S0,{children:[(0,O.jsx)("p",{children:"Foreign Tables"}),(0,O.jsx)("p",{className:"text-foreground-light mt-2 w-[90%]",children:"You can query your data from these foreign tables after the wrapper is created"})]}),children:(0,O.jsxs)(Y.B4,{loading:!1,children:[0===F.length?(0,O.jsx)("div",{className:"flex justify-end translate-y-4",children:(0,O.jsx)(l.z,{type:"default",onClick:function(){return L(!0)},children:"Add foreign table"})}):(0,O.jsx)("div",{className:"space-y-2",children:F.map(function(e,t){var n=_.tables[e.index].label;return(0,O.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 border rounded-md border-control",children:[(0,O.jsxs)("div",{children:[(0,O.jsxs)("p",{className:"text-sm",children:[e.schema_name,".",e.table_name]}),(0,O.jsxs)("p",{className:"text-sm text-foreground-light",children:[n,":"," ",e.columns.map(function(e){return e.name}).join(", ")]})]}),(0,O.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,O.jsx)(l.z,{type:"default",className:"px-1",icon:(0,O.jsx)(x.Z,{}),onClick:function(){L(!0),U(tu(tu({},e),{},{tableIndex:t}))}}),(0,O.jsx)(l.z,{type:"default",className:"px-1",icon:(0,O.jsx)(b.Z,{}),onClick:function(){z(function(e){return e.filter(function(e,n){return n!==t})})}})]})]},"".concat(e.schema_name,".").concat(e.table_name))})}),F.length>0&&(0,O.jsx)("div",{className:"flex justify-end",children:(0,O.jsx)(l.z,{type:"default",onClick:function(){return L(!0)},children:"Add foreign table"})}),0===F.length&&H.tables&&(0,O.jsx)("p",{className:"text-sm text-right text-red-900",children:H.tables})]})})]})}})]}),(0,O.jsx)(e2,{visible:V,tables:_.tables,onCancel:function(){U(void 0),L(!1)},onSave:function(e){z(function(t){if(void 0!==e.tableIndex){var n=e.tableIndex,r=(0,ej.Z)(t);return delete e.tableIndex,r[n]=e,r}return[].concat((0,ej.Z)(t),[e])}),L(!1),U(void 0)},initialData:M})]})}),tm=function(e){var t,n=e.selectedWrapper,r=e.onClose,a=(0,w.oR)().ui,s=(0,C.d2)().project,i=tr({onSuccess:function(){a.setNotification({category:"success",message:"Successfully disabled ".concat(null==n?void 0:n.name," foreign data wrapper")}),r()}}),o=i.mutate,c=i.isLoading,l=eV.find(function(e){return e.handlerName===(null==n?void 0:n.handler)}),d=(t=(0,I.Z)(W().mark(function e(){return W().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=s&&s.ref){e.next=2;break}return e.abrupt("return",console.error("Project ref is required"));case 2:if(n){e.next=4;break}return e.abrupt("return",console.error("Wrapper is required"));case 4:if(l){e.next=6;break}return e.abrupt("return",console.error("Wrapper meta is required"));case 6:o({projectRef:null==s?void 0:s.ref,connectionString:null==s?void 0:s.connectionString,wrapper:n,wrapperMeta:l});case 7:case"end":return e.stop()}},e)})),function(){return t.apply(this,arguments)});return(0,O.jsx)($.C,{size:"medium",alignFooter:"right",loading:c,visible:void 0!==n,onCancel:function(){return r()},onConfirm:function(){return d()},header:"Confirm to disable ".concat(null==n?void 0:n.name),children:(0,O.jsx)("div",{className:"py-4",children:(0,O.jsx)($.C.Content,{children:(0,O.jsxs)("p",{className:"text-sm",children:["Are you sure you want to disable ",null==n?void 0:n.name,"? This will also remove all tables created with this wrapper."]})})})})},tf=n(38421),th=n.n(tf),tx=function(e){var t=e.wrappers,n=void 0===t?[]:t,i=e.wrapperMeta,o=e.isOpen,c=e.onOpen,d=e.onSelectDelete,u=(0,ef.UO)().ref,p=(0,w.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"wrappers");return(0,O.jsx)(O.Fragment,{children:(0,O.jsxs)(er.ZP,{open:o,onOpenChange:function(){return c(i.name)},className:"bg-surface-100 hover:bg-overlay-hover data-open:bg-selection border-default hover:border-strong data-open:border-strong col-span-12 mx-auto -space-y-px overflow-hidden transition border shadow hover:z-50 first:rounded-tl first:rounded-tr first:!border-t last:rounded-bl last:rounded-br last:border-t-0",children:[(0,O.jsx)(er.ZP.Trigger,{asChild:!0,children:(0,O.jsxs)("button",{type:"button",className:"flex items-center justify-between w-full px-6 py-3 rounded group text-foreground",children:[(0,O.jsxs)("div",{className:"flex items-center gap-3",children:[(0,O.jsx)(ea.Z,{className:"transition text-border-stronger data-open-parent:rotate-0 data-closed-parent:rotate-180",strokeWidth:2,width:14}),(0,O.jsx)(th(),{src:i.icon,width:20,height:20,alt:"".concat(i.name," wrapper icon")}),(0,O.jsx)("span",{className:"text-sm capitalize",children:i.label})]}),(0,O.jsx)("div",{className:"flex items-center gap-3",children:(0,O.jsxs)("div",{className:"px-3 py-1 text-xs border rounded-md border-strong bg-surface-100 text-foreground",children:[n.length," wrapper",n.length>1?"s":""]})})]})}),(0,O.jsx)(er.ZP.Content,{children:(0,O.jsx)("div",{className:"border-t group border-strong bg-surface-100 text-foreground divide-y",children:n.map(function(e){var t=Object.fromEntries(e.server_options.map(function(e){return e.split("=")})),n=(0,s.partition)(i.server.options,"hidden"),a=(0,k.Z)(n,2),o=a[0],c=a[1];return(0,O.jsxs)("div",{className:"px-6 py-4 flex items-center justify-between",children:[(0,O.jsxs)("div",{className:"space-y-1 w-3/4",children:[(0,O.jsx)("div",{className:"flex items-center space-x-2",children:(0,O.jsx)("p",{className:"text-base",children:e.name})}),c.map(function(e){return(0,O.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-foreground-light",children:[(0,O.jsxs)("p",{children:[e.label,":"]}),(0,O.jsx)("p",{children:t[e.name]})]},e.name)}),o.map(function(t){return(0,O.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,O.jsxs)("p",{className:"text-foreground-light",children:[t.label,":"]}),(0,O.jsxs)(eu(),{href:"/project/".concat(u,"/settings/vault/secrets?search=").concat(e.name,"_").concat(t.name),className:"transition text-foreground-light hover:text-foreground flex items-center space-x-2",children:[(0,O.jsx)("span",{children:"Encrypted in Vault"}),(0,O.jsx)(em.Z,{size:14,strokeWidth:1.5})]})]},t.name)}),(0,O.jsxs)("div",{className:"!mt-3 space-y-1",children:[(0,O.jsxs)("p",{className:"text-sm text-foreground-light",children:["Foreign tables",e.tables&&": (".concat(e.tables.length,")")]}),(0,O.jsx)("div",{className:"flex flex-wrap gap-2",children:e.tables?e.tables.map(function(e){return(0,O.jsx)(eu(),{href:"/project/".concat(u,"/editor/").concat(e.id),children:(0,O.jsx)("div",{className:"text-sm border rounded px-2 py-1 transition bg-surface-200 hover:bg-overlay-hover",children:e.name})},e.id)}):(0,O.jsx)("p",{className:"text-sm text-foreground-light",children:"No tables available"})})]})]}),(0,O.jsxs)("div",{className:"flex items-center space-x-2",children:[p?(0,O.jsx)(eu(),{href:"/project/".concat(u,"/database/wrappers/").concat(e.id),children:(0,O.jsx)(l.z,{type:"default",icon:(0,O.jsx)(x.Z,{strokeWidth:1.5}),className:"py-2"})}):(0,O.jsxs)(r.fC,{delayDuration:0,children:[(0,O.jsx)(r.xz,{children:(0,O.jsx)(l.z,{type:"default",disabled:!0,icon:(0,O.jsx)(x.Z,{strokeWidth:1.5}),className:"py-2"})}),!p&&(0,O.jsx)(r.h_,{children:(0,O.jsxs)(r.VY,{side:"bottom",children:[(0,O.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,O.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,O.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to edit wrappers"})})]})})]}),(0,O.jsxs)(r.fC,{delayDuration:0,children:[(0,O.jsx)(r.xz,{children:(0,O.jsx)(l.z,{type:"default",disabled:!p,icon:(0,O.jsx)(b.Z,{strokeWidth:1.5}),className:"py-2",onClick:function(){return d(e)}})}),!p&&(0,O.jsx)(r.h_,{children:(0,O.jsxs)(r.VY,{side:"bottom",children:[(0,O.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,O.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,O.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to add wrappers"})})]})})]})]})]},e.id)})})})]})})},tb=n(38617),tv=(0,i.Pi)(function(){var e,t=(0,w.oR)(),n=t.ui,s=t.meta,i=(0,ef.UO)().ref,c=(0,tb.F)().resolvedTheme,d=s.extensions.byId("wrappers"),u=s.extensions.byId("supabase_vault"),p=void 0===d||void 0===u,m=(0,o.useState)(!1),f=m[0],h=m[1],x=(0,w.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"extensions"),b=(e=(0,I.Z)(W().mark(function e(){var t,r,a;return W().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(void 0===d||void 0===u)){e.next=2;break}return e.abrupt("return");case 2:return h(!0),e.t0=Promise,e.next=6,s.extensions.create({schema:null!==(t=d.schema)&&void 0!==t?t:"extensions",name:d.name,version:d.default_version,cascade:!0});case 6:return e.t1=e.sent,e.next=9,s.extensions.create({schema:null!==(r=u.schema)&&void 0!==r?r:"vault",name:u.name,version:u.default_version,cascade:!0});case 9:return e.t2=e.sent,e.t3=[e.t1,e.t2],e.next=13,e.t0.all.call(e.t0,e.t3);case 13:(a=e.sent.filter(function(e){return e.error&&!e.error.message.includes("already exists")})).length>0?n.setNotification({error:a,category:"error",message:"Failed to enable Wrappers for your project: ".concat(a.map(function(e){return e.message}).join(", "))}):n.setNotification({category:"success",message:"Wrappers is now enabled for your project!"}),h(!1);case 17:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)});return(0,O.jsx)("div",{children:(0,O.jsx)("div",{className:"w-full px-12 py-12 bg-no-repeat border rounded bg-background border-default",style:{backgroundSize:"45%",backgroundPosition:"105% 40%",backgroundImage:null!=c&&c.includes("dark")?'url("'.concat(eA.GW,'/img/wrappers-dark.png")'):'url("'.concat(eA.GW,'/img/wrappers-light.png")')},children:(0,O.jsxs)("div",{className:"w-3/5 space-y-8",children:[(0,O.jsxs)("div",{className:"space-y-2",children:[(0,O.jsx)("h4",{className:"text-lg",children:"Supabase Wrappers"}),(0,O.jsx)("p",{className:"text-sm text-foreground-light",children:"Supabase Wrappers is a framework for building Postgres Foreign Data Wrappers (FDW) which connect Postgres to external systems. Query your data warehouse or third-party APIs directly from your database."})]}),p?(0,O.jsxs)("div",{className:"space-y-4",children:[(0,O.jsxs)("div",{className:"rounded border border-default px-4 py-2 flex items-center justify-between",children:[(0,O.jsxs)("div",{children:[(0,O.jsx)("p",{className:"text-foreground-light text-sm",children:"Wrappers is not available for this project yet."}),(0,O.jsx)("p",{className:"text-foreground-light text-sm",children:"Do reach out to us if you're interested!"})]}),(0,O.jsx)("div",{children:(0,O.jsx)(l.z,{asChild:!0,type:"primary",children:(0,O.jsx)(eu(),{href:"/support/new?ref=".concat(i,"&category=sales&subject=Request%20for%20access%20to%20wrappers"),target:"_blank",rel:"noreferrer",children:"Contact us"})})})]}),(0,O.jsx)("div",{className:"flex items-center space-x-2 my-1 ml-[1px]",children:(0,O.jsx)(l.z,{asChild:!0,type:"default",icon:(0,O.jsx)(em.Z,{}),children:(0,O.jsx)(eu(),{href:"https://supabase.com/docs/guides/database/extensions/wrappers/overview",target:"_blank",rel:"noreferrer",children:"About Wrappers"})})})]}):(0,O.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,O.jsx)(l.z,{asChild:!0,type:"default",icon:(0,O.jsx)(em.Z,{}),children:(0,O.jsx)(eu(),{href:"https://supabase.com/docs/guides/database/extensions/wrappers/overview",target:"_blank",rel:"noreferrer",children:"About Wrappers"})}),(0,O.jsxs)(r.fC,{delayDuration:0,children:[(0,O.jsx)(r.xz,{children:(0,O.jsx)(l.z,{type:"primary",loading:f,disabled:p||f||!x,onClick:function(){return b()},children:"Enable Wrappers"})}),!x&&(0,O.jsx)(r.h_,{children:(0,O.jsxs)(r.VY,{side:"bottom",children:[(0,O.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,O.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,O.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to enable Wrappers for this project"})})]})})]})]})]})})})}),tj=(0,i.Pi)(function(e){var t=e.buttonText,n=void 0===t?"Add wrapper":t,s=e.align,i=(0,ef.UO)().ref;return(0,w.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"wrappers")?(0,O.jsxs)(f.h_,{children:[(0,O.jsx)(f.$F,{children:(0,O.jsx)(l.z,{type:"primary",icon:(0,O.jsx)(m.Z,{strokeWidth:1.5}),children:n})}),(0,O.jsx)(f.AW,{side:"bottom",align:void 0===s?"end":s,children:eV.map(function(e,t){return(0,O.jsxs)(o.Fragment,{children:[(0,O.jsx)(f.Xi,{className:"space-x-2",asChild:!0,children:(0,O.jsxs)(eu(),{href:"/project/".concat(i,"/database/wrappers/new?type=").concat(e.name.toLowerCase()),children:[(0,O.jsx)(th(),{src:e.icon,width:20,height:20,alt:"".concat(e.name," wrapper icon")}),(0,O.jsx)("p",{children:e.label})]})},e.name),t!==eV.length-1&&(0,O.jsx)(f.VD,{})]},t)})})]}):(0,O.jsxs)(r.fC,{delayDuration:0,children:[(0,O.jsx)(r.xz,{children:(0,O.jsx)(l.z,{disabled:!0,type:"primary",icon:(0,O.jsx)(m.Z,{strokeWidth:1.5}),children:n})}),(0,O.jsx)(r.h_,{children:(0,O.jsxs)(r.VY,{side:"bottom",children:[(0,O.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,O.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,O.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to add wrappers"})})]})})]})}),tg=(0,i.Pi)(function(){var e,t=(0,w.oR)().meta,n=(0,C.d2)().project,r=tl({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString}),a=r.data,i=r.isLoading,c=(0,o.useState)(""),d=c[0],u=c[1],p=(0,o.useState)(),m=p[0],f=p[1],h=null!==(e=null==a?void 0:a.result)&&void 0!==e?e:[],x=(0,s.groupBy)(h,"handler"),b=t.extensions.byId("wrappers"),v=t.extensions.byId("supabase_vault"),j=t.extensions.isLoading,g=void 0!==b&&null!==b.installed_version&&void 0!==v&&null!==v.installed_version;return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)("div",{children:[(0,O.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,O.jsxs)("div",{children:[(0,O.jsx)("h3",{className:"mb-1 text-xl text-foreground",children:"Foreign Data Wrappers"}),(0,O.jsx)("div",{className:"text-sm text-foreground-lighter",children:"Query your data warehouse directly from your database, or third-party APIs using SQL."})]}),(0,O.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,O.jsx)(l.z,{asChild:!0,type:"default",icon:(0,O.jsx)(em.Z,{strokeWidth:1.5}),children:(0,O.jsx)(eu(),{href:"https://supabase.com/docs/guides/database/extensions/wrappers/overview",target:"_blank",rel:"noreferrer",children:"Documentation"})}),g&&(0,O.jsx)(tj,{})]})]}),j||i?(0,O.jsx)("div",{className:"p-12 space-y-2 border rounded border-default",children:(0,O.jsx)(y.A,{})}):g?(0,O.jsx)("div",{children:0===h.length?(0,O.jsxs)("div",{className:"border rounded border-default px-20 py-16 flex flex-col items-center justify-center space-y-4",children:[(0,O.jsx)("p",{className:"text-sm",children:"No wrappers created yet"}),(0,O.jsx)(tj,{align:"center",buttonText:"Create a new wrapper"})]}):(0,O.jsx)(O.Fragment,{children:eV.map(function(e,t){var n,r=null!==(n=x[e.handlerName])&&void 0!==n?n:[];return r.length>0?(0,O.jsx)(tx,{wrapperMeta:e,wrappers:r,isOpen:d===e.name,onOpen:function(e){d!==e?u(e):u("")},onSelectDelete:f},t):null})})}):(0,O.jsx)(tv,{})]}),(0,O.jsx)(tm,{selectedWrapper:m,onClose:function(){return f(void 0)}})]})}),ty=n(13734),tw=(0,i.Pi)(function(e){var t,n=e.onSelectPublication,r=void 0===n?s.noop:n,i=(0,w.oR)(),c=i.ui,d=i.meta,m=(0,o.useState)(""),f=m[0],h=m[1],x=(0,w.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"publications"),b=[{event:"Insert",key:"publish_insert"},{event:"Update",key:"publish_update"},{event:"Delete",key:"publish_delete"},{event:"Truncate",key:"publish_truncate"}],v=0===f.length?d.publications.list():d.publications.list(function(e){return e.name.includes(f)}),g=(0,o.useState)(null),y=g[0],N=g[1],Z=(t=(0,I.Z)(W().mark(function e(){var t,n,r,a,s,i,o;return W().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(y){e.next=2;break}return e.abrupt("return");case 2:return t=y.publication,n=y.event,r=y.currentStatus,e.prev=3,(a={id:t.id})["publish_".concat(n.event.toLowerCase())]=!r,e.next=8,d.publications.update(t.id,a);case 8:if(i=(s=e.sent).data,!(o=s.error)){e.next=15;break}throw o;case 15:return N(null),e.abrupt("return",i);case 17:e.next=23;break;case 19:return e.prev=19,e.t0=e.catch(3),c.setNotification({category:"error",message:"Failed to toggle for ".concat(t.name,": ").concat(e.t0.message)}),e.abrupt("return",!1);case 23:case"end":return e.stop()}},e,null,[[3,19]])})),function(){return t.apply(this,arguments)});return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("div",{className:"mb-4",children:(0,O.jsxs)("div",{className:"flex items-center justify-between",children:[(0,O.jsx)("div",{className:"flex items-center",children:(0,O.jsx)(u.Z,{size:"small",icon:(0,O.jsx)(p.Z,{size:"tiny"}),placeholder:"Filter",value:f,onChange:function(e){return h(e.target.value)}})}),!x&&(0,O.jsx)("div",{className:"w-[500px]",children:(0,O.jsx)(eh.Z,{icon:(0,O.jsx)(ep.Z,{className:"text-foreground-light",strokeWidth:2}),title:"You need additional permissions to update database replications"})})]})}),0===v.length?(0,O.jsx)(M.Z,{searchString:f,onResetFilter:function(){return h("")}}):(0,O.jsx)("div",{className:"overflow-hidden rounded",children:(0,O.jsx)(j.Z,{head:[(0,O.jsx)(j.Z.th,{children:"Name"},"header.name"),(0,O.jsx)(j.Z.th,{className:"hidden lg:table-cell",children:"System ID"},"header.id"),(0,O.jsx)(j.Z.th,{children:"Insert"},"header.insert"),(0,O.jsx)(j.Z.th,{children:"Update"},"header.update"),(0,O.jsx)(j.Z.th,{children:"Delete"},"header.delete"),(0,O.jsx)(j.Z.th,{children:"Truncate"},"header.truncate"),(0,O.jsx)(j.Z.th,{className:"text-right",children:"Source"},"header.source")],body:v.map(function(e,t){return(0,O.jsxs)(j.Z.tr,{className:"border-t ",children:[(0,O.jsx)(j.Z.td,{className:"px-4 py-3",style:{width:"25%"},children:e.name}),(0,O.jsx)(j.Z.td,{className:"hidden lg:table-cell",style:{width:"25%"},children:e.id}),b.map(function(t){return(0,O.jsx)(j.Z.td,{children:(0,O.jsx)(H.Z,{size:"tiny",checked:e[t.key],disabled:!x,onChange:function(){N({publication:e,event:t,currentStatus:e[t.key]})}})},t.key)}),(0,O.jsx)(j.Z.td,{className:"px-4 py-3 pr-2",children:(0,O.jsx)("div",{className:"flex justify-end gap-2",children:(0,O.jsx)(l.z,{type:"default",style:{paddingTop:3,paddingBottom:3},onClick:function(){return r(e.id)},children:null==e.tables?"All tables":"".concat(e.tables.length," ").concat(e.tables.length>1||0==e.tables.length?"tables":"table")})})})]},e.name)})})}),(0,O.jsx)(ty.Z,{visible:null!==y,header:"Confirm",buttonLabel:"Confirm",onSelectCancel:function(){return N(null)},onSelectConfirm:function(){Z()},children:(0,O.jsx)($.C.Content,{children:(0,O.jsxs)("p",{className:"py-4 text-sm text-foreground-light",children:["Are you sure you want to ",null!=y&&y.currentStatus?"stop":"start"," ","sending ",null==y?void 0:y.event.event.toLowerCase()," events for"," ",null==y?void 0:y.publication.name,"?"]})})})]})}),tN=n(8888),tZ=(0,i.Pi)(function(e){var t,n,r=e.table,s=e.selectedPublication,i=(0,w.oR)(),c=i.ui,l=i.meta,d=null==s.tables,u=(0,o.useState)(!1),p=u[0],m=u[1],f=(0,o.useState)((null===(n=s.tables)||void 0===n?void 0:n.find(function(e){return e.id==r.id}))!=void 0),h=f[0],x=f[1],b=(0,w.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"publications"),v=(t=(0,I.Z)(W().mark(function e(t,n){var r,a,s,i,o,d,u;return W().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=h,x(!h),m(!0),i=(s=null!==(r=null==n?void 0:n.tables)&&void 0!==r?r:[]).some(function(e){return e.id==t.id})?s.filter(function(e){return e.id!=t.id}).map(function(e){return"".concat(e.schema,".").concat(e.name)}):["".concat(t.schema,".").concat(t.name)].concat(s.map(function(e){return"".concat(e.schema,".").concat(e.name)})),e.prev=6,d={tables:i,id:o=n.id},e.next=11,l.publications.update(o,d);case 11:if(!(u=e.sent.error)){e.next=15;break}throw u;case 15:m(!1),e.next=23;break;case 18:e.prev=18,e.t0=e.catch(6),c.setNotification({category:"error",message:"Failed to toggle replication for ".concat(t.name,": ").concat(e.t0.message)}),x(a),m(!1);case 23:case"end":return e.stop()}},e,null,[[6,18]])})),function(e,n){return t.apply(this,arguments)});return(0,O.jsxs)(j.Z.tr,{children:[(0,O.jsx)(j.Z.td,{className:"whitespace-nowrap",children:r.name}),(0,O.jsx)(j.Z.td,{className:"whitespace-nowrap",children:r.schema}),(0,O.jsx)(j.Z.td,{className:"hidden max-w-sm truncate whitespace-nowrap lg:table-cell",children:r.comment}),(0,O.jsx)(j.Z.td,{className:"px-4 py-3 pr-2",children:(0,O.jsx)("div",{className:"flex justify-end gap-2",children:d?(0,O.jsxs)(q.Z,{color:"scale",children:[(0,O.jsx)("span",{children:"Enabled"}),(0,O.jsx)("span",{className:"hidden lg:inline-block",children:"\xa0for all tables"})]}):(0,O.jsx)(H.Z,{size:"tiny",align:"right",disabled:!b||p,className:"m-0 ml-2 mt-1 -mb-1 p-0",checked:h,onChange:function(){return v(r,s)}})})})]},r.id)}),tS=function(e){var t=e.selectedPublication,n=e.onSelectBack,r=(0,C.d2)().project,s=(0,o.useState)(""),i=s[0],c=s[1],m=(0,w.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"publications"),f=(0,D.Bj)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString},{select:function(e){return e.filter(function(e){return 0===i.length?!Z.F.includes(e.schema):!Z.F.includes(e.schema)&&e.name.includes(i)})}}),h=f.data,x=f.isLoading,b=f.isSuccess,y=f.isError,N=f.error;return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("div",{className:"mb-4",children:(0,O.jsxs)("div",{className:"flex items-center justify-between",children:[(0,O.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,O.jsx)(l.z,{type:"outline",onClick:function(){return n()},icon:(0,O.jsx)(d.Z,{}),style:{padding:"5px"}}),(0,O.jsx)("div",{children:(0,O.jsx)(u.Z,{size:"small",placeholder:"Filter",value:i,onChange:function(e){return c(e.target.value)},icon:(0,O.jsx)(p.Z,{size:"tiny"})})})]}),!m&&(0,O.jsx)("div",{className:"w-[500px]",children:(0,O.jsx)(eh.Z,{icon:(0,O.jsx)(ep.Z,{className:"text-foreground-light",strokeWidth:2}),title:"You need additional permissions to update database replications"})})]})}),x&&(0,O.jsx)("div",{className:"mt-8",children:(0,O.jsx)(tN.Z,{})}),y&&(0,O.jsx)(g.Z,{error:N,subject:"Failed to retrieve tables"}),b&&(0===h.length?(0,O.jsx)(v.Z,{}):(0,O.jsx)("div",{children:(0,O.jsx)(j.Z,{head:[(0,O.jsx)(j.Z.th,{children:"Name"},"header-name"),(0,O.jsx)(j.Z.th,{children:"Schema"},"header-schema"),(0,O.jsx)(j.Z.th,{className:"hidden text-left lg:table-cell",children:"Description"},"header-desc"),(0,O.jsx)(j.Z.th,{},"header-all")],body:h.map(function(e,n){return(0,O.jsx)(tZ,{table:e,selectedPublication:t},e.id)})})}))]})},tO=n(28879),t_=n.n(tO),tk=n(80717),tC=n(45008),tP=n(72047),tE=n(81229),tD=["onSuccess","onError"];function tT(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tR(){return(tR=(0,I.Z)(W().mark(function e(t){var n,r,a,s,i,o,c,l;return W().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.ref,!(r=t.backup).isPhysicalBackup){e.next=10;break}return e.next=4,(0,tE.v_)("/platform/database/{ref}/backups/restore-physical",{params:{path:{ref:n}},body:{id:r.id,recovery_time_target:r.inserted_at}});case 4:if(s=(a=e.sent).data,!(i=a.error)){e.next=9;break}throw i;case 9:return e.abrupt("return",s);case 10:return e.next=12,(0,tE.v_)("/platform/database/{ref}/backups/restore",{params:{path:{ref:n}},body:{id:r.id}});case 12:if(c=(o=e.sent).data,!(l=o.error)){e.next=17;break}throw l;case 17:return e.abrupt("return",c);case 18:case"end":return e.stop()}},e)}))).apply(this,arguments)}var tF=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onSuccess,n=e.onError,r=(0,en.Z)(e,tD);return(0,ew.D)(function(e){return function(e){return tR.apply(this,arguments)}(e)},function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tT(Object(n),!0).forEach(function(t){(0,et.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tT(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({onSuccess:function(e,n,r){return(0,I.Z)(W().mark(function a(){return W().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,null==t?void 0:t(e,n,r);case 2:case"end":return a.stop()}},a)}))()},onError:function(e,t,r){return(0,I.Z)(W().mark(function a(){return W().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:void 0===n?eN.Am.error("Failed to restore from backup: ".concat(e.message)):n(e,t,r);case 1:case"end":return a.stop()}},a)}))()}},r))},tz=n(79923),tA=n(29298),tI=n(28208),tV=["onSuccess","onError"];function tL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tW(){return(tW=(0,I.Z)(W().mark(function e(t){var n,r,a,s,i;return W().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.ref,r=t.backup,e.next=3,(0,tE.v_)("/platform/database/{ref}/backups/download",{params:{path:{ref:n}},body:{id:r.id,inserted_at:r.inserted_at,project_id:r.project_id,data:{},s3_bucket:"deprecated",s3_path:"deprecated",status:"deprecated"}});case 3:if(s=(a=e.sent).data,!(i=a.error)){e.next=8;break}throw i;case 8:return e.abrupt("return",s);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}var tq=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onSuccess,n=e.onError,r=(0,en.Z)(e,tV);return(0,ew.D)(function(e){return function(e){return tW.apply(this,arguments)}(e)},function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tL(Object(n),!0).forEach(function(t){(0,et.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tL(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({onSuccess:function(e,n,r){return(0,I.Z)(W().mark(function a(){return W().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,null==t?void 0:t(e,n,r);case 2:case"end":return a.stop()}},a)}))()},onError:function(e,t,r){return(0,I.Z)(W().mark(function a(){return W().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:void 0===n?eN.Am.error("Failed to download backup: ".concat(e.message)):n(e,t,r);case 1:case"end":return a.stop()}},a)}))()}},r))},tY=function(e){var t=e.index,n=e.isHealthy,r=e.backup,s=e.projectRef,i=e.onSelectBackup,o=(0,w.Xo)(a.KA.INFRA_EXECUTE,"queue_job.restore.prepare"),c=tq({onSuccess:function(e){var t=e.fileUrl,n=document.createElement("a");n.href=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)}}),d=c.mutate,u=c.isLoading;return(0,O.jsxs)("div",{className:"flex h-12 items-center justify-between px-6 ".concat(t?"border-t border-default":""),children:[(0,O.jsx)("p",{className:"text-sm text-foreground ",children:"COMPLETED"==r.status?"".concat(t_()(r.inserted_at).format("DD MMM YYYY HH:mm:ss")," UTC"):t_()(r.inserted_at).format("DD MMM YYYY")}),(0,O.jsx)("div",{className:"",children:"COMPLETED"===r.status?(0,O.jsxs)("div",{className:"flex space-x-4",children:[(0,O.jsx)(l.z,{type:"default",disabled:!n||!o,onClick:i,children:"Restore"}),!r.isPhysicalBackup&&(0,O.jsx)(l.z,{type:"default",disabled:!o||u,onClick:function(){return d({ref:s,backup:r})},loading:u,icon:(0,O.jsx)(tI.Z,{}),children:"Download"})]}):(0,O.jsx)(q.Z,{color:"yellow",children:"Backup In Progress..."})})]})},tM=n(41993),tU=(0,i.Pi)(function(){var e,t,n=(0,w.oR)().ui,r=(0,ey.useRouter)(),s=(0,eg.NL)(),i=(0,w.lL)(),c=(0,C.d2)().project,l=(null==c?void 0:c.ref)||"default",d=(null==c?void 0:c.status)===eA.S.ACTIVE_HEALTHY,u=(0,o.useState)(),p=u[0],m=u[1],f=(0,w.Xo)(a.KA.INFRA_EXECUTE,"queue_job.restore.prepare"),h=(0,tz.T)({projectRef:l}).data,x=tF({onSuccess:function(){setTimeout(function(){(0,tA.k7)(s,l,eA.S.RESTORING),n.setNotification({category:"success",message:"Restoring database back to ".concat(t_()(null==p?void 0:p.inserted_at).format("DD MMM YYYY HH:mm:ss"))}),r.push("/project/".concat(l))},3e3)}}),b=x.mutate,v=x.isLoading,j=x.isSuccess,g=null!==(e=null==h?void 0:h.tierKey)&&void 0!==e?e:"",y=(null!==(t=null==h?void 0:h.backups)&&void 0!==t?t:[]).sort(function(e,t){return new Date(t.inserted_at).valueOf()-new Date(e.inserted_at).valueOf()}),N=null==h?void 0:h.pitr_enabled;return"FREE"===g?(0,O.jsx)(tP.Z,{icon:(0,O.jsx)(tk.Z,{size:"large"}),primaryText:"Free Plan does not include project backups.",projectRef:l,organizationSlug:i.slug,secondaryText:"Upgrade to the Pro plan for up to 7 days of scheduled backups.",addon:"pitr"}):N?null:(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("div",{className:"space-y-6",children:0===y.length&&"FREE"!==g?(0,O.jsx)(tM.Z,{}):(0,O.jsxs)(O.Fragment,{children:[!f&&(0,O.jsx)(eh.Z,{icon:(0,O.jsx)(ep.Z,{className:"text-foreground-light",strokeWidth:2}),title:"You need additional permissions to trigger a scheduled backup"}),(0,O.jsx)(tC.Z,{children:null==y?void 0:y.map(function(e,t){return(0,O.jsx)(tY,{backup:e,projectRef:l,index:t,isHealthy:d,onSelectBackup:function(){return m(e)}},e.id)})})]})}),(0,O.jsx)(ty.Z,{size:"medium",buttonLabel:"Confirm restore",buttonLoadingLabel:"Restoring",visible:void 0!==p,header:"Confirm to restore from backup",loading:v||j,onSelectCancel:function(){return m(void 0)},onSelectConfirm:function(){if(void 0===p)return console.error("Backup required");b({ref:l,backup:p})},children:(0,O.jsx)($.C.Content,{children:(0,O.jsx)("div",{className:"pt-6 pb-5",children:(0,O.jsxs)("p",{children:["Are you sure you want to restore from",t_()(null==p?void 0:p.inserted_at).format("DD MMM YYYY"),"? This will destroy any new data written since this backup was made."]})})})})]})});n(94035);var tB=n(96412),tX=n(13089),tH=n(80075),tQ=n(38183),tK=function(e){var t=e.icon,n=e.text;return(0,O.jsxs)("div",{className:"flex items-center justify-center flex-row py-4 space-x-2",children:[(0,O.jsx)("div",{className:"relative bg-surface-100 text-foreground-lighter w-6 h-6 rounded-full flex items-center justify-center",children:t}),(0,O.jsx)("p",{className:"text-foreground-light",children:n})]})},tG=n(94542),tJ=n(41503),t$=n(72637),t0=n(46916),t1=n(12223);function t2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var t3=function(e){return(0,O.jsx)(t1.Z,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?t2(Object(n),!0).forEach(function(t){(0,et.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t2(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({icon:t0.Z},e))},t4=n(92198),t5=n(86263),t6=n(85577),t8=n(33869),t7=n(77740),t9=function(){function e(){(0,tB.Z)(this,e),(0,et.Z)(this,"triggerFunctions",[])}return(0,tX.Z)(e,[{key:"functionSchemas",get:function(){return(0,s.map)((0,s.uniqBy)(this.triggerFunctions,"schema"),"schema")}}]),e}(),ne=(0,o.createContext)(null),nt=(0,i.Pi)(function(e){var t=e.triggerFunctions,n=e.visible,r=e.onChange,a=e.setVisible,s=(0,i.fv)(function(){return new t9});function o(e){r(e),a(!n)}s.triggerFunctions=t;var c=s.triggerFunctions.length>=1;return(0,O.jsx)(B.ZP,{size:"large",header:"Pick a function",visible:n,onCancel:function(){return a(!n)},className:"hooks-sidepanel",children:(0,O.jsx)("div",{className:"py-6",children:c?(0,O.jsx)(ne.Provider,{value:s,children:(0,O.jsxs)("div",{className:"space-y-6",children:[(0,O.jsx)(nn,{}),s.functionSchemas.map(function(e){return(0,O.jsx)(na,{schema:e,selectFunction:o},e)})]})}):(0,O.jsx)(nr,{})})})}),nn=function(e){(0,V.Z)(e);var t=(0,ey.useRouter)(),n=t.query.ref;return(0,O.jsx)("div",{className:"px-6",children:(0,O.jsx)(eh.Z,{icon:(0,O.jsx)(Q.Z,{size:"large",strokeWidth:1.5}),title:"Only functions that return a trigger will be displayed below",description:"You can make functions by using the Database Functions",button:(0,O.jsx)(l.z,{type:"default",onClick:function(){t.push("/project/".concat(n,"/database/functions"))},children:"Go to Functions"})})})},nr=function(e){(0,V.Z)(e);var t=(0,ey.useRouter)(),n=t.query.ref;return(0,O.jsx)(t6.Z,{title:"No Trigger Functions found in database",ctaButtonLabel:"Create a trigger function",onClickCta:function(){t.push("/project/".concat(n,"/database/functions"))},children:(0,O.jsx)("p",{className:"text-sm text-foreground-light",children:"You will need to create a trigger based function before you can add it to your trigger."})})},na=(0,i.Pi)(function(e){var t=e.schema,n=e.selectFunction,r=(0,o.useContext)(ne).triggerFunctions.filter(function(e){return e.schema==t});return(0,O.jsxs)("div",{className:"space-y-4",children:[(0,O.jsxs)("div",{className:"sticky top-0 flex items-center space-x-1 px-6 backdrop-blur backdrop-filter",children:[(0,O.jsx)("h5",{className:"text-foreground-light",children:"schema"}),(0,O.jsx)("h5",{children:t})]}),(0,O.jsx)("div",{className:"space-y-0 divide-y border-t border-b border-default",children:r.map(function(e){return(0,O.jsx)(ns,{id:e.id,completeStatement:e.complete_statement,name:e.name,onClick:n},e.id)})})]})}),ns=function(e){var t=e.id,n=e.completeStatement,r=e.name,a=e.onClick,s=(0,o.useState)(!1),i=s[0],c=s[1];return(0,O.jsxs)("div",{className:"cursor-pointer rounded p-3 px-6 hover:bg-background",onClick:function(){return a(t)},children:[(0,O.jsxs)("div",{className:"flex items-center justify-between space-x-3",children:[(0,O.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,O.jsx)("div",{className:"flex items-center justify-center rounded bg-foreground p-1 text-background",children:(0,O.jsx)(t4.Z,{strokeWidth:2,size:14})}),(0,O.jsx)("p",{className:"mb-0 text-sm",children:r})]}),(0,O.jsx)(l.z,{type:"text",onClick:function(e){e.stopPropagation(),c(!i)},icon:(0,O.jsx)(t7.Z,{className:i?"rotate-180 transform":"rotate-0 transform"}),children:i?"Hide definition":"View definition"})]}),(0,O.jsx)(t5.u,{show:i,enter:"transition ease-out duration-300",enterFrom:"transform opacity-0",enterTo:"transform opacity-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100",leaveTo:"transform opacity-0",children:(0,O.jsx)("div",{className:"mt-4 h-64 border border-default",children:(0,O.jsx)(t8.Z,{defaultValue:n,readOnly:!0,contextmenu:!1})})})]})};function ni(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function no(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ni(Object(n),!0).forEach(function(t){(0,et.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ni(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var nc=function(){function e(){(0,tB.Z)(this,e),(0,et.Z)(this,"id",void 0),(0,et.Z)(this,"originalName",void 0),(0,et.Z)(this,"activation",void 0),(0,et.Z)(this,"enabledMode",void 0),(0,et.Z)(this,"events",void 0),(0,et.Z)(this,"functionName",void 0),(0,et.Z)(this,"functionSchema",void 0),(0,et.Z)(this,"orientation",void 0),(0,et.Z)(this,"name",void 0),(0,et.Z)(this,"schema",void 0),(0,et.Z)(this,"table",void 0),(0,et.Z)(this,"tableId",void 0),(0,tH.ky)(this),this.reset()}return(0,tX.Z)(e,[{key:"requestBody",get:function(){return{id:this.id,activation:this.activation.value,enabled_mode:this.enabledMode.value,events:this.events.value,function_name:this.functionName.value,function_schema:this.functionSchema.value,orientation:this.orientation.value,name:this.name.value,schema:this.schema.value,table:this.table.value}}},{key:"reset",value:function(e){var t,n,r,a,s,i,o,c,l,d;this.id=null==e?void 0:e.id,this.originalName=null==e?void 0:e.name,this.activation={value:null!==(t=null==e?void 0:e.activation)&&void 0!==t?t:"BEFORE"},this.enabledMode={value:null!==(n=null==e?void 0:e.enabled_mode)&&void 0!==n?n:"ORIGIN"},this.events={value:null!==(r=null==e?void 0:e.events)&&void 0!==r?r:[]},this.functionName={value:null!==(a=null==e?void 0:e.function_name)&&void 0!==a?a:""},this.functionSchema={value:null!==(s=null==e?void 0:e.function_schema)&&void 0!==s?s:""},this.orientation={value:null!==(i=null==e?void 0:e.orientation)&&void 0!==i?i:"STATEMENT"},this.name={value:null!==(o=null==e?void 0:e.name)&&void 0!==o?o:""},this.schema={value:null!==(c=null==e?void 0:e.schema)&&void 0!==c?c:""},this.table={value:null!==(l=null==e?void 0:e.table)&&void 0!==l?l:""},this.tableId={value:null!==(d=null==e?void 0:e.table_id)&&void 0!==d?d:""}}},{key:"update",value:function(e){this.activation=e.activation,this.enabledMode=e.enabledMode,this.events=e.events,this.functionName=e.functionName,this.functionSchema=e.functionSchema,this.orientation=e.orientation,this.name=e.name,this.schema=e.schema,this.table=e.table,this.tableId=e.tableId}}]),e}(),nl=function(){function e(){var t=this;(0,tB.Z)(this,e),(0,et.Z)(this,"chooseFunctionFormVisible",!1),(0,et.Z)(this,"loading",!1),(0,et.Z)(this,"formState",new nc),(0,et.Z)(this,"meta",null),(0,et.Z)(this,"tables",[]),(0,et.Z)(this,"triggerFunctions",[]),(0,et.Z)(this,"isDirty",!1),(0,et.Z)(this,"setChooseFunctionFormVisible",function(e){t.chooseFunctionFormVisible=e}),(0,et.Z)(this,"setDefaultSelectedTable",function(){var e;(null===(e=t.tables)||void 0===e?void 0:e.length)!=0&&(t.formState.table.value=t.tables[0].name,t.formState.schema.value=t.tables[0].schema,t.formState.tableId.value=t.tables[0].id)}),(0,et.Z)(this,"setLoading",function(e){t.loading=e}),(0,et.Z)(this,"setisDirty",function(e){t.isDirty=e}),(0,et.Z)(this,"setTables",function(e){t.tables=e.sort(function(e,t){return e.schema.localeCompare(t.schema)}).filter(function(e){return!Z.F.includes(e.schema)}),t.setDefaultSelectedTable()}),(0,et.Z)(this,"setTriggerFunctions",function(e){t.triggerFunctions=e}),(0,et.Z)(this,"onFormChange",function(e){var n=e.key,r=e.value;if(t.isDirty=!0,(0,s.has)(t.formState,n)){var a=t.formState[n];t.formState[n]=no(no({},a),{},{value:r,error:void 0})}else t.formState[n]={value:r}}),(0,et.Z)(this,"onSelectFunction",function(e){var n=t.triggerFunctions.find(function(t){return t.id==e});n&&(t.formState.functionName.value=n.name,t.formState.functionSchema.value=n.schema)}),(0,et.Z)(this,"validateForm",function(){var e=!0,n=(0,s.mapValues)(t.formState,function(t,n){switch(n){case"name":var r;if((0,s.isEmpty)(t.value)||(r=t.value,/\s/.test(r)))return e=!1,no(no({},t),{},{error:"Invalid trigger name"});return t;case"activation":if((0,s.isEmpty)(t.value))return e=!1,no(no({},t),{},{error:"you have an error"});return t;case"events":if((0,s.isEmpty)(t.value))return e=!1,no(no({},t),{},{error:"Select at least 1 event"});return t;case"tableId":if((0,s.isEmpty)("".concat(t.value)))return e=!1,no(no({},t),{},{error:"You must choose a table"});return t;default:return t}});return e||t.formState.update(n),e}),(0,tH.ky)(this)}return(0,tX.Z)(e,[{key:"selectedFunction",get:function(){var e=this;return this.triggerFunctions.find(function(t){return t.name==e.formState.functionName.value&&t.schema==e.formState.functionSchema.value})}},{key:"title",get:function(){return this.formState.id?"Edit '".concat(this.formState.originalName,"' trigger"):"Add a new Trigger"}},{key:"isEditing",get:function(){return void 0!=this.formState.id}}]),e}(),nd=(0,o.createContext)(null),nu=(0,i.Pi)(function(e){var t=e.trigger,n=e.visible,r=e.setVisible,a=(0,C.d2)().project,s=(0,w.oR)(),c=s.ui,l=s.meta,d=(0,o.useState)(!1),u=d[0],p=d[1],m=(0,i.fv)(function(){return new nl});function f(){return(f=(0,I.Z)(W().mark(function e(){var t,a,s,i;return W().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!m.validateForm()){e.next=15;break}if(m.setLoading(!0),t=m.formState.requestBody,!m.isEditing){e.next=10;break}return e.next=7,l.triggers.update(t.id,t);case 7:e.t0=e.sent,e.next=13;break;case 10:return e.next=12,l.triggers.create(t);case 12:e.t0=e.sent;case 13:(a=e.t0).error?(c.setNotification({category:"error",message:"Failed to create trigger: ".concat(null!==(s=null===(i=a.error)||void 0===i?void 0:i.message)&&void 0!==s?s:"submit request failed")}),m.setLoading(!1)):(c.setNotification({category:"success",message:"".concat(m.isEditing?"Updated":"Created new"," trigger called ").concat(a.name)}),m.setLoading(!1),r(!n));case 15:e.next=21;break;case 17:e.prev=17,e.t1=e.catch(0),c.setNotification({category:"error",message:"Filed to create trigger: ".concat(e.t1.message)}),m.setLoading(!1);case 21:case"end":return e.stop()}},e,null,[[0,17]])}))).apply(this,arguments)}(0,D.Bj)({projectRef:null==a?void 0:a.ref,connectionString:null==a?void 0:a.connectionString},{onSuccess:function(e){m.tables.length<=0&&m.setTables(e)}}),(0,o.useEffect)(function(){var e,t=(e=(0,I.Z)(W().mark(function e(){var t;return W().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.functions.load();case 2:t=l.functions.listTriggerFunctions(),m.setTriggerFunctions(t);case 4:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)});c.selectedProjectRef&&t()},[c.selectedProjectRef]),(0,o.useEffect)(function(){m.setisDirty(!1),t?m.formState.reset(t):(m.formState.reset(),m.setDefaultSelectedTable())},[n,t]);var h=m.tables.length>=1;return(0,O.jsx)(O.Fragment,{children:(0,O.jsx)(B.ZP,{size:"large",visible:n,onCancel:function(){m.isDirty?p(!0):r(!n)},header:m.title,hideFooter:!h,className:m.chooseFunctionFormVisible?"hooks-sidepanel mr-16 transform transition-all duration-300 ease-in-out":"hooks-sidepanel mr-0 transform transition-all duration-300 ease-in-out",loading:m.loading,onConfirm:function(){return f.apply(this,arguments)},children:h?(0,O.jsxs)("div",{className:"",children:[(0,O.jsxs)(nd.Provider,{value:m,children:[(0,O.jsx)("div",{className:"my-6 space-y-10",children:m.isEditing?(0,O.jsxs)("div",{className:"space-y-6 px-6",children:[(0,O.jsx)(np,{}),(0,O.jsx)(nm,{})]}):(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("div",{className:"px-6",children:(0,O.jsx)(np,{})}),(0,O.jsx)(B.ZP.Separator,{}),(0,O.jsxs)("div",{className:"space-y-12 px-6",children:[(0,O.jsx)("h5",{children:"Conditions to fire trigger"}),(0,O.jsx)(nh,{}),(0,O.jsx)(nx,{}),(0,O.jsx)(nb,{}),(0,O.jsx)(nf,{})]}),(0,O.jsx)(B.ZP.Separator,{}),(0,O.jsx)(nv,{})]})}),(0,O.jsx)(nt,{triggerFunctions:m.triggerFunctions,visible:m.chooseFunctionFormVisible,setVisible:m.setChooseFunctionFormVisible,onChange:function(e){return m.onSelectFunction(e)}})]}),(0,O.jsx)(ty.Z,{visible:u,header:"Discard changes",buttonLabel:"Discard",onSelectCancel:function(){return p(!1)},onSelectConfirm:function(){p(!1),r(!n)},children:(0,O.jsx)($.C.Content,{children:(0,O.jsx)("p",{className:"py-4 text-sm text-foreground-light",children:"There are unsaved changes. Are you sure you want to close the panel? Your changes will be lost."})})})]}):(0,O.jsx)(tG.Z,{message:"You will need to create a table first before you can make a trigger"})})})}),np=(0,i.Pi)(function(e){(0,V.Z)(e);var t=(0,o.useContext)(nd);return(0,O.jsx)(u.Z,{id:"name",label:"Name of trigger",layout:"horizontal",placeholder:"Name of trigger",value:t.formState.name.value,onChange:function(e){return t.onFormChange({key:"name",value:e.target.value})},size:"small",error:t.formState.name.error,descriptionText:"The name is also stored as the actual postgres name of the trigger. Do not use spaces/whitespace."})}),nm=(0,i.Pi)(function(e){(0,V.Z)(e);var t=(0,o.useContext)(nd);return(0,O.jsxs)(eU.Z,{id:"enabled-mode",label:"Enabled mode",layout:"horizontal",value:t.formState.enabledMode.value,onChange:function(e){return t.onFormChange({key:"enabledMode",value:e})},size:"small",descriptionText:"Determines if a trigger should or should not fire. Can also be used to disable a trigger, but not delete it.",children:[(0,O.jsxs)(eU.Z.Option,{addOnBefore:function(e){return e.active,e.selected,(0,O.jsx)("div",{className:"h-3 w-3 rounded-full border border-green-700 bg-green-900 shadow-sm"})},value:"ORIGIN",label:"Origin",children:["Origin",(0,O.jsx)("span",{className:"block text-foreground-lighter",children:"This is a default behaviour"})]}),(0,O.jsxs)(eU.Z.Option,{addOnBefore:function(e){return e.active,e.selected,(0,O.jsx)("div",{className:"h-3 w-3 rounded-full border border-green-700 bg-green-900 shadow-sm"})},value:"REPLICA",label:"Replica",children:["Replica",(0,O.jsx)("span",{className:"block text-foreground-lighter",children:"Will only fire if the session is in “replica” mode"})]}),(0,O.jsxs)(eU.Z.Option,{addOnBefore:function(e){return e.active,e.selected,(0,O.jsx)("div",{className:"h-3 w-3 rounded-full border border-green-700 bg-green-900 shadow-sm"})},value:"ALWAYS",label:"Always",children:["Always",(0,O.jsx)("span",{className:"block text-foreground-lighter",children:"Will fire regardless of the current replication role"})]}),(0,O.jsxs)(eU.Z.Option,{addOnBefore:function(e){return e.active,e.selected,(0,O.jsx)("div",{className:"h-3 w-3 rounded-full border border-red-700 bg-red-900 shadow-sm"})},value:"DISABLED",label:"Disabled",children:["Disabled",(0,O.jsx)("span",{className:"block text-foreground-lighter",children:"Will not fire"})]})]})}),nf=(0,i.Pi)(function(e){(0,V.Z)(e);var t=(0,o.useContext)(nd);return(0,O.jsxs)(eU.Z,{id:"orientation",label:"Orientation",layout:"horizontal",value:t.formState.orientation.value,onChange:function(e){return t.onFormChange({key:"orientation",value:e})},size:"small",descriptionText:"Identifies whether the trigger fires once for each processed row or once for each statement",children:[(0,O.jsxs)(eU.Z.Option,{value:"ROW",label:"Row",children:["Row",(0,O.jsx)("span",{className:"block text-foreground-lighter",children:"fires once for each processed row"})]}),(0,O.jsxs)(eU.Z.Option,{value:"STATEMENT",label:"Statement",children:["Statement",(0,O.jsx)("span",{className:"block text-foreground-lighter",children:"fires once for each statement"})]})]})}),nh=(0,i.Pi)(function(e){(0,V.Z)(e);var t=(0,o.useContext)(nd);return(0,O.jsx)(eU.Z,{id:"table",label:"Table",layout:"horizontal",value:t.formState.tableId.value,onChange:function(e){var n=t.tables.find(function(t){return t.id===e});n&&(t.onFormChange({key:"table",value:n.name}),t.onFormChange({key:"schema",value:n.schema}),t.onFormChange({key:"tableId",value:e}))},size:"small",error:t.formState.tableId.error,descriptionText:"This is the table the trigger will watch for changes. You can only select 1 table for a trigger.",children:t.tables.map(function(e){return(0,O.jsx)(eU.Z.Option,{id:e.id,value:e.id,label:e.name,addOnBefore:function(){return(0,O.jsx)("div",{className:"flex items-center justify-center rounded bg-foreground p-1 text-background",children:(0,O.jsx)(tQ.Z,{src:"".concat(eA.GW,"/img/table-editor.svg"),style:{width:"16px",height:"16px",strokeWidth:"1px"},preProcessor:function(e){return e.replace(/svg/,'svg class="m-auto text-color-inherit"')}})})},children:(0,O.jsxs)("div",{className:"flex flex-row items-center space-x-1",children:[(0,O.jsx)("p",{className:"text-sm text-foreground-light",children:e.schema}),(0,O.jsx)("p",{className:"text-foreground",children:e.name})]})},e.id)})})}),nx=(0,i.Pi)(function(e){(0,V.Z)(e);var t=(0,o.useContext)(nd);return(0,O.jsxs)(tJ.Z.Group,{name:"events",label:"Events",id:"events",labelOptional:"The type of events that will trigger your trigger",layout:"horizontal",descriptionText:"These are the events that are watched by the trigger, only the events selected above will fire the trigger on the table you've selected.",size:"small",onChange:function(e){var n=t.formState.events.value,r=e.target.checked?(0,s.union)(n,[e.target.value]):(0,s.without)(n,e.target.value);t.onFormChange({key:"events",value:r})},error:t.formState.events.error,children:[(0,O.jsx)(tJ.Z,{value:"INSERT",label:"Insert",description:"Any insert operation on the table",checked:t.formState.events.value.includes("INSERT")}),(0,O.jsx)(tJ.Z,{value:"UPDATE",label:"Update",description:"Any update operation, of any column in the table",checked:t.formState.events.value.includes("UPDATE")}),(0,O.jsx)(tJ.Z,{value:"DELETE",label:"Delete",description:"Any deletion of a record",checked:t.formState.events.value.includes("DELETE")})]})}),nb=(0,i.Pi)(function(e){(0,V.Z)(e);var t=(0,o.useContext)(nd);return(0,O.jsxs)(eU.Z,{id:"activation",label:"Trigger type",descriptionText:"This determines when your Hook fires",onChange:function(e){t.onFormChange({key:"activation",value:e})},value:t.formState.activation.value,layout:"horizontal",size:"small",error:t.formState.activation.error,children:[(0,O.jsx)(eU.Z.Option,{id:"before",value:"BEFORE",label:"Before the event",addOnBefore:function(){return(0,O.jsx)("div",{className:"flex items-center justify-center rounded bg-foreground p-1 text-background",children:(0,O.jsx)(t$.Z,{strokeWidth:2,size:"small"})})},children:(0,O.jsxs)("div",{className:"flex flex-col",children:[(0,O.jsx)("span",{children:"before"}),(0,O.jsx)("span",{className:"block text-foreground-lighter",children:"Trigger fires before the operation is attempted"})]})}),(0,O.jsx)(eU.Z.Option,{id:"after",value:"AFTER",label:"After the event",addOnBefore:function(){return(0,O.jsx)("div",{className:"flex items-center justify-center rounded bg-green-1200 p-1 text-background",children:(0,O.jsx)(t3,{strokeWidth:2,size:"small"})})},children:(0,O.jsxs)("div",{className:"flex flex-col",children:[(0,O.jsx)("span",{children:"after"}),(0,O.jsx)("span",{className:"block text-foreground-lighter",children:"Trigger fires after the operation has completed"})]})})]})}),nv=(0,i.Pi)(function(e){(0,V.Z)(e);var t=(0,o.useContext)(nd);return(0,O.jsxs)("div",{className:"space-y-4",children:[(0,O.jsx)("div",{className:"space-y-6 px-6",children:(0,O.jsx)("h5",{children:"Function to trigger"})}),(0,O.jsx)("div",{className:"px-6",children:(0,s.isEmpty)(t.formState.functionName.value)?(0,O.jsx)(nj,{}):(0,O.jsx)(ng,{})})]})}),nj=(0,i.Pi)(function(e){(0,V.Z)(e);var t=(0,o.useContext)(nd);return(0,O.jsx)("button",{type:"button",onClick:function(){return t.setChooseFunctionFormVisible(!0)},className:"relative w-full rounded border border-default bg-surface-200 px-5 py-1 shadow-sm transition-all hover:border-strong hover:bg-overlay-hover",children:(0,O.jsx)(tK,{icon:(0,O.jsx)(t4.Z,{size:14,strokeWidth:2}),text:"Choose a function to trigger"})})}),ng=(0,i.Pi)(function(e){(0,V.Z)(e);var t=(0,o.useContext)(nd);return(0,O.jsx)(O.Fragment,{children:(0,O.jsxs)("div",{className:"relative w-full flex items-center justify-between space-x-3 px-5 py-4 border border-default rounded shadow-sm transition-shadow",children:[(0,O.jsxs)("div",{className:"flex items-center gap-2",children:[(0,O.jsx)("div",{className:"flex h-6 w-6 items-center justify-center rounded bg-foreground text-background focus-within:bg-opacity-10",children:(0,O.jsx)(t4.Z,{size:"small",strokeWidth:2,width:14})}),(0,O.jsxs)("div",{className:"flex items-center gap-2",children:[(0,O.jsx)("p",{className:"text-foreground-light",children:t.formState.functionName.value}),(0,O.jsx)("div",{children:(0,O.jsx)(q.Z,{children:t.formState.functionSchema.value})})]})]}),(0,O.jsx)(l.z,{type:"default",onClick:function(){return t.setChooseFunctionFormVisible(!0)},children:"Change function"})]})})}),ny=n(61329),nw=n(37552),nN=(0,i.Pi)(function(e){var t=e.trigger,n=e.visible,r=e.setVisible,a=(0,w.oR)(),s=a.ui,i=a.meta,c=(0,o.useState)(!1),l=c[0],d=c[1],u=null!=t?t:{},p=u.id,m=u.name,f=u.schema;function h(){return(h=(0,I.Z)(W().mark(function e(){var t;return W().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,d(!0),p){e.next=4;break}throw Error("Invalid trigger info");case 4:return e.next=6,i.triggers.del(p);case 6:if(t=e.sent,(0,nw.d8)(t)){e.next=11;break}throw t.error;case 11:s.setNotification({category:"success",message:"Successfully removed ".concat(m)}),r(!1);case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),s.setNotification({category:"error",message:"Failed to delete ".concat(m,": ").concat(e.t0.message)});case 18:return e.prev=18,d(!1),e.finish(18);case 21:case"end":return e.stop()}},e,null,[[0,15,18,21]])}))).apply(this,arguments)}return(0,O.jsx)(ny.Z,{visible:n,onCancel:function(){return r(!n)},onConfirm:function(){return h.apply(this,arguments)},title:"Delete this trigger",loading:l,confirmLabel:"Delete trigger ".concat(m),confirmPlaceholder:"Type in name of trigger",confirmString:m,text:"This will delete your trigger called ".concat(m," of schema ").concat(f,"."),alert:"You cannot recover this trigger once it is deleted!"})}),nZ=n(60229),nS=n(44851);function nO(e){return/\s/.test(e)}function n_(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function nk(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?n_(Object(n),!0).forEach(function(t){(0,et.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):n_(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var nC=function(){function e(){(0,tB.Z)(this,e),(0,et.Z)(this,"id",void 0),(0,et.Z)(this,"originalName",void 0),(0,et.Z)(this,"args",void 0),(0,et.Z)(this,"behavior",void 0),(0,et.Z)(this,"configParams",void 0),(0,et.Z)(this,"definition",void 0),(0,et.Z)(this,"language",void 0),(0,et.Z)(this,"name",void 0),(0,et.Z)(this,"returnType",void 0),(0,et.Z)(this,"schema",void 0),(0,et.Z)(this,"securityDefiner",void 0),(0,tH.ky)(this),this.reset()}return(0,tX.Z)(e,[{key:"requestBody",get:function(){return{id:this.id,name:this.name.value,schema:this.schema.value,definition:this.definition.value,return_type:this.returnType.value,language:this.language.value,behavior:this.behavior.value,security_definer:this.securityDefiner.value,args:this.args.value.map(function(e){return"".concat(e.name," ").concat(e.type)}),config_params:(0,s.mapValues)((0,s.keyBy)(this.configParams.value,"name"),"value")}}},{key:"reset",value:function(e){var t,n,r,a,i,o,c,l,d;this.id=null==e?void 0:e.id,this.originalName=null==e?void 0:e.name,this.args=(d=null==(l=null==e?void 0:e.argument_types)?void 0:l.split(","),(0,s.isEmpty)(l)||!d||(null==d?void 0:d.length)==0?{value:[]}:{value:d.map(function(e){var t=e.trim(),n=t.indexOf(" ");return{name:t.slice(0,1!==n?n:0),type:t.slice(n+1)}})}),this.behavior={value:null!==(t=null==e?void 0:e.behavior)&&void 0!==t?t:"VOLATILE"},this.configParams=function(e){var t=[];if(e)for(var n in e)t.push({name:n,value:e[n]});return{value:t}}(null==e?void 0:e.config_params),this.definition={value:null!==(n=null==e?void 0:e.definition)&&void 0!==n?n:""},this.language={value:null!==(r=null==e?void 0:e.language)&&void 0!==r?r:"plpgsql"},this.name={value:null!==(a=null==e?void 0:e.name)&&void 0!==a?a:""},this.returnType={value:null!==(i=null==e?void 0:e.return_type)&&void 0!==i?i:"void"},this.schema={value:null!==(o=null==e?void 0:e.schema)&&void 0!==o?o:"public"},this.securityDefiner={value:null!==(c=null==e?void 0:e.security_definer)&&void 0!==c&&c}}},{key:"update",value:function(e){this.args=e.args,this.behavior=e.behavior,this.configParams=e.configParams,this.definition=e.definition,this.language=e.language,this.name=e.name,this.returnType=e.returnType,this.schema=e.schema,this.securityDefiner=e.securityDefiner}}]),e}(),nP=function(){function e(){var t=this;(0,tB.Z)(this,e),(0,et.Z)(this,"loading",!1),(0,et.Z)(this,"formState",new nC),(0,et.Z)(this,"meta",null),(0,et.Z)(this,"schemas",[]),(0,et.Z)(this,"advancedVisible",!1),(0,et.Z)(this,"isDirty",!1),(0,et.Z)(this,"toggleAdvancedVisible",function(){t.advancedVisible=!t.advancedVisible}),(0,et.Z)(this,"setSchemas",function(e){t.schemas=e}),(0,et.Z)(this,"setLoading",function(e){t.loading=e}),(0,et.Z)(this,"setIsDirty",function(e){t.isDirty=e}),(0,et.Z)(this,"onFormChange",function(e){var n=e.key,r=e.value;if(t.isDirty=!0,(0,s.has)(t.formState,n)){var a=t.formState[n];t.formState[n]=nk(nk({},a),{},{value:r,error:void 0})}else t.formState[n]={value:r}}),(0,et.Z)(this,"onFormArrayChange",function(e){var n=e.operation,r=e.key,a=e.idx,i=e.value;switch(n){case"add":(0,s.has)(t.formState,r)?t.formState[r].value.push(i):t.formState[r]={value:[i]};break;case"delete":if((0,s.has)(t.formState,r)){var o=(0,s.filter)(t.formState[r].value,function(e,t){return t!=a});t.formState[r].value=o}break;default:(0,s.has)(t.formState,r)&&!(0,s.isUndefined)(a)?t.formState[r].value[a]=i:t.formState[r]={value:[i]}}}),(0,et.Z)(this,"validateForm",function(){var e=!0,n=(0,s.mapValues)(t.formState,function(t,n){switch(n){case"name":if((0,s.isEmpty)(t.value)||nO(t.value))return e=!1,nk(nk({},t),{},{error:"Invalid function name"});return t;case"args":var r,a=null===(r=t.value)||void 0===r?void 0:r.map(function(t){return(0,s.isEmpty)(t.name)||nO(t.name)?(e=!1,nk(nk({},t),{},{error:"Invalid argument name"})):t});return t.value=a,t;case"configParams":var i,o=null===(i=t.value)||void 0===i?void 0:i.map(function(t){var n={name:void 0,value:void 0};return((0,s.isEmpty)(t.name)||nO(t.name))&&(e=!1,n.name="Invalid config name"),(0,s.isEmpty)(t.value)&&(e=!1,n.value="Missing config value"),nk(nk({},t),{},{error:n})});return t.value=o,t;default:return t}});return e||t.formState.update(n),e}),(0,tH.ky)(this)}return(0,tX.Z)(e,[{key:"title",get:function(){return this.formState.id?"Edit '".concat(this.formState.originalName,"' function"):"Add a new function"}},{key:"isEditing",get:function(){return void 0!=this.formState.id}}]),e}(),nE=(0,o.createContext)(null),nD=(0,i.Pi)(function(e){var t=e.func,n=e.visible,r=e.setVisible,a=(0,w.oR)(),s=a.ui,c=a.meta,l=(0,C.d2)().project,d=(0,i.fv)(function(){return new nP}),u=(0,o.useState)(!1),p=u[0],m=u[1];function f(){return(f=(0,I.Z)(W().mark(function e(){var t,a,i;return W().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!d.validateForm()){e.next=15;break}if(d.setLoading(!0),!(t=d.formState.requestBody).id){e.next=10;break}return e.next=7,c.functions.update(t.id,t);case 7:e.t0=e.sent,e.next=13;break;case 10:return e.next=12,c.functions.create(t);case 12:e.t0=e.sent;case 13:a=e.t0,(0,nw.d8)(a)?(s.setNotification({category:"success",message:"".concat(d.isEditing?"Updated":"Created new"," function called ").concat(a.name)}),d.setLoading(!1),r(!n)):(s.setNotification({category:"error",message:"Failed to create function: ".concat(null!==(i=a.error.message)&&void 0!==i?i:"Submit request failed")}),d.setLoading(!1));case 15:e.next=21;break;case 17:e.prev=17,e.t1=e.catch(0),s.setNotification({category:"error",message:"Failed to create function: ".concat(e.t1.message)}),d.setLoading(!1);case 21:case"end":return e.stop()}},e,null,[[0,17]])}))).apply(this,arguments)}return(0,E.Q1)({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString},{onSuccess:function(e){d.setSchemas(e)}}),(0,o.useEffect)(function(){d.formState.reset(t),d.setIsDirty(!1)},[n,t]),(0,O.jsx)(O.Fragment,{children:(0,O.jsxs)(B.ZP,{size:"large",visible:n,onCancel:function(){d.isDirty?m(!0):r(!n)},header:d.title,className:"hooks-sidepanel mr-0 transform transition-all duration-300 ease-in-out",loading:d.loading,onConfirm:function(){return f.apply(this,arguments)},children:[(0,O.jsx)(nE.Provider,{value:d,children:(0,O.jsx)("div",{className:"mt-4 space-y-10",children:d.isEditing?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(B.ZP.Content,{children:(0,O.jsxs)("div",{className:"space-y-4",children:[(0,O.jsx)(nT,{}),(0,O.jsx)(nV,{})]})}),(0,O.jsx)(B.ZP.Separator,{}),(0,O.jsx)(B.ZP.Content,{children:(0,O.jsx)(nR,{readonly:!0})}),(0,O.jsx)(B.ZP.Separator,{}),(0,O.jsx)(B.ZP.Content,{children:(0,O.jsx)(nI,{})})]}):(0,O.jsxs)("div",{className:"space-y-6",children:[(0,O.jsx)(B.ZP.Content,{children:(0,O.jsx)(nT,{})}),(0,O.jsx)(B.ZP.Separator,{}),(0,O.jsx)(B.ZP.Content,{children:(0,O.jsxs)("div",{className:"space-y-4",children:[(0,O.jsx)(nV,{}),(0,O.jsx)(nW,{})]})}),(0,O.jsx)(B.ZP.Separator,{}),(0,O.jsx)(B.ZP.Content,{children:(0,O.jsx)(nR,{})}),(0,O.jsx)(B.ZP.Separator,{}),(0,O.jsx)(B.ZP.Content,{children:(0,O.jsx)(nI,{})}),(0,O.jsx)(B.ZP.Separator,{}),(0,O.jsx)(B.ZP.Content,{children:(0,O.jsx)(tC.Z,{children:(0,O.jsx)("div",{className:"space-y-8 rounded bg-background py-4",children:(0,O.jsx)("div",{className:"px-6",children:(0,O.jsx)(H.Z,{onChange:function(){return d.toggleAdvancedVisible()},label:"Show advanced settings",checked:d.advancedVisible,labelOptional:"These are settings that might be familiar for postgres heavy users "})})})})}),d.advancedVisible&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(B.ZP.Content,{children:(0,O.jsxs)("div",{className:"space-y-2",children:[(0,O.jsx)(nL,{}),(0,O.jsx)(nq,{})]})}),(0,O.jsx)(B.ZP.Separator,{}),(0,O.jsx)(B.ZP.Content,{children:(0,O.jsx)(nz,{})}),(0,O.jsx)(B.ZP.Separator,{}),(0,O.jsx)(B.ZP.Content,{children:(0,O.jsx)(nY,{})})]})]})})}),(0,O.jsx)(ty.Z,{visible:p,header:"Discard changes",buttonLabel:"Discard",onSelectCancel:function(){return m(!1)},onSelectConfirm:function(){m(!1),r(!n)},children:(0,O.jsx)($.C.Content,{children:(0,O.jsx)("p",{className:"py-4 text-sm text-foreground-light",children:"There are unsaved changes. Are you sure you want to close the panel? Your changes will be lost."})})})]})})}),nT=(0,i.Pi)(function(e){(0,V.Z)(e);var t=(0,o.useContext)(nE);return(0,O.jsx)(u.Z,{id:"name",label:"Name of function",layout:"horizontal",placeholder:"Name of function",value:t.formState.name.value,onChange:function(e){return t.onFormChange({key:"name",value:e.target.value})},size:"small",error:t.formState.name.error,descriptionText:"Name will also be used for the function name in postgres"})}),nR=(0,i.Pi)(function(e){var t=e.readonly,n=(0,o.useContext)(nE);return(0,O.jsxs)("div",{children:[(0,O.jsxs)("div",{className:"flex flex-col",children:[(0,O.jsx)("h5",{className:"text-base text-foreground",children:"Arguments"}),(0,O.jsx)("p",{className:"text-sm text-foreground-light",children:"Arguments can be referenced in the function body using either names or numbers."})]}),(0,O.jsxs)("div",{className:"space-y-2 pt-4",children:[t&&(0,s.isEmpty)(n.formState.args.value)&&(0,O.jsx)("span",{className:"text-foreground-lighter",children:"No argument for this function"}),n.formState.args.value.map(function(e,n){return(0,O.jsx)(nF,{idx:n,name:e.name,type:e.type,error:e.error,readonly:t},"arg-".concat(n))}),!t&&(0,O.jsx)("div",{className:"",children:(0,O.jsx)(l.z,{type:"default",icon:(0,O.jsx)(m.Z,{}),onClick:function(){n.onFormArrayChange({key:"args",value:{name:"",type:"bool"},operation:"add"})},disabled:t,children:"Add a new argument"})})]})]})}),nF=(0,i.Pi)(function(e){var t=e.idx,n=e.name,r=e.type,a=e.error,s=e.readonly,i=(0,o.useContext)(nE);return(0,O.jsxs)("div",{className:"flex flex-row space-x-1 items-center",children:[(0,O.jsx)(u.Z,{id:"name-".concat(t),className:"flex-1 flex-grow",value:n,placeholder:"Name of argument",onChange:function(e){var n=e.currentTarget.value;i.onFormArrayChange({key:"args",value:{name:n,type:r},idx:t,operation:"update"})},size:"small",error:a,disabled:s}),s?(0,O.jsx)(u.Z,{disabled:!0,readOnly:!0,id:"type-".concat(t),size:"small",value:r,className:"flex-1"}):(0,O.jsxs)(eU.Z,{id:"type-".concat(t),className:"flex-1",value:r,size:"small",onChange:function(e){i.onFormArrayChange({key:"args",value:{name:n,type:e},idx:t,operation:"update"})},disabled:s,children:[(0,O.jsx)(eU.Z.Option,{value:"integer",label:"integer",children:"integer"}),nS.DL.map(function(e){return(0,O.jsx)(eU.Z.Option,{value:e,label:e,children:e},e)})]}),!s&&(0,O.jsx)(l.z,{type:"danger",icon:(0,O.jsx)(b.Z,{size:"tiny"}),onClick:function(){i.onFormArrayChange({key:"args",idx:t,operation:"delete"})},size:"small"})]})}),nz=(0,i.Pi)(function(e){(0,V.Z)(e);var t=(0,o.useContext)(nE);return(0,O.jsxs)("div",{children:[(0,O.jsx)("div",{className:"flex items-center justify-between",children:(0,O.jsx)("h5",{className:"text-base text-foreground",children:"Config Params"})}),(0,O.jsx)("div",{className:"space-y-2 pt-4",children:t.formState.configParams.value.map(function(e,t){return(0,O.jsx)(nA,{idx:t,name:e.name,value:e.value,error:e.error},"configParam-".concat(t))})}),(0,O.jsx)("div",{className:"pt-2",children:(0,O.jsx)(l.z,{type:"default",icon:(0,O.jsx)(m.Z,{}),onClick:function(){t.onFormArrayChange({key:"configParams",value:{name:"",value:""},operation:"add"})},children:"Add a new config"})})]})}),nA=(0,i.Pi)(function(e){var t=e.idx,n=e.name,r=e.value,a=e.error,s=(0,o.useContext)(nE);return(0,O.jsxs)("div",{className:"flex space-x-1 items-center",children:[(0,O.jsx)(u.Z,{id:"name-".concat(t),className:"flex-1",placeholder:"Name of config",value:n,onChange:function(e){var n=e.currentTarget.value;s.onFormArrayChange({key:"configParams",value:{name:n,value:r},idx:t,operation:"update"})},size:"small",error:null==a?void 0:a.name}),(0,O.jsx)(u.Z,{id:"value-".concat(t),className:"flex-1",placeholder:"Value of config",value:r,onChange:function(e){var r=e.currentTarget.value;s.onFormArrayChange({key:"configParams",value:{name:n,value:r},idx:t,operation:"update"})},size:"small",error:null==a?void 0:a.value}),(0,O.jsx)(l.z,{type:"danger",icon:(0,O.jsx)(b.Z,{size:"tiny"}),onClick:function(){s.onFormArrayChange({key:"configParams",idx:t,operation:"delete"})},size:"small"})]})}),nI=(0,i.Pi)(function(e){(0,V.Z)(e);var t=(0,o.useContext)(nE);return(0,O.jsxs)("div",{className:"space-y-4",children:[(0,O.jsxs)("div",{className:"flex flex-col",children:[(0,O.jsx)("h5",{className:"text-base text-foreground",children:"Definition"}),(0,O.jsxs)("p",{className:"text-sm text-foreground-light",children:["The language below should be written in `",t.formState.language.value,"`."]}),!(null!=t&&t.isEditing)&&(0,O.jsx)("p",{className:"text-sm text-foreground-light",children:"Change the language in the Advanced Settings below."})]}),(0,O.jsx)("div",{className:"h-60 resize-y border border-default",children:(0,O.jsx)(t8.Z,{defaultValue:t.formState.definition.value,onInputChange:function(e){t.onFormChange({key:"definition",value:e})},contextmenu:!1})})]})}),nV=(0,i.Pi)(function(e){(0,V.Z)(e);var t,n=(0,o.useContext)(nE),r=(0,C.d2)().project,a=(0,E.Q1)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString}).data,s=null!==(t=null==a?void 0:a.filter(function(e){return!Z.F.includes(e.name)}))&&void 0!==t?t:[];return(0,O.jsx)(eU.Z,{id:"schema",label:"Schema",size:"small",layout:"horizontal",placeholder:"Pick a schema",value:n.formState.schema.value,descriptionText:"Tables made in the table editor will be in 'public'",onChange:function(e){return n.onFormChange({key:"schema",value:e})},children:s.map(function(e){return(0,O.jsx)(eU.Z.Option,{label:e.name,value:e.name,children:e.name},e.name)})})}),nL=(0,i.Pi)(function(e){(0,V.Z)(e);var t=(0,w.oR)().meta,n=(0,o.useContext)(nE),r=(0,s.partition)(t.extensions.list(),function(e){return!(0,s.isNull)(e.installed_version)}),a=(0,k.Z)(r,1)[0];return(0,O.jsxs)(eU.Z,{id:"language",size:"small",label:"Language",layout:"horizontal",value:n.formState.language.value,placeholder:"Pick a language",onChange:function(e){return n.onFormChange({key:"language",value:e})},children:[(0,O.jsx)(eU.Z.Option,{value:"sql",label:"sql",children:"sql"}),a.filter(function(e){return e.name.startsWith("pl")}).map(function(e){return(0,O.jsx)(eU.Z.Option,{value:e.name,label:e.name,children:e.name},e.name)})]})}),nW=(0,i.Pi)(function(e){(0,V.Z)(e);var t=(0,o.useContext)(nE);return(0,O.jsxs)(eU.Z,{id:"returnType",size:"small",label:"Return type",layout:"horizontal",value:t.formState.returnType.value,onChange:function(e){return t.onFormChange({key:"returnType",value:e})},children:[(0,O.jsx)(eU.Z.Option,{value:"void",label:"void",children:"void"}),(0,O.jsx)(eU.Z.Option,{value:"record",label:"record",children:"record"}),(0,O.jsx)(eU.Z.Option,{value:"trigger",label:"trigger",children:"trigger"}),(0,O.jsx)(eU.Z.Option,{value:"integer",label:"integer",children:"integer"}),nS.DL.map(function(e){return(0,O.jsx)(eU.Z.Option,{value:e,label:e,children:e},e)})]})}),nq=(0,i.Pi)(function(e){(0,V.Z)(e);var t=(0,o.useContext)(nE);return(0,O.jsxs)(eU.Z,{id:"behavior",size:"small",label:"Behavior",layout:"horizontal",value:t.formState.behavior.value,onChange:function(e){return t.onFormChange({key:"behavior",value:e})},children:[(0,O.jsx)(eU.Z.Option,{value:"IMMUTABLE",label:"immutable",children:"immutable"}),(0,O.jsx)(eU.Z.Option,{value:"STABLE",label:"stable",children:"stable"}),(0,O.jsx)(eU.Z.Option,{value:"VOLATILE",label:"volatile",children:"volatile"})]})}),nY=(0,i.Pi)(function(e){(0,V.Z)(e);var t=(0,o.useContext)(nE);return(0,O.jsx)(O.Fragment,{children:(0,O.jsx)("div",{className:"space-y-4",children:(0,O.jsxs)(nZ.Z.Group,{type:"cards",label:"Type of security",layout:"vertical",onChange:function(e){t.onFormChange({key:"securityDefiner",value:"SECURITY_DEFINER"==e.target.value})},value:t.formState.securityDefiner.value?"SECURITY_DEFINER":"SECURITY_INVOKER",error:t.formState.securityDefiner.error,children:[(0,O.jsx)(nZ.Z,{id:"SECURITY_INVOKER",label:"SECURITY INVOKER",value:"SECURITY_INVOKER",checked:!t.formState.securityDefiner.value,description:"Function is to be executed with the privileges of the user that calls it."}),(0,O.jsx)(nZ.Z,{id:"SECURITY_DEFINER",label:"SECURITY DEFINER",value:"SECURITY_DEFINER",checked:t.formState.securityDefiner.value,description:"Function is to be executed with the privileges of the user that created it."})]})})})}),nM=(0,i.Pi)(function(e){var t=e.func,n=e.visible,r=e.setVisible,a=(0,w.oR)(),s=a.ui,i=a.meta,c=(0,o.useState)(!1),l=c[0],d=c[1],u=null!=t?t:{},p=u.id,m=u.name,f=u.schema;function h(){return(h=(0,I.Z)(W().mark(function e(){var t;return W().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,d(!0),p){e.next=4;break}throw Error("Invalid function info");case 4:return e.next=6,i.functions.del(p);case 6:if(t=e.sent,(0,nw.d8)(t)){e.next=11;break}throw t.error;case 11:s.setNotification({category:"success",message:"Successfully removed ".concat(m)}),r(!1);case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),s.setNotification({category:"error",message:"Failed to delete ".concat(m,": ").concat(e.t0.message)});case 18:return e.prev=18,d(!1),e.finish(18);case 21:case"end":return e.stop()}},e,null,[[0,15,18,21]])}))).apply(this,arguments)}return(0,O.jsx)(O.Fragment,{children:(0,O.jsx)(ny.Z,{visible:n,onCancel:function(){return r(!n)},onConfirm:function(){return h.apply(this,arguments)},title:"Delete this function",loading:l,confirmLabel:"Delete function ".concat(m),confirmPlaceholder:"Type in name of function",confirmString:m,text:"This will delete your function called ".concat(m," of schema ").concat(f,"."),alert:"You cannot recover this function once it is deleted!"})})}),nU=n(58943),nB={list:function(e){return["projects",e,"enumerated-types"]}},nX=["enabled"];function nH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function nQ(){return(nQ=(0,I.Z)(W().mark(function e(t,n){var r,a,s,i,o,c;return W().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.projectRef,a=t.connectionString,r){e.next=3;break}throw Error("projectRef is required");case 3:return s=new Headers,a&&s.set("x-connection-encrypted",a),e.next=7,(0,tE.U2)("/platform/pg-meta/{ref}/types",{params:{header:{"x-connection-encrypted":a},path:{ref:r}},headers:Object.fromEntries(s),signal:n});case 7:if(o=(i=e.sent).data,!(c=i.error)){e.next=12;break}throw c;case 12:return e.abrupt("return",o);case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}var nK=function(e){var t=e.projectRef,n=e.connectionString,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.enabled,s=(0,en.Z)(r,nX);return(0,nU.a)(nB.list(t),function(e){return function(e,t){return nQ.apply(this,arguments)}({projectRef:t,connectionString:n},e.signal)},function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nH(Object(n),!0).forEach(function(t){(0,et.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nH(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({enabled:(void 0===a||a)&&void 0!==t},s))},nG=n(88883),nJ=n(40023),n$=n(63955),n0=n(16473),n1=n(50077),n2=n(15659),n3=n(25208),n4=n(30195),n5=["onSuccess","onError"];function n6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function n8(){return(n8=(0,I.Z)(W().mark(function e(t){var n,r,a,s,i,o,c,l,d,u;return W().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.projectRef,r=t.connectionString,a=t.schema,s=t.name,i=t.description,o=t.values,c='create type "'.concat(a,'"."').concat(s,'" as enum (').concat(o.map(function(e){return"'".concat(e,"'")}).join(", "),");"),l=void 0!==i?'comment on type "'.concat(a,'"."').concat(s,"\" is '").concat(i,"';"):"",d=eO("".concat(c," ").concat(l)),e.next=6,(0,eZ.Rj)({projectRef:n,connectionString:r,sql:d});case 6:return u=e.sent.result,e.abrupt("return",u);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}var n7=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onSuccess,n=e.onError,r=(0,en.Z)(e,n5),a=(0,eg.NL)();return(0,ew.D)(function(e){return function(e){return n8.apply(this,arguments)}(e)},function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?n6(Object(n),!0).forEach(function(t){(0,et.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):n6(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({onSuccess:function(e,n,r){return(0,I.Z)(W().mark(function s(){var i;return W().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return i=n.projectRef,s.next=3,a.invalidateQueries(nB.list(i));case 3:return s.next=5,null==t?void 0:t(e,n,r);case 5:case"end":return s.stop()}},s)}))()},onError:function(e,t,r){return(0,I.Z)(W().mark(function a(){return W().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:void 0===n?eN.ZP.error("Failed to create enumerated type: ".concat(e.message)):n(e,t,r);case 1:case"end":return a.stop()}},a)}))()}},r))},n9=n(76670);function re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function rt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?re(Object(n),!0).forEach(function(t){(0,et.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):re(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var rn=function(e){var t=e.index,n=e.id,r=e.field,a=e.isDisabled,s=void 0!==a&&a,i=e.onRemoveValue;return(0,O.jsx)(nJ._l,{draggableId:n,index:t,isDragDisabled:s,children:function(e){return(0,O.jsxs)("div",rt(rt({ref:e.innerRef},e.draggableProps),{},{className:"flex items-center space-x-2",children:[(0,O.jsx)("div",rt(rt({},e.dragHandleProps),{},{className:"opacity-50 hover:opacity-100 transition ".concat(s?"text-foreground-lighter !cursor-default":"text-foreground"),children:(0,O.jsx)(n9.Z,{size:16,strokeWidth:1.5})})),(0,O.jsx)(n1.I,rt(rt({},r),{},{className:"w-full"})),(0,O.jsx)(l.z,{type:"default",size:"small",disabled:s,icon:(0,O.jsx)(b.Z,{strokeWidth:1.5,size:16}),className:"px-2",onClick:function(){return i()}})]}))}})};function rr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ra(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rr(Object(n),!0).forEach(function(t){(0,et.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rr(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var rs=function(e){var t=e.visible,n=e.onClose,r=e.schema,a=(0,o.useRef)(null),s=(0,C.d2)().project,i=n7({onSuccess:function(e,t){eN.ZP.success('Successfully created type "'.concat(t.name,'"')),n()}}),c=i.mutate,d=i.isLoading,u=n4.Ry({name:n4.Z_().min(1,"Please provide a name for your enumerated type").default(""),description:n4.Z_().default("").optional(),values:n4.Ry({value:n4.Z_().min(1,"Please provide a value")}).array().default([])}),p=(0,n$.cI)({resolver:(0,nG.F)(u),defaultValues:{name:"",description:"",values:[{value:""}]}}),f=(0,n$.Dq)({name:"values",control:p.control}),h=f.fields,x=f.append,b=f.remove,v=f.move,j=function(e){e.destination&&v(e.source.index,e.destination.index)};return(0,o.useEffect)(function(){t&&p.reset()},[t]),(0,O.jsx)(B.ZP,{loading:d,visible:t,onCancel:n,header:"Create a new enumerated type",confirmText:"Create type",onConfirm:function(){a.current&&a.current.click()},children:(0,O.jsx)(B.ZP.Content,{className:"py-4",children:(0,O.jsx)(n0.l0,ra(ra({},p),{},{children:(0,O.jsxs)("form",{className:"space-y-4",onSubmit:p.handleSubmit(function(e){var t;return(null==s?void 0:s.ref)===void 0?console.error("Project ref required"):(null==s?void 0:s.connectionString)===void 0?console.error("Project connectionString required"):void c({projectRef:s.ref,connectionString:s.connectionString,schema:r,name:e.name,description:null===(t=e.description)||void 0===t?void 0:t.replaceAll("'","''"),values:e.values.filter(function(e){return e.value.length>0}).map(function(e){return e.value})})}),children:[(0,O.jsx)(n0.Wi,{control:p.control,name:"name",render:function(e){var t=e.field;return(0,O.jsxs)(n0.xJ,{children:[(0,O.jsx)(n0.lX,{children:"Name"}),(0,O.jsx)(n0.NI,{children:(0,O.jsx)(n1.I,ra({},t))}),(0,O.jsx)(n0.zG,{})]})}}),(0,O.jsx)(n0.Wi,{control:p.control,name:"description",render:function(e){var t=e.field;return(0,O.jsxs)(n0.xJ,{children:[(0,O.jsx)(n0.lX,{children:"Description"}),(0,O.jsx)(n0.NI,{children:(0,O.jsx)(n1.I,ra({},t))}),(0,O.jsx)(n0.pf,{children:"Optional"})]})}}),(0,O.jsx)(nJ.Z5,{onDragEnd:function(e){return j(e)},children:(0,O.jsx)(nJ.bK,{droppableId:"enum_type_values_droppable",children:function(e){return(0,O.jsxs)("div",{ref:e.innerRef,children:[h.map(function(e,t){return(0,O.jsx)(n0.Wi,{control:p.control,name:"values.".concat(t,".value"),render:function(n){var r=n.field;return(0,O.jsxs)(n0.xJ,{children:[(0,O.jsx)(n0.lX,{className:(0,n2.cn)(0!==t&&"sr-only"),children:"Values"}),0===t&&(0,O.jsxs)(n3.bZ,{children:[(0,O.jsx)(ep.Z,{strokeWidth:1.5}),(0,O.jsx)(n3.Cd,{children:"After creation, values cannot be deleted or sorted"}),(0,O.jsxs)(n3.X,{children:[(0,O.jsx)("p",{className:"!leading-normal track",children:"You will need to delete and recreate the enumerated type with the updated values instead."}),(0,O.jsx)(l.z,{asChild:!0,type:"default",icon:(0,O.jsx)(em.Z,{strokeWidth:1.5}),className:"mt-2",children:(0,O.jsx)(eu(),{href:"https://www.postgresql.org/message-id/21012.1459434338%40sss.pgh.pa.us",target:"_blank",rel:"noreferrer",children:"Learn more"})})]})]}),(0,O.jsx)(n0.NI,{children:(0,O.jsx)(rn,{index:t,id:e.id,field:r,isDisabled:h.length<2,onRemoveValue:function(){return b(t)}})}),(0,O.jsx)(n0.zG,{className:"ml-6"})]})}},e.id)}),e.placeholder]})}})}),(0,O.jsx)(l.z,{type:"default",icon:(0,O.jsx)(m.Z,{strokeWidth:1.5}),onClick:function(){return x({value:""})},children:"Add value"}),(0,O.jsx)(l.z,{ref:a,htmlType:"submit",type:"default",className:"hidden",children:"Update"})]})}))})})},ri=n(35981),ro=["onSuccess","onError"];function rc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function rl(){return(rl=(0,I.Z)(W().mark(function e(t){var n,r,a,s,i,o;return W().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.projectRef,r=t.connectionString,a=t.name,s=t.schema,i="drop type if exists ".concat(s,".").concat(a),e.next=4,(0,eZ.Rj)({projectRef:n,connectionString:r,sql:i});case 4:return o=e.sent.result,e.abrupt("return",o);case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}var rd=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onSuccess,n=e.onError,r=(0,en.Z)(e,ro),a=(0,eg.NL)();return(0,ew.D)(function(e){return function(e){return rl.apply(this,arguments)}(e)},function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rc(Object(n),!0).forEach(function(t){(0,et.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rc(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({onSuccess:function(e,n,r){return(0,I.Z)(W().mark(function s(){var i;return W().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return i=n.projectRef,s.next=3,a.invalidateQueries(nB.list(i));case 3:return s.next=5,null==t?void 0:t(e,n,r);case 5:case"end":return s.stop()}},s)}))()},onError:function(e,t,r){return(0,I.Z)(W().mark(function a(){return W().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:void 0===n?eN.ZP.error("Failed to create enumerated type: ".concat(e.message)):n(e,t,r);case 1:case"end":return a.stop()}},a)}))()}},r))},ru=function(e){var t=e.visible,n=e.selectedEnumeratedType,r=e.onClose,a=(0,C.d2)().project,s=rd({onSuccess:function(){eN.ZP.success('Successfully deleted "'.concat(n.name,'"')),r()}}),i=s.mutate,o=s.isLoading;return(0,O.jsx)(ty.Z,{danger:!0,size:"medium",loading:o,visible:t,header:(0,O.jsxs)(O.Fragment,{children:["Confirm to delete enumerated type"," ",(0,O.jsx)("code",{className:"text-sm",children:null==n?void 0:n.name})]}),buttonLabel:"Confirm delete",buttonLoadingLabel:"Deleting...",onSelectConfirm:function(){return void 0===n?console.error("No enumerated type selected"):(null==a?void 0:a.ref)===void 0?console.error("Project ref required"):(null==a?void 0:a.connectionString)===void 0?console.error("Project connectionString required"):void i({projectRef:null==a?void 0:a.ref,connectionString:null==a?void 0:a.connectionString,name:n.name,schema:n.schema})},onSelectCancel:r,children:(0,O.jsx)($.C.Content,{children:(0,O.jsxs)("div",{className:"py-6",children:[(0,O.jsxs)(n3.bZ,{variant:"warning",children:[(0,O.jsx)(ri.Z,{strokeWidth:2}),(0,O.jsx)(n3.Cd,{children:"This action cannot be undone"}),(0,O.jsx)(n3.X,{children:"You will need to re-create the enumerated type if you want to revert the deletion."})]}),(0,O.jsxs)("div",{className:"mt-4",children:[(0,O.jsx)("strong",{className:"text-sm",children:"Before deleting this enumerated type, consider:"}),(0,O.jsx)("ul",{className:"space-y-2 mt-2 text-sm text-foreground-light",children:(0,O.jsx)("li",{className:"list-disc ml-6",children:"This enumerated type is no longer in use in any tables or functions"})})]})]})})})},rp=["onSuccess","onError"];function rm(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function rf(){return(rf=(0,I.Z)(W().mark(function e(t){var n,r,a,s,i,o,c,l,d,u;return W().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.projectRef,r=t.connectionString,a=t.schema,s=t.name,i=t.description,c=void 0===(o=t.values)?[]:o,l=[],s.original!==s.updated&&l.push('alter type "'.concat(a,'"."').concat(s.original,'" rename to "').concat(s.updated,'";')),c.length>0&&c.forEach(function(e,t){if(e.isNew){if(0===t){var n=c.find(function(e){return!e.isNew});l.push('alter type "'.concat(a,'"."').concat(s.updated,"\" add value '").concat(e.updated,"' before '").concat(null==n?void 0:n.original,"';"))}else l.push('alter type "'.concat(a,'"."').concat(s.updated,"\" add value '").concat(e.updated,"' after '").concat(c[t-1].updated,"';"))}else e.original!==e.updated&&l.push('alter type "'.concat(a,'"."').concat(s.updated,"\" rename value '").concat(e.original,"' to '").concat(e.updated,"';"))}),void 0!==i&&l.push('comment on type "'.concat(a,'"."').concat(s.updated,"\" is '").concat(i,"';")),d=eO(l.join(" ")),e.next=8,(0,eZ.Rj)({projectRef:n,connectionString:r,sql:d});case 8:return u=e.sent.result,e.abrupt("return",u);case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}var rh=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onSuccess,n=e.onError,r=(0,en.Z)(e,rp),a=(0,eg.NL)();return(0,ew.D)(function(e){return function(e){return rf.apply(this,arguments)}(e)},function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rm(Object(n),!0).forEach(function(t){(0,et.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rm(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({onSuccess:function(e,n,r){return(0,I.Z)(W().mark(function s(){var i;return W().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return i=n.projectRef,s.next=3,a.invalidateQueries(nB.list(i));case 3:return s.next=5,null==t?void 0:t(e,n,r);case 5:case"end":return s.stop()}},s)}))()},onError:function(e,t,r){return(0,I.Z)(W().mark(function a(){return W().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:void 0===n?eN.ZP.error("Failed to add value to enumerated type: ".concat(e.message)):n(e,t,r);case 1:case"end":return a.stop()}},a)}))()}},r))};function rx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function rb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rx(Object(n),!0).forEach(function(t){(0,et.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rx(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var rv=function(e){var t,n=e.visible,r=e.selectedEnumeratedType,a=e.onClose,s=(0,o.useRef)(null),i=(0,C.d2)().project,c=rh({onSuccess:function(e,t){eN.ZP.success('Successfully updated type "'.concat(t.name.updated,'"')),a()}}),d=c.mutate,u=c.isLoading,p=n4.Ry({name:n4.Z_().min(1,"Please provide a name for your enumerated type").default(""),description:n4.Z_().default("").optional(),values:n4.Ry({isNew:n4.O7(),originalValue:n4.Z_(),updatedValue:n4.Z_().min(1,"Please provide a value")}).array().default([])}),f=(0,n$.cI)({resolver:(0,nG.F)(p),defaultValues:{name:"",description:"",values:[{isNew:!0,originalValue:"",updatedValue:""}]}}),h=(0,n$.Dq)({name:"values",control:f.control}),x=h.fields,b=h.append,v=h.remove,j=h.move,g=function(e){e.destination&&j(e.source.index,e.destination.index)},y=(null!==(t=null==r?void 0:r.enums)&&void 0!==t?t:[]).map(function(e){return{isNew:!1,originalValue:e,updatedValue:e}});return(0,o.useEffect)(function(){if(void 0!==r){var e;f.reset({name:r.name,description:null!==(e=r.comment)&&void 0!==e?e:"",values:y})}},[r]),(0,O.jsx)(B.ZP,{loading:u,visible:n,onCancel:a,header:'Update type "'.concat(null==r?void 0:r.name,'"'),confirmText:"Update type",onConfirm:function(){s.current&&s.current.click()},children:(0,O.jsx)(B.ZP.Content,{className:"py-4",children:(0,O.jsx)(n0.l0,rb(rb({},f),{},{children:(0,O.jsxs)("form",{className:"space-y-4",onSubmit:f.handleSubmit(function(e){if((null==i?void 0:i.ref)===void 0)return console.error("Project ref required");if((null==i?void 0:i.connectionString)===void 0)return console.error("Project connectionString required");if(void 0===r)return console.error("selectedEnumeratedType required");var t,n=rb({schema:r.schema,name:{original:r.name,updated:e.name},values:e.values.filter(function(e){return 0!==e.updatedValue.length}).map(function(e){return{original:e.originalValue,updated:e.updatedValue,isNew:e.isNew}})},e.description!==r.comment?{description:null===(t=e.description)||void 0===t?void 0:t.replaceAll("'","''")}:{});d(rb({projectRef:i.ref,connectionString:i.connectionString},n))}),children:[(0,O.jsx)(n0.Wi,{control:f.control,name:"name",render:function(e){var t=e.field;return(0,O.jsxs)(n0.xJ,{children:[(0,O.jsx)(n0.lX,{children:"Name"}),(0,O.jsx)(n0.NI,{children:(0,O.jsx)(n1.I,rb({},t))}),(0,O.jsx)(n0.zG,{})]})}}),(0,O.jsx)(n0.Wi,{control:f.control,name:"description",render:function(e){var t=e.field;return(0,O.jsxs)(n0.xJ,{children:[(0,O.jsx)(n0.lX,{children:"Description"}),(0,O.jsx)(n0.NI,{children:(0,O.jsx)(n1.I,rb({},t))}),(0,O.jsx)(n0.pf,{children:"Optional"})]})}}),(0,O.jsx)(nJ.Z5,{onDragEnd:function(e){return g(e)},children:(0,O.jsx)(nJ.bK,{droppableId:"enum_type_values_droppable",children:function(e){return(0,O.jsxs)("div",{ref:e.innerRef,children:[x.map(function(e,t){return(0,O.jsx)(n0.Wi,{control:f.control,name:"values.".concat(t,".updatedValue"),render:function(n){var r=n.field;return(0,O.jsxs)(n0.xJ,{children:[(0,O.jsx)(n0.lX,{className:(0,n2.cn)(0!==t&&"sr-only"),children:"Values"}),0===t&&(0,O.jsxs)(n3.bZ,{children:[(0,O.jsx)(ep.Z,{strokeWidth:1.5}),(0,O.jsx)(n3.Cd,{children:"Existing values cannot be deleted or sorted"}),(0,O.jsxs)(n3.X,{children:[(0,O.jsx)("p",{className:"!leading-normal track",children:"You will need to delete and recreate the enumerated type with the updated values instead."}),(0,O.jsx)(l.z,{asChild:!0,type:"default",icon:(0,O.jsx)(em.Z,{strokeWidth:1.5}),className:"mt-2",children:(0,O.jsx)(eu(),{href:"https://www.postgresql.org/message-id/21012.1459434338%40sss.pgh.pa.us",target:"_blank",rel:"noreferrer",children:"Learn more"})})]})]}),(0,O.jsx)(n0.NI,{children:(0,O.jsx)(rn,{index:t,id:e.id,field:r,isDisabled:!e.isNew,onRemoveValue:function(){return v(t)}})}),(0,O.jsx)(n0.zG,{className:"ml-6"})]})}},e.id)}),e.placeholder]})}})}),(0,O.jsx)(l.z,{type:"default",icon:(0,O.jsx)(m.Z,{strokeWidth:1.5}),onClick:function(){return b({isNew:!0,originalValue:"",updatedValue:""})},children:"Add value"}),(0,O.jsx)(l.z,{ref:s,htmlType:"submit",type:"default",className:"hidden",children:"Update"})]})}))})})},rj=function(){var e=(0,C.d2)().project,t=(0,o.useState)(""),n=t[0],r=t[1],a=(0,o.useState)("public"),s=a[0],i=a[1],c=(0,o.useState)(!1),d=c[0],m=c[1],v=(0,o.useState)(),w=v[0],N=v[1],_=(0,o.useState)(),k=_[0],D=_[1],T=(0,E.Q1)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}).data,R=nK({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),F=R.data,z=R.error,A=R.isLoading,I=R.isError,V=R.isSuccess,L=n.length>0?(null!=F?F:[]).filter(function(e){return e.schema===s&&e.name.toLowerCase().includes(n.toLowerCase())}):(null!=F?F:[]).filter(function(e){return e.schema===s}),W=(null!=T?T:[]).filter(function(e){var t;return Z.F.includes(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"")}),q=null==T?void 0:T.find(function(e){return e.name===s}),Y=W.some(function(e){return e.id===(null==q?void 0:q.id)});return(0,O.jsxs)("div",{className:"space-y-4",children:[(0,O.jsxs)("div",{className:"flex items-center justify-between",children:[(0,O.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,O.jsx)(P.Z,{className:"w-[260px]",size:"small",showError:!1,selectedSchemaName:s,onSelectSchema:i}),(0,O.jsx)(u.Z,{size:"small",value:n,className:"w-64",onChange:function(e){return r(e.target.value)},placeholder:"Search for a type",icon:(0,O.jsx)(p.Z,{size:14})})]}),!Y&&(0,O.jsx)(l.z,{type:"primary",onClick:function(){return m(!0)},children:"Create type"})]}),Y&&(0,O.jsx)(S.Z,{schema:s,entity:"enumerated types"}),A&&(0,O.jsx)(y.A,{}),I&&(0,O.jsx)(g.Z,{error:z,subject:"Failed to retrieve database enumerated types"}),V&&(0,O.jsx)(j.Z,{head:[(0,O.jsx)(j.Z.th,{children:"Schema"},"schema"),(0,O.jsx)(j.Z.th,{children:"Name"},"name"),(0,O.jsx)(j.Z.th,{children:"Values"},"values"),(0,O.jsx)(j.Z.th,{},"actions")],body:(0,O.jsxs)(O.Fragment,{children:[0===L.length&&0===n.length&&(0,O.jsx)(j.Z.tr,{children:(0,O.jsxs)(j.Z.td,{colSpan:4,children:[(0,O.jsx)("p",{className:"text-sm text-foreground",children:"No enumerated types created yet"}),(0,O.jsxs)("p",{className:"text-sm text-foreground-light",children:['There are no enumerated types found in the schema "',s,'"']})]})}),0===L.length&&n.length>0&&(0,O.jsx)(j.Z.tr,{children:(0,O.jsxs)(j.Z.td,{colSpan:4,children:[(0,O.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,O.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',n,'" did not return any results']})]})}),L.length>0&&L.map(function(e){return(0,O.jsxs)(j.Z.tr,{children:[(0,O.jsx)(j.Z.td,{className:"w-20",children:(0,O.jsx)("p",{className:"w-20 truncate",children:e.schema})}),(0,O.jsx)(j.Z.td,{children:e.name}),(0,O.jsx)(j.Z.td,{children:e.enums.join(", ")}),(0,O.jsx)(j.Z.td,{children:!Y&&(0,O.jsx)("div",{className:"flex justify-end items-center space-x-2",children:(0,O.jsxs)(f.h_,{children:[(0,O.jsx)(f.$F,{children:(0,O.jsx)(l.z,{asChild:!0,type:"default",icon:(0,O.jsx)(h.Z,{}),className:"px-1",children:(0,O.jsx)("span",{})})}),(0,O.jsxs)(f.AW,{side:"bottom",align:"end",className:"w-32",children:[(0,O.jsxs)(f.Xi,{className:"space-x-2",onClick:function(){return N(e)},children:[(0,O.jsx)(x.Z,{size:"tiny"}),(0,O.jsx)("p",{children:"Update type"})]}),(0,O.jsxs)(f.Xi,{className:"space-x-2",onClick:function(){return D(e)},children:[(0,O.jsx)(b.Z,{stroke:"red",size:"tiny"}),(0,O.jsx)("p",{children:"Delete type"})]})]})]})})})]},e.id)})]})}),(0,O.jsx)(rs,{visible:d,onClose:function(){return m(!1)},schema:s}),(0,O.jsx)(rv,{visible:void 0!==w,selectedEnumeratedType:w,onClose:function(){return N(void 0)}}),(0,O.jsx)(ru,{visible:void 0!==k,selectedEnumeratedType:k,onClose:function(){return D(void 0)}})]})}},56163:function(e,t,n){var r=n(8647),a=n(52322);t.Z=function(e){var t=e.searchString,n=e.onResetFilter;return(0,a.jsxs)("div",{className:"bg-surface-100 border border-default px-6 py-4 rounded flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"No results found"}),(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',t,'" did not return any results']})]}),void 0!==n&&(0,a.jsx)(r.z,{type:"default",onClick:function(){return n()},children:"Reset filter"})]})}},94542:function(e,t,n){var r=n(5632),a=n(85577),s=n(52322);t.Z=function(e){var t=e.message,n=(0,r.useRouter)(),i=n.query.ref;return(0,s.jsx)(a.Z,{title:"No public tables found",ctaButtonLabel:"Create a new table",onClickCta:function(){n.push("/project/".concat(i,"/editor"))},children:(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:t})})}},79923:function(e,t,n){n.d(t,{T:function(){return f}});var r=n(95235),a=n(82269),s=n(20406),i=n(28526),o=n.n(i),c=n(58943),l=n(81229),d=n(57083),u=["enabled"];function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function m(){return(m=(0,s.Z)(o().mark(function e(t,n){var r,a,s,i;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.projectRef){e.next=3;break}throw Error("Project ref is required");case 3:return e.next=5,(0,l.U2)("/platform/database/{ref}/backups",{params:{path:{ref:r}},signal:n});case 5:if(s=(a=e.sent).data,!(i=a.error)){e.next=10;break}throw i;case 10:return e.abrupt("return",s);case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}var f=function(e){var t=e.projectRef,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=n.enabled,i=(0,a.Z)(n,u);return(0,c.a)(d.A.backups(t),function(e){return function(e,t){return m.apply(this,arguments)}({projectRef:t},e.signal)},function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({enabled:(void 0===s||s)&&void 0!==t},i))}},79382:function(e,t,n){var r=n(95235);n(2784);var a=n(78046),s=n(12223),i=n(52322);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}t.Z=function(e){return(0,i.jsx)(s.Z,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({icon:a.Z},e))}}}]);